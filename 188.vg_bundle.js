"use strict";(self.webpackChunkcustom_vf_nextjs=self.webpackChunkcustom_vf_nextjs||[]).push([[188],{4444:(t,e,n)=>{n.d(e,{BH:()=>d,L:()=>o,LL:()=>y,P0:()=>l,Sg:()=>f,ZR:()=>g,aH:()=>h,eu:()=>m,hl:()=>p,m9:()=>b,vZ:()=>w});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,u=a?t[e+2]:0,c=i>>2,l=(3&i)<<4|o>>4;let h=(15&o)<<2|u>>6,d=63&u;a||(d=64,s||(h=64)),r.push(n[c],n[l],n[h],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const u=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==u)throw new s;const c=i<<2|o>>4;if(r.push(c),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==u){const t=a<<6&192|u;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){return function(t){const e=r(t);return i.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=function(t){try{return i.decodeString(t,!0)}catch(t){}return null};const u=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,c=()=>{try{return u()||(()=>{if("undefined"==typeof process)return;const t={NODE_ENV:"production",WORKER_ENV:"production"}.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&a(t[1]);return e&&JSON.parse(e)})()}catch(t){return}},l=t=>{const e=(t=>{var e,n;return null===(n=null===(e=c())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]},h=()=>{var t;return null===(t=c())||void 0===t?void 0:t.config};class d{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function f(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}function p(){try{return"object"==typeof indexedDB}catch(t){return!1}}function m(){return new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class g extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,y.prototype.create)}}class y{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(v,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new g(r,o,n)}}const v=/\{\$([^}]+)}/g;function w(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(_(n)&&_(s)){if(!w(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function _(t){return null!==t&&"object"==typeof t}function b(t){return t&&t._delegate?t._delegate:t}},6677:(t,e,n)=>{n.d(e,{ky:()=>h});var r=n(3953),i=n(7294);var s=function(){return s=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},s.apply(this,arguments)},o=function(t){return{loading:null==t,value:t}},a=function(t){var e=t?t():void 0,n=(0,i.useReducer)((function(t,e){switch(e.type){case"error":return s(s({},t),{error:e.error,loading:!1,value:void 0});case"reset":return o(e.defaultValue);case"value":return s(s({},t),{error:void 0,loading:!1,value:e.value});default:return t}}),o(e)),r=n[0],a=n[1],u=(0,i.useCallback)((function(){var e=t?t():void 0;a({type:"reset",defaultValue:e})}),[t]),c=(0,i.useCallback)((function(t){a({type:"error",error:t})}),[]),l=(0,i.useCallback)((function(t){a({type:"value",value:t})}),[]);return(0,i.useMemo)((function(){return{error:r.error,loading:r.loading,reset:u,setError:c,setValue:l,value:r.value}}),[r.error,r.loading,u,c,l,r.value])},u=function(t,e,n){var r=(0,i.useRef)(t);return(0,i.useEffect)((function(){e(t,r.current)||(r.current=t,n&&n())})),r},c=function(t,e){var n=!t&&!e,i=!!t&&!!e&&(0,r.Eo)(t,e);return n||i},l=function(t,e){return u(t,c,e)},h=function(t,e){var n=a(),s=n.error,o=n.loading,u=n.reset,c=n.setError,h=n.setValue,d=n.value,f=l(t,u);return(0,i.useEffect)((function(){if(f.current){var t=(null==e?void 0:e.snapshotListenOptions)?(0,r.cf)(f.current,e.snapshotListenOptions,h,c):(0,r.cf)(f.current,h,c);return function(){t()}}h(void 0)}),[f.current]),[d,o,s]}},7516:(t,e,n)=>{n.d(e,{PRb:()=>s,dqF:()=>i,y1O:()=>o});var r=n(4405);function i(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16 2H8C4.691 2 2 4.691 2 8v13a1 1 0 0 0 1 1h13c3.309 0 6-2.691 6-6V8c0-3.309-2.691-6-6-6zm4 14c0 2.206-1.794 4-4 4H4V8c0-2.206 1.794-4 4-4h8c2.206 0 4 1.794 4 4v8z"}},{tag:"path",attr:{d:"M11 6h2v8h-2zm0 10h2v2h-2z"}}]})(t)}function s(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m21.426 11.095-17-8A.999.999 0 0 0 3.03 4.242L4.969 12 3.03 19.758a.998.998 0 0 0 1.396 1.147l17-8a1 1 0 0 0 0-1.81zM5.481 18.197l.839-3.357L12 12 6.32 9.16l-.839-3.357L18.651 12l-13.17 6.197z"}}]})(t)}function o(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"m18.988 2.012 3 3L19.701 7.3l-3-3zM8 16h3l7.287-7.287-3-3L8 13z"}},{tag:"path",attr:{d:"M19 19H8.158c-.026 0-.053.01-.079.01-.033 0-.066-.009-.1-.01H5V5h6.847l2-2H5c-1.103 0-2 .896-2 2v14c0 1.104.897 2 2 2h14a2 2 0 0 0 2-2v-8.668l-2 2V19z"}}]})(t)}},231:(t,e,n)=>{n.d(e,{Wh:()=>o,gmG:()=>a,l_A:()=>i,uYL:()=>s});var r=n(4405);function i(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"}}]})(t)}function s(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"}}]})(t)}function o(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 320 512"},child:[{tag:"path",attr:{d:"M48 64C21.5 64 0 85.5 0 112V400c0 26.5 21.5 48 48 48H80c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H48zm192 0c-26.5 0-48 21.5-48 48V400c0 26.5 21.5 48 48 48h32c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48H240z"}}]})(t)}function a(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"}}]})(t)}},4149:(t,e,n)=>{n.d(e,{DVR:()=>o,Gy1:()=>i,QAE:()=>s});var r=n(4405);function i(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M186.301 339.893L96 249.461l-32 30.507L186.301 402 448 140.506 416 110z"}}]})(t)}function s(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M405 136.798L375.202 107 256 226.202 136.798 107 107 136.798 226.202 256 107 375.202 136.798 405 256 285.798 375.202 405 405 375.202 285.798 256z"}}]})(t)}function o(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M387.581 139.712L356.755 109 216.913 248.319l30.831 30.719 139.837-139.326zM481.172 109L247.744 340.469l-91.39-91.051-30.827 30.715L247.744 403 512 139.712 481.172 109zM0 280.133L123.321 403l30.829-30.713L31.934 249.418 0 280.133z"}}]})(t)}},5434:(t,e,n)=>{n.d(e,{jZM:()=>s,kIL:()=>i,xg7:()=>o});var r=n(4405);function i(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"}},{tag:"path",attr:{d:"M6 19h12v2H6z"}}]})(t)}function s(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"g",attr:{fill:"none"},child:[{tag:"path",attr:{d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M0 0h24v24H0z"}},{tag:"path",attr:{d:"M0 0h24v24H0z"}}]},{tag:"path",attr:{d:"M12 5V1L7 6l5 5V7c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"}}]})(t)}function o(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z",opacity:".87"}},{tag:"path",attr:{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm3.59-13L12 10.59 8.41 7 7 8.41 10.59 12 7 15.59 8.41 17 12 13.41 15.59 17 17 15.59 13.41 12 17 8.41z"}}]})(t)}},9352:(t,e,n)=>{n.d(e,{G1z:()=>s,_v3:()=>a,kc8:()=>i,xEs:()=>o});var r=n(4405);function i(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12 15.0006L7.75732 10.758L9.17154 9.34375L12 12.1722L14.8284 9.34375L16.2426 10.758L12 15.0006Z"}}]})(t)}function s(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M14.8287 7.7574L9.1718 13.4143C8.78127 13.8048 8.78127 14.4379 9.1718 14.8285C9.56232 15.219 10.1955 15.219 10.586 14.8285L16.2429 9.17161C17.4144 8.00004 17.4144 6.10055 16.2429 4.92897C15.0713 3.7574 13.1718 3.7574 12.0002 4.92897L6.34337 10.5858C4.39075 12.5384 4.39075 15.7043 6.34337 17.6569C8.29599 19.6095 11.4618 19.6095 13.4144 17.6569L19.0713 12L20.4855 13.4143L14.8287 19.0711C12.095 21.8048 7.66283 21.8048 4.92916 19.0711C2.19549 16.3374 2.19549 11.9053 4.92916 9.17161L10.586 3.51476C12.5386 1.56214 15.7045 1.56214 17.6571 3.51476C19.6097 5.46738 19.6097 8.63321 17.6571 10.5858L12.0002 16.2427C10.8287 17.4143 8.92916 17.4143 7.75759 16.2427C6.58601 15.0711 6.58601 13.1716 7.75759 12L13.4144 6.34319L14.8287 7.7574Z"}}]})(t)}function o(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M11.9998 3C10.3429 3 8.99976 4.34315 8.99976 6V10C8.99976 11.6569 10.3429 13 11.9998 13C13.6566 13 14.9998 11.6569 14.9998 10V6C14.9998 4.34315 13.6566 3 11.9998 3ZM11.9998 1C14.7612 1 16.9998 3.23858 16.9998 6V10C16.9998 12.7614 14.7612 15 11.9998 15C9.23833 15 6.99976 12.7614 6.99976 10V6C6.99976 3.23858 9.23833 1 11.9998 1ZM3.05469 11H5.07065C5.55588 14.3923 8.47329 17 11.9998 17C15.5262 17 18.4436 14.3923 18.9289 11H20.9448C20.4837 15.1716 17.1714 18.4839 12.9998 18.9451V23H10.9998V18.9451C6.82814 18.4839 3.51584 15.1716 3.05469 11Z"}}]})(t)}function a(t){return(0,r.w_)({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M16.4259 17.839L21.1935 22.6066L22.6077 21.1924L2.80874 1.3934L1.39453 2.80761L7.00113 8.41421V10C7.00113 12.7614 9.23971 15 12.0011 15C12.4835 15 12.9499 14.9317 13.3912 14.8042L14.9413 16.3544C14.0474 16.7688 13.0513 17 12.0011 17C8.47466 17 5.55725 14.3923 5.07202 11H3.05606C3.51721 15.1716 6.82952 18.4839 11.0011 18.9451V23H13.0011V18.9451C14.2351 18.8087 15.3939 18.4228 16.4259 17.839ZM11.5538 12.9669C10.2551 12.7727 9.22843 11.7461 9.03426 10.4473L11.5538 12.9669ZM19.3757 15.1604L17.9333 13.7179C18.4417 12.9084 18.789 11.9874 18.9302 11H20.9462C20.7763 12.5366 20.2197 13.9565 19.3757 15.1604ZM16.4668 12.2514L14.9183 10.703C14.9725 10.4775 15.0011 10.2421 15.0011 10V6C15.0011 4.34315 13.658 3 12.0011 3C10.7069 3 9.60408 3.81956 9.18335 4.96802L7.68672 3.47139C8.55524 1.99268 10.1623 1 12.0011 1C14.7626 1 17.0011 3.23858 17.0011 6V10C17.0011 10.8099 16.8086 11.5748 16.4668 12.2514Z"}}]})(t)}},8514:(t,e,n)=>{n.d(e,{Z:()=>_});var r=n(7462),i=n(3366),s=n(7294);const o=s.useLayoutEffect;var a=function(t,e){"function"!=typeof t?t.current=e:t(e)};const u=function(t,e){var n=(0,s.useRef)();return(0,s.useCallback)((function(r){t.current=r,n.current&&a(n.current,null),n.current=e,e&&a(e,r)}),[e])};var c={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},l=function(t){Object.keys(c).forEach((function(e){t.style.setProperty(e,c[e],"important")}))},h=null,d=function(t,e){var n=t.scrollHeight;return"border-box"===e.sizingStyle.boxSizing?n+e.borderSize:n-e.paddingSize};var f=function(){},p=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak"],m=!!document.documentElement.currentStyle,g=function(t){var e=window.getComputedStyle(t);if(null===e)return null;var n,r=(n=e,p.reduce((function(t,e){return t[e]=n[e],t}),{})),i=r.boxSizing;return""===i?null:(m&&"border-box"===i&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})};function y(t,e,n){var r,i,a=(r=n,i=s.useRef(r),o((function(){i.current=r})),i);s.useLayoutEffect((function(){var n=function(t){return a.current(t)};if(t)return t.addEventListener(e,n),function(){return t.removeEventListener(e,n)}}),[])}var v=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],w=function(t,e){var n=t.cacheMeasurements,o=t.maxRows,a=t.minRows,c=t.onChange,p=void 0===c?f:c,m=t.onHeightChange,w=void 0===m?f:m,_=(0,i.Z)(t,v),b=void 0!==_.value,E=s.useRef(null),T=u(E,e),S=s.useRef(0),I=s.useRef(),C=function(){var t=E.current,e=n&&I.current?I.current:g(t);if(e){I.current=e;var r=function(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),h||((h=document.createElement("textarea")).setAttribute("tabindex","-1"),h.setAttribute("aria-hidden","true"),l(h)),null===h.parentNode&&document.body.appendChild(h);var i=t.paddingSize,s=t.borderSize,o=t.sizingStyle,a=o.boxSizing;Object.keys(o).forEach((function(t){var e=t;h.style[e]=o[e]})),l(h),h.value=e;var u=d(h,t);h.value=e,u=d(h,t),h.value="x";var c=h.scrollHeight-i,f=c*n;"border-box"===a&&(f=f+i+s),u=Math.max(f,u);var p=c*r;return"border-box"===a&&(p=p+i+s),[u=Math.min(p,u),c]}(e,t.value||t.placeholder||"x",a,o),i=r[0],s=r[1];S.current!==i&&(S.current=i,t.style.setProperty("height",i+"px","important"),w(i,{rowHeight:s}))}};return s.useLayoutEffect(C),y(window,"resize",C),function(t){y(document.fonts,"loadingdone",t)}(C),s.createElement("textarea",(0,r.Z)({},_,{onChange:function(t){b||C(),p(t)},ref:T}))},_=s.forwardRef(w)},8965:(t,e,n)=>{function r(t){return" \r\n\t".indexOf(t)>=0}function i(t){for(var e,n,i,s=["topLevel"],o=0,a=function(t){return s.push(t)},u=function(t){return s[s.length-1]=t},c=function(t){null==e&&(e=o,n=s.length,i=t)},l=function(t){t===i&&(e=void 0,n=void 0,i=void 0)},h=function(){return s.pop()},d=function(){return o--},f=function(t){if("0"<=t&&t<="9")a("number");else switch(t){case'"':return void a("string");case"-":return void a("numberNeedsDigit");case"t":return void a("true");case"f":return void a("false");case"n":return void a("null");case"[":return void a("arrayNeedsValue");case"{":return void a("objectNeedsKey")}},p=t.length;o<p;o++){var m=t[o];switch(s[s.length-1]){case"topLevel":f(m);break;case"string":switch(m){case'"':h();break;case"\\":c("stringEscape"),a("stringEscaped")}break;case"stringEscaped":"u"===m?a("stringUnicode"):(l("stringEscape"),h());break;case"stringUnicode":o-t.lastIndexOf("u",o)==4&&(l("stringEscape"),h());break;case"number":"."===m?u("numberNeedsDigit"):"e"===m||"E"===m?u("numberNeedsExponent"):(m<"0"||m>"9")&&(d(),h());break;case"numberNeedsDigit":u("number");break;case"numberNeedsExponent":u("+"===m||"-"===m?"numberNeedsDigit":"number");break;case"true":case"false":case"null":(m<"a"||m>"z")&&(d(),h());break;case"arrayNeedsValue":"]"===m?h():r(m)||(l("collectionItem"),u("arrayNeedsComma"),f(m));break;case"arrayNeedsComma":"]"===m?h():","===m&&(c("collectionItem"),u("arrayNeedsValue"));break;case"objectNeedsKey":"}"===m?h():'"'===m&&(c("collectionItem"),u("objectNeedsColon"),a("string"));break;case"objectNeedsColon":":"===m&&u("objectNeedsValue");break;case"objectNeedsValue":r(m)||(l("collectionItem"),u("objectNeedsComma"),f(m));break;case"objectNeedsComma":"}"===m?h():","===m&&(c("collectionItem"),u("objectNeedsKey"))}}null!=n&&(s.length=n);for(var g=[null!=e?t.slice(0,e):t],y=function(e){return g.push(e.slice(t.length-t.lastIndexOf(e[0])))},v=s.length-1;v>=0;v--)switch(s[v]){case"string":g.push('"');break;case"numberNeedsDigit":case"numberNeedsExponent":g.push("0");break;case"true":y("true");break;case"false":y("false");break;case"null":y("null");break;case"arrayNeedsValue":case"arrayNeedsComma":g.push("]");break;case"objectNeedsKey":case"objectNeedsColon":case"objectNeedsValue":case"objectNeedsComma":g.push("}")}return g.join("")}n.d(e,{Z:()=>i})},389:(t,e,n)=>{n.d(e,{Jn:()=>F,qX:()=>O,Xd:()=>x,wN:()=>L,Mq:()=>B,ZF:()=>U,KN:()=>q});var r=n(8463),i=n(3333),s=n(4444);const o=(t,e)=>e.some((e=>t instanceof e));let a,u;const c=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap;let p={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return l.get(t);if("objectStoreNames"===e)return t.objectStoreNames||h.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return y(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function m(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(u||(u=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(v(this),e),y(c.get(this))}:function(...e){return y(t.apply(v(this),e))}:function(e,...n){const r=t.call(v(this),e,...n);return h.set(r,e.sort?e.sort():[e]),y(r)}}function g(t){return"function"==typeof t?m(t):(t instanceof IDBTransaction&&function(t){if(l.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));l.set(t,e)}(t),o(t,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,p):t)}function y(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(y(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&c.set(e,t)})).catch((()=>{})),f.set(e,t),e}(t);if(d.has(t))return d.get(t);const e=g(t);return e!==t&&(d.set(t,e),f.set(e,t)),e}const v=t=>f.get(t);const w=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],b=new Map;function E(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(b.get(e))return b.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!w.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return b.set(e,s),s}p=(t=>({...t,get:(e,n,r)=>E(e,n)||t.get(e,n,r),has:(e,n)=>!!E(e,n)||t.has(e,n)}))(p);class T{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const S="@firebase/app",I="0.9.25",C=new i.Yd("@firebase/app"),A="[DEFAULT]",k={[S]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},D=new Map,N=new Map;function R(t,e){try{t.container.addComponent(e)}catch(n){C.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function x(t){const e=t.name;if(N.has(e))return C.debug(`There were multiple attempts to register component ${e}.`),!1;N.set(e,t);for(const e of D.values())R(e,t);return!0}function O(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function L(t,e,n=A){O(t,e).clearInstance(n)}const P={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},M=new s.LL("app","Firebase",P);class V{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new r.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw M.create("app-deleted",{appName:this._name})}}const F="10.7.1";function U(t,e={}){let n=t;if("object"!=typeof e){e={name:e}}const i=Object.assign({name:A,automaticDataCollectionEnabled:!1},e),o=i.name;if("string"!=typeof o||!o)throw M.create("bad-app-name",{appName:String(o)});if(n||(n=(0,s.aH)()),!n)throw M.create("no-options");const a=D.get(o);if(a){if((0,s.vZ)(n,a.options)&&(0,s.vZ)(i,a.config))return a;throw M.create("duplicate-app",{appName:o})}const u=new r.H0(o);for(const t of N.values())u.addComponent(t);const c=new V(n,i,u);return D.set(o,c),c}function B(t=A){const e=D.get(t);if(!e&&t===A&&(0,s.aH)())return U();if(!e)throw M.create("no-app",{appName:t});return e}function q(t,e,n){var i;let s=null!==(i=k[t])&&void 0!==i?i:t;n&&(s+=`-${n}`);const o=s.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${s}" with version "${e}":`];return o&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void C.warn(t.join(" "))}x(new r.wA(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const j="firebase-heartbeat-database",z=1,$="firebase-heartbeat-store";let H=null;function K(){return H||(H=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=y(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(y(o.result),t.oldVersion,t.newVersion,y(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(j,z,{upgrade:(t,e)=>{if(0===e)t.createObjectStore($)}}).catch((t=>{throw M.create("idb-open",{originalErrorMessage:t.message})}))),H}async function G(t,e){try{const n=(await K()).transaction($,"readwrite"),r=n.objectStore($);await r.put(e,Q(t)),await n.done}catch(t){if(t instanceof s.ZR)C.warn(t.message);else{const e=M.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});C.warn(e.message)}}}function Q(t){return`${t.name}!${t.options.appId}`}class W{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Y(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=X();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=X(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),J(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),J(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=(0,s.L)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function X(){return(new Date).toISOString().substring(0,10)}class Y{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,s.hl)()&&(0,s.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await K();return await e.transaction($).objectStore($).get(Q(t))}catch(t){if(t instanceof s.ZR)C.warn(t.message);else{const e=M.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});C.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return G(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return G(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function J(t){return(0,s.L)(JSON.stringify({version:2,heartbeats:t})).length}var Z;Z="",x(new r.wA("platform-logger",(t=>new T(t)),"PRIVATE")),x(new r.wA("heartbeat",(t=>new W(t)),"PRIVATE")),q(S,I,Z),q(S,I,"esm2017"),q("fire-js","")},8463:(t,e,n)=>{n.d(e,{H0:()=>a,wA:()=>i});var r=n(4444);class i{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const s="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new r.BH;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:s})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=s){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=s){return this.instances.has(t)}getOptions(t=s){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(t)&&e.resolve(r)}return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===s?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=s){return this.component?this.component.multipleInstances?t:s:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},3333:(t,e,n)=>{n.d(e,{Yd:()=>c,in:()=>i});const r=[];var i;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(i||(i={}));const s={debug:i.DEBUG,verbose:i.VERBOSE,info:i.INFO,warn:i.WARN,error:i.ERROR,silent:i.SILENT},o=i.INFO,a={[i.DEBUG]:"log",[i.VERBOSE]:"log",[i.INFO]:"info",[i.WARN]:"warn",[i.ERROR]:"error"},u=(t,e,...n)=>{if(e<t.logLevel)return;(new Date).toISOString();if(!a[e])throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class c{constructor(t){this.name=t,this._logLevel=o,this._logHandler=u,this._userLogHandler=null,r.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in i))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?s[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,i.DEBUG,...t),this._logHandler(this,i.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,i.VERBOSE,...t),this._logHandler(this,i.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,i.INFO,...t),this._logHandler(this,i.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,i.WARN,...t),this._logHandler(this,i.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,i.ERROR,...t),this._logHandler(this,i.ERROR,...t)}}},7897:(t,e,n)=>{n.d(e,{f:()=>i});var r=n(5893),i=t=>(0,r.jsx)("svg",{"aria-hidden":"true",focusable:"false",height:"1em",role:"presentation",viewBox:"0 0 24 24",width:"1em",...t,children:(0,r.jsx)("path",{d:"M12 2a10 10 0 1010 10A10.016 10.016 0 0012 2zm3.36 12.3a.754.754 0 010 1.06.748.748 0 01-1.06 0l-2.3-2.3-2.3 2.3a.748.748 0 01-1.06 0 .754.754 0 010-1.06l2.3-2.3-2.3-2.3A.75.75 0 019.7 8.64l2.3 2.3 2.3-2.3a.75.75 0 011.06 1.06l-2.3 2.3z",fill:"currentColor"})})},4720:(t,e,n)=>{n.d(e,{e:()=>r,x:()=>i});var r=t=>(null==t?void 0:t.length)<=4?t:null==t?void 0:t.slice(0,3),i=(...t)=>{let e=" ";for(const n of t)if("string"==typeof n&&n.length>0){e=n;break}return e}},8652:(t,e,n)=>{n.d(e,{Q:()=>o});var r=n(7294),i=n(8922),s=n(1844);function o(t,e,n){let{validationBehavior:o,focus:u}=t;(0,s.bt)((()=>{if("native"===o&&(null==n?void 0:n.current)){let r=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";n.current.setCustomValidity(r),n.current.hasAttribute("title")||(n.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation({isInvalid:!(t=n.current).validity.valid,validationDetails:a(t),validationErrors:t.validationMessage?[t.validationMessage]:[]})}var t}));let c=(0,s.iW)((()=>{e.resetValidation()})),l=(0,s.iW)((t=>{var r;e.displayValidation.isInvalid||e.commitValidation();let s=null==n||null===(r=n.current)||void 0===r?void 0:r.form;var o;!t.defaultPrevented&&n&&s&&function(t){for(let e=0;e<t.elements.length;e++){let n=t.elements[e];if(!n.validity.valid)return n}return null}(s)===n.current&&(u?u():null===(o=n.current)||void 0===o||o.focus(),(0,i._w)("keyboard"));t.preventDefault()})),h=(0,s.iW)((()=>{e.commitValidation()}));(0,r.useEffect)((()=>{let t=null==n?void 0:n.current;if(!t)return;let e=t.form;return t.addEventListener("invalid",l),t.addEventListener("change",h),null==e||e.addEventListener("reset",c),()=>{t.removeEventListener("invalid",l),t.removeEventListener("change",h),null==e||e.removeEventListener("reset",c)}}),[n,l,h,c,o])}function a(t){let e=t.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}},9200:(t,e,n)=>{n.d(e,{N:()=>i,U:()=>s});var r=n(1844);function i(t){let{id:e,label:n,"aria-labelledby":i,"aria-label":s,labelElementType:o="label"}=t;e=(0,r.Me)(e);let a=(0,r.Me)(),u={};return n&&(i=i?`${a} ${i}`:a,u={id:a,htmlFor:"label"===o?e:void 0}),{labelProps:u,fieldProps:(0,r.bE)({id:e,"aria-label":s,"aria-labelledby":i})}}function s(t){let{description:e,errorMessage:n,isInvalid:s,validationState:o}=t,{labelProps:a,fieldProps:u}=i(t),c=(0,r.mp)([Boolean(e),Boolean(n),s,o]),l=(0,r.mp)([Boolean(e),Boolean(n),s,o]);return u=(0,r.dG)(u,{"aria-describedby":[c,l,t["aria-describedby"]].filter(Boolean).join(" ")||void 0}),{labelProps:a,fieldProps:u,descriptionProps:{id:c},errorMessageProps:{id:l}}}},4778:(t,e,n)=>{n.d(e,{E:()=>l});var r=n(7294),i=n(1844),s=n(5897),o=n(9200),a=n(8628),u=n(8652),c=n(7930);function l(t,e){let{inputElementType:n="input",isDisabled:l=!1,isRequired:h=!1,isReadOnly:d=!1,type:f="text",validationBehavior:p="aria"}=t,[m,g]=(0,s.zk)(t.value,t.defaultValue||"",t.onChange),{focusableProps:y}=(0,a.kc)(t,e),v=(0,c.Q3)({...t,value:m}),{isInvalid:w,validationErrors:_,validationDetails:b}=v.displayValidation,{labelProps:E,fieldProps:T,descriptionProps:S,errorMessageProps:I}=(0,o.U)({...t,isInvalid:w,errorMessage:t.errorMessage||_}),C=(0,i.zL)(t,{labelable:!0});const A={type:f,pattern:t.pattern};return(0,i.y$)(e,m,g),(0,u.Q)(t,v,e),(0,r.useEffect)((()=>{if(e.current instanceof(0,i.kR)(e.current).HTMLTextAreaElement){let t=e.current;Object.defineProperty(t,"defaultValue",{get:()=>t.value,set:()=>{},configurable:!0})}}),[e]),{labelProps:E,inputProps:(0,i.dG)(C,"input"===n&&A,{disabled:l,readOnly:d,required:h&&"native"===p,"aria-required":h&&"aria"===p||void 0,"aria-invalid":w||void 0,"aria-errormessage":t["aria-errormessage"],"aria-activedescendant":t["aria-activedescendant"],"aria-autocomplete":t["aria-autocomplete"],"aria-haspopup":t["aria-haspopup"],value:m,onChange:t=>g(t.target.value),autoComplete:t.autoComplete,maxLength:t.maxLength,minLength:t.minLength,name:t.name,placeholder:t.placeholder,inputMode:t.inputMode,onCopy:t.onCopy,onCut:t.onCut,onPaste:t.onPaste,onCompositionEnd:t.onCompositionEnd,onCompositionStart:t.onCompositionStart,onCompositionUpdate:t.onCompositionUpdate,onSelect:t.onSelect,onBeforeInput:t.onBeforeInput,onInput:t.onInput,...y,...T}),descriptionProps:S,errorMessageProps:I,isInvalid:w,validationErrors:_,validationDetails:b}}},7930:(t,e,n)=>{n.d(e,{PS:()=>o,Q3:()=>c,W0:()=>f,tL:()=>u});var r=n(7294);const i={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},s={...i,customError:!0,valid:!1},o={isInvalid:!1,validationDetails:i,validationErrors:[]},a=(0,r.createContext)({}),u="__formValidationState"+Date.now();function c(t){if(t[u]){let{realtimeValidation:e,displayValidation:n,updateValidation:r,resetValidation:i,commitValidation:s}=t[u];return{realtimeValidation:e,displayValidation:n,updateValidation:r,resetValidation:i,commitValidation:s}}return function(t){let{isInvalid:e,validationState:n,name:i,value:u,builtinValidation:c,validate:f,validationBehavior:p="aria"}=t;n&&(e||(e="invalid"===n));let m=e?{isInvalid:!0,validationErrors:[],validationDetails:s}:null,g=(0,r.useMemo)((()=>h(function(t,e){if("function"==typeof t){let n=t(e);if(n&&"boolean"!=typeof n)return l(n)}return[]}(f,u))),[f,u]);(null==c?void 0:c.validationDetails.valid)&&(c=null);let y=(0,r.useContext)(a),v=(0,r.useMemo)((()=>i?Array.isArray(i)?i.flatMap((t=>l(y[t]))):l(y[i]):[]),[y,i]),[w,_]=(0,r.useState)(y),[b,E]=(0,r.useState)(!1);y!==w&&(_(y),E(!1));let T=(0,r.useMemo)((()=>h(b?[]:v)),[b,v]),S=(0,r.useRef)(o),[I,C]=(0,r.useState)(o),A=(0,r.useRef)(o),k=()=>{if(!D)return;N(!1);let t=g||c||S.current;d(t,A.current)||(A.current=t,C(t))},[D,N]=(0,r.useState)(!1);return(0,r.useEffect)(k),{realtimeValidation:m||T||g||c||o,displayValidation:"native"===p?m||T||I:m||T||g||c||I,updateValidation(t){"aria"!==p||d(I,t)?S.current=t:C(t)},resetValidation(){let t=o;d(t,A.current)||(A.current=t,C(t)),"native"===p&&N(!1),E(!0)},commitValidation(){"native"===p&&N(!0),E(!0)}}}(t)}function l(t){return t?Array.isArray(t)?t:[t]:[]}function h(t){return t.length?{isInvalid:!0,validationErrors:t,validationDetails:s}:null}function d(t,e){return t===e||t&&e&&t.isInvalid===e.isInvalid&&t.validationErrors.length===e.validationErrors.length&&t.validationErrors.every(((t,n)=>t===e.validationErrors[n]))&&Object.entries(t.validationDetails).every((([t,n])=>e.validationDetails[t]===n))}function f(...t){let e=new Set,n=!1,r={...i};for(let i of t){var s,o;for(let t of i.validationErrors)e.add(t);n||(n=i.isInvalid);for(let t in r)(s=r)[o=t]||(s[o]=i.validationDetails[t])}return r.valid=!n,{isInvalid:n,validationErrors:[...e],validationDetails:r}}},3977:(t,e,n)=>{n.d(e,{ZF:()=>r.ZF});var r=n(389);(0,r.KN)("firebase","10.7.1","app")},3953:(t,e,n)=>{n.d(e,{JU:()=>Il,ad:()=>Nl,cf:()=>dh,Eo:()=>Cl,pl:()=>hh});var r,i=n(389),s=n(8463),o=n(3333),a=n(4444),u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c={},l=l||{},h=u||self;function d(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function f(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var p="closure_uid_"+(1e9*Math.random()>>>0),m=0;function g(t,e,n){return t.call.apply(t.bind,arguments)}function y(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?g:y).apply(null,arguments)}function w(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function _(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function b(){this.s=this.s,this.o=this.o}b.prototype.s=!1,b.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,p)&&t[p]||(t[p]=++m))},b.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const E=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function T(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function S(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(d(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function I(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}I.prototype.h=function(){this.defaultPrevented=!0};var C=function(){if(!h.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};h.addEventListener("test",t,e),h.removeEventListener("test",t,e)}catch(t){}return t}();function A(t){return/^[\s\xa0]*$/.test(t)}function k(){var t=h.navigator;return t&&(t=t.userAgent)?t:""}function D(t){return-1!=k().indexOf(t)}function N(t){return N[" "](t),t}N[" "]=function(){};var R,x,O,L=D("Opera"),P=D("Trident")||D("MSIE"),M=D("Edge"),V=M||P,F=D("Gecko")&&!(-1!=k().toLowerCase().indexOf("webkit")&&!D("Edge"))&&!(D("Trident")||D("MSIE"))&&!D("Edge"),U=-1!=k().toLowerCase().indexOf("webkit")&&!D("Edge");function B(){var t=h.document;return t?t.documentMode:void 0}t:{var q="",j=(x=k(),F?/rv:([^\);]+)(\)|;)/.exec(x):M?/Edge\/([\d\.]+)/.exec(x):P?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(x):U?/WebKit\/(\S+)/.exec(x):L?/(?:Version)[ \/]?(\S+)/.exec(x):void 0);if(j&&(q=j?j[1]:""),P){var z=B();if(null!=z&&z>parseFloat(q)){R=String(z);break t}}R=q}if(h.document&&P){var $=B();O=$||(parseInt(R,10)||void 0)}else O=void 0;var H=O;function K(t,e){if(I.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(F){t:{try{N(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:G[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&K.$.h.call(this)}}_(K,I);var G={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Q="closure_listenable_"+(1e6*Math.random()|0),W=0;function X(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++W,this.fa=this.ia=!1}function Y(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function J(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function Z(t){const e={};for(const n in t)e[n]=t[n];return e}const tt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function et(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<tt.length;e++)n=tt[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function nt(t){this.src=t,this.g={},this.h=0}function rt(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=E(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(Y(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function it(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}nt.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=it(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new X(e,this.src,s,!!r,i)).ia=n,t.push(e)),e};var st="closure_lm_"+(1e6*Math.random()|0),ot={};function at(t,e,n,r,i){if(r&&r.once)return ct(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)at(t,e[s],n,r,i);return null}return n=gt(n),t&&t[Q]?t.O(e,n,f(r)?!!r.capture:!!r,i):ut(t,e,n,!1,r,i)}function ut(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=f(i)?!!i.capture:!!i,a=pt(t);if(a||(t[st]=a=new nt(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){function t(n){return e.call(t.src,t.listener,n)}const e=ft;return t}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)C||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(dt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ct(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ct(t,e[s],n,r,i);return null}return n=gt(n),t&&t[Q]?t.P(e,n,f(r)?!!r.capture:!!r,i):ut(t,e,n,!0,r,i)}function lt(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)lt(t,e[s],n,r,i);else r=f(r)?!!r.capture:!!r,n=gt(n),t&&t[Q]?(t=t.i,(e=String(e).toString())in t.g&&(-1<(n=it(s=t.g[e],n,r,i))&&(Y(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--)))):t&&(t=pt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=it(e,n,r,i)),(n=-1<t?e[t]:null)&&ht(n))}function ht(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Q])rt(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(dt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=pt(e))?(rt(n,t),0==n.h&&(n.src=null,e[st]=null)):Y(t)}}}function dt(t){return t in ot?ot[t]:ot[t]="on"+t}function ft(t,e){if(t.fa)t=!0;else{e=new K(e,this);var n=t.listener,r=t.la||t.src;t.ia&&ht(t),t=n.call(r,e)}return t}function pt(t){return(t=t[st])instanceof nt?t:null}var mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function gt(t){return"function"==typeof t?t:(t[mt]||(t[mt]=function(e){return t.handleEvent(e)}),t[mt])}function yt(){b.call(this),this.i=new nt(this),this.S=this,this.J=null}function vt(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new I(e,t);else if(e instanceof I)e.target=e.target||t;else{var i=e;et(e=new I(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=wt(o,r,!0,e)&&i}if(i=wt(o=e.g=t,r,!0,e)&&i,i=wt(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=wt(o=e.g=n[s],r,!1,e)&&i}function wt(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,u=o.la||o.src;o.ia&&rt(t.i,o),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}_(yt,b),yt.prototype[Q]=!0,yt.prototype.removeEventListener=function(t,e,n,r){lt(this,t,e,n,r)},yt.prototype.N=function(){if(yt.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Y(n[r]);delete e.g[t],e.h--}}this.J=null},yt.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},yt.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var _t=h.JSON.stringify;function bt(){var t=kt;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Et=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Tt),(t=>t.reset()));class Tt{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function St(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function It(t){h.setTimeout((()=>{throw t}),0)}let Ct,At=!1,kt=new class{constructor(){this.h=this.g=null}add(t,e){const n=Et.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Dt=()=>{const t=h.Promise.resolve(void 0);Ct=()=>{t.then(Nt)}};var Nt=()=>{for(var t;t=bt();){try{t.h.call(t.g)}catch(t){It(t)}var e=Et;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}At=!1};function Rt(t,e){yt.call(this),this.h=t||1,this.g=e||h,this.j=v(this.qb,this),this.l=Date.now()}function xt(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Ot(t,e,n){if("function"==typeof t)n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:h.setTimeout(t,e||0)}function Lt(t){t.g=Ot((()=>{t.g=null,t.i&&(t.i=!1,Lt(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}_(Rt,yt),(r=Rt.prototype).ga=!1,r.T=null,r.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),vt(this,"tick"),this.ga&&(xt(this),this.start()))}},r.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},r.N=function(){Rt.$.N.call(this),xt(this),delete this.g};class Pt extends b{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Lt(this)}N(){super.N(),this.g&&(h.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Mt(t){b.call(this),this.h=t,this.g={}}_(Mt,b);var Vt=[];function Ft(t,e,n,r){Array.isArray(n)||(n&&(Vt[0]=n.toString()),n=Vt);for(var i=0;i<n.length;i++){var s=at(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Ut(t){J(t.g,(function(t,e){this.g.hasOwnProperty(e)&&ht(t)}),t),t.g={}}function Bt(){this.g=!0}function qt(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return _t(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Mt.prototype.N=function(){Mt.$.N.call(this),Ut(this)},Mt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Bt.prototype.Ea=function(){this.g=!1},Bt.prototype.info=function(){};var jt={},zt=null;function $t(){return zt=zt||new yt}function Ht(t){I.call(this,jt.Ta,t)}function Kt(t){const e=$t();vt(e,new Ht(e))}function Gt(t,e){I.call(this,jt.STAT_EVENT,t),this.stat=e}function Qt(t){const e=$t();vt(e,new Gt(e,t))}function Wt(t,e){I.call(this,jt.Ua,t),this.size=e}function Xt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return h.setTimeout((function(){t()}),e)}jt.Ta="serverreachability",_(Ht,I),jt.STAT_EVENT="statevent",_(Gt,I),jt.Ua="timingevent",_(Wt,I);var Yt={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Jt={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Zt(){}function te(t){return t.h||(t.h=t.i())}function ee(){}Zt.prototype.h=null;var ne,re={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ie(){I.call(this,"d")}function se(){I.call(this,"c")}function oe(){}function ae(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Mt(this),this.P=ce,t=V?125:void 0,this.V=new Rt(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new ue}function ue(){this.i=null,this.g="",this.h=!1}_(ie,I),_(se,I),_(oe,Zt),oe.prototype.g=function(){return new XMLHttpRequest},oe.prototype.i=function(){return{}},ne=new oe;var ce=45e3,le={},he={};function de(t,e,n){t.L=1,t.A=Re(Ce(e)),t.u=n,t.S=!0,fe(t,null)}function fe(t,e){t.G=Date.now(),ye(t),t.B=Ce(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),$e(n.i,"t",r),t.o=0,n=t.l.J,t.h=new ue,t.g=Hn(t.l,n?e:null,!t.u),0<t.O&&(t.M=new Pt(v(t.Pa,t,t.g),t.O)),Ft(t.U,t.g,"readystatechange",t.nb),e=t.I?Z(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),Kt(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function pe(t){return!!t.g&&("GET"==t.v&&2!=t.L&&t.l.Ha)}function me(t,e,n){let r,i=!0;for(;!t.J&&t.o<n.length;){if(r=ge(t,n),r==he){4==e&&(t.s=4,Qt(14),i=!1),qt(t.j,t.m,null,"[Incomplete Response]");break}if(r==le){t.s=4,Qt(15),qt(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}qt(t.j,t.m,r,null),Ee(t,r)}pe(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,Qt(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Vn(e),e.M=!0,Qt(11))):(qt(t.j,t.m,n,"[Invalid Chunked Response]"),be(t),_e(t))}function ge(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?he:(n=Number(e.substring(n,r)),isNaN(n)?le:(r+=1)+n>e.length?he:(e=e.slice(r,r+n),t.o=r+n,e))}function ye(t){t.Y=Date.now()+t.P,ve(t,t.P)}function ve(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=Xt(v(t.lb,t),e)}function we(t){t.C&&(h.clearTimeout(t.C),t.C=null)}function _e(t){0==t.l.H||t.J||Bn(t.l,t)}function be(t){we(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,xt(t.V),Ut(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Ee(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||Ye(n.i,t)))if(!t.K&&Ye(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Un(n),Dn(n)}Mn(n),Qt(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=Xt(v(n.ib,n),6e3));if(1>=Xe(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else jn(n,11)}else if((t.K||n.g==t)&&Un(n),!A(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const e=c[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=c[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const l=c[5];null!=l&&"number"==typeof l&&0<l&&(r=1.5*l,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Je(s,s.h),s.h=null))}if(r.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Ne(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=$n(r,r.J?r.pa:null,r.Y),o.K){Ze(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(we(a),ye(a)),r.g=o}else Pn(r);0<n.j.length&&Rn(n)}else"stop"!=c[0]&&"close"!=c[0]||jn(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?jn(n,7):kn(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}Kt()}catch(t){}}function Te(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(d(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(d(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(d(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}(r=ae.prototype).setTimeout=function(t){this.P=t},r.nb=function(t){t=t.target;const e=this.M;e&&3==En(t)?e.l():this.Pa(t)},r.Pa=function(t){try{if(t==this.g)t:{const l=En(this.g);var e=this.g.Ia();this.g.da();if(!(3>l)&&(3!=l||V||this.g&&(this.h.h||this.g.ja()||Tn(this.g)))){this.J||4!=l||7==e||Kt(),we(this);var n=this.g.da();this.ca=n;e:if(pe(this)){var r=Tn(this.g);t="";var i=r.length,s=4==En(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){be(this),_e(this);var o="";break e}this.h.i=new h.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,l,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!A(a)){var c=a;break e}}c=null}if(!(n=c)){this.i=!1,this.s=3,Qt(12),be(this),_e(this);break t}qt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ee(this,n)}this.S?(me(this,l,o),V&&this.i&&3==l&&(Ft(this.U,this.V,"tick",this.mb),this.V.start())):(qt(this.j,this.m,o,null),Ee(this,o)),4==l&&be(this),this.i&&!this.J&&(4==l?Bn(this.l,this):(this.i=!1,ye(this)))}else(function(t){const e={};t=(t.g&&2<=En(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(A(t[r]))continue;var n=St(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,Qt(12)):(this.s=0,Qt(13)),be(this),_e(this)}}}catch(t){}},r.mb=function(){if(this.g){var t=En(this.g),e=this.g.ja();this.o<e.length&&(we(this),me(this,t,e),this.i&&4!=t&&ye(this))}},r.cancel=function(){this.J=!0,be(this)},r.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(Kt(),Qt(17)),be(this),this.s=2,_e(this)):ve(this,this.Y-t)};var Se=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Ie(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Ie){this.h=t.h,Ae(this,t.j),this.s=t.s,this.g=t.g,ke(this,t.m),this.l=t.l;var e=t.i,n=new Be;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),De(this,n),this.o=t.o}else t&&(e=String(t).match(Se))?(this.h=!1,Ae(this,e[1]||"",!0),this.s=xe(e[2]||""),this.g=xe(e[3]||"",!0),ke(this,e[4]),this.l=xe(e[5]||"",!0),De(this,e[6]||"",!0),this.o=xe(e[7]||"")):(this.h=!1,this.i=new Be(null,this.h))}function Ce(t){return new Ie(t)}function Ae(t,e,n){t.j=n?xe(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function De(t,e,n){e instanceof Be?(t.i=e,function(t,e){e&&!t.j&&(qe(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(je(this,e),$e(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Oe(e,Fe)),t.i=new Be(e,t.h))}function Ne(t,e,n){t.i.set(e,n)}function Re(t){return Ne(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function xe(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Oe(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Le),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Le(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ie.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Oe(e,Pe,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Oe(e,Pe,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Oe(n,"/"==n.charAt(0)?Ve:Me,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Oe(n,Ue)),t.join("")};var Pe=/[#\/\?@]/g,Me=/[#\?:]/g,Ve=/[#\?]/g,Fe=/[#\?@]/g,Ue=/#/g;function Be(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function qe(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function je(t,e){qe(t),e=He(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function ze(t,e){return qe(t),e=He(t,e),t.g.has(e)}function $e(t,e,n){je(t,e),0<n.length&&(t.i=null,t.g.set(He(t,e),T(n)),t.h+=n.length)}function He(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(r=Be.prototype).add=function(t,e){qe(this),this.i=null,t=He(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},r.forEach=function(t,e){qe(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},r.ta=function(){qe(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},r.Z=function(t){qe(this);let e=[];if("string"==typeof t)ze(this,t)&&(e=e.concat(this.g.get(He(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},r.set=function(t,e){return qe(this),this.i=null,ze(this,t=He(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},r.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},r.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};var Ke=class{constructor(t,e){this.g=t,this.map=e}};function Ge(t){this.l=t||Qe,h.PerformanceNavigationTiming?t=0<(t=h.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(h.g&&h.g.Ka&&h.g.Ka()&&h.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Qe=10;function We(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Xe(t){return t.h?1:t.g?t.g.size:0}function Ye(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Je(t,e){t.g?t.g.add(e):t.h=e}function Ze(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function tn(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return T(t.i)}Ge.prototype.cancel=function(){if(this.i=tn(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var en=class{stringify(t){return h.JSON.stringify(t,void 0)}parse(t){return h.JSON.parse(t,void 0)}};function nn(){this.g=new en}function rn(t,e,n){const r=n||"";try{Te(t,(function(t,n){let i=t;f(t)&&(i=_t(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function sn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function on(t){this.l=t.ec||null,this.j=t.ob||!1}function an(t,e){yt.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=un,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}_(on,Zt),on.prototype.g=function(){return new an(this.l,this.j)},on.prototype.i=function(t){return function(){return t}}({}),_(an,yt);var un=0;function cn(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function ln(t){t.readyState=4,t.l=null,t.j=null,t.A=null,hn(t)}function hn(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(r=an.prototype).open=function(t,e){if(this.readyState!=un)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,hn(this)},r.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||h).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},r.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,ln(this)),this.readyState=un},r.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,hn(this)),this.g&&(this.readyState=3,hn(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==h.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;cn(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},r.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?ln(this):hn(this),3==this.readyState&&cn(this)}},r.Za=function(t){this.g&&(this.response=this.responseText=t,ln(this))},r.Ya=function(t){this.g&&(this.response=t,ln(this))},r.ka=function(){this.g&&ln(this)},r.setRequestHeader=function(t,e){this.v.append(t,e)},r.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(an.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var dn=h.JSON.parse;function fn(t){yt.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=pn,this.L=this.M=!1}_(fn,yt);var pn="",mn=/^https?$/i,gn=["POST","PUT"];function yn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,vn(t),_n(t)}function vn(t){t.F||(t.F=!0,vt(t,"complete"),vt(t,"error"))}function wn(t){if(t.h&&void 0!==l&&(!t.C[1]||4!=En(t)||2!=t.da()))if(t.v&&4==En(t))Ot(t.La,0,t);else if(vt(t,"readystatechange"),4==En(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var i=String(t.I).match(Se)[1]||null;!i&&h.self&&h.self.location&&(i=h.self.location.protocol.slice(0,-1)),r=!mn.test(i?i.toLowerCase():"")}n=r}if(n)vt(t,"complete"),vt(t,"success");else{t.m=6;try{var s=2<En(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",vn(t)}}finally{_n(t)}}}function _n(t,e){if(t.g){bn(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||vt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function bn(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(h.clearTimeout(t.A),t.A=null)}function En(t){return t.g?t.g.readyState:0}function Tn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case pn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Sn(t){let e="";return J(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function In(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Sn(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ne(t,e,n))}function Cn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function An(t){this.Ga=0,this.j=[],this.l=new Bt,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Cn("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Cn("baseRetryDelayMs",5e3,t),this.hb=Cn("retryDelaySeedMs",1e4,t),this.eb=Cn("forwardChannelMaxRetries",2,t),this.xa=Cn("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Ge(t&&t.concurrentRequestLimit),this.Ja=new nn,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function kn(t){if(Nn(t),3==t.H){var e=t.W++,n=Ce(t.I);if(Ne(n,"SID",t.K),Ne(n,"RID",e),Ne(n,"TYPE","terminate"),On(t,n),(e=new ae(t,t.l,e)).L=2,e.A=Re(Ce(n)),n=!1,h.navigator&&h.navigator.sendBeacon)try{n=h.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&h.Image&&((new Image).src=e.A,n=!0),n||(e.g=Hn(e.l,null),e.g.ha(e.A)),e.G=Date.now(),ye(e)}zn(t)}function Dn(t){t.g&&(Vn(t),t.g.cancel(),t.g=null)}function Nn(t){Dn(t),t.u&&(h.clearTimeout(t.u),t.u=null),Un(t),t.i.cancel(),t.m&&("number"==typeof t.m&&h.clearTimeout(t.m),t.m=null)}function Rn(t){if(!We(t.i)&&!t.m){t.m=!0;var e=t.Na;Ct||Dt(),At||(Ct(),At=!0),kt.add(e,t),t.C=0}}function xn(t,e){var n;n=e?e.m:t.W++;const r=Ce(t.I);Ne(r,"SID",t.K),Ne(r,"RID",n),Ne(r,"AID",t.V),On(t,r),t.o&&t.s&&In(r,t.o,t.s),n=new ae(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Ln(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),Je(t.i,n),de(n,r,e)}function On(t,e){t.na&&J(t.na,(function(t,n){Ne(e,n,t)})),t.h&&Te({},(function(t,n){Ne(e,n,t)}))}function Ln(t,e,n){n=Math.min(t.j.length,n);var r=t.h?v(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{rn(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function Pn(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ct||Dt(),At||(Ct(),At=!0),kt.add(e,t),t.A=0}}function Mn(t){return!(t.g||t.u||3<=t.A)&&(t.ba++,t.u=Xt(v(t.Ma,t),qn(t,t.A)),t.A++,!0)}function Vn(t){null!=t.B&&(h.clearTimeout(t.B),t.B=null)}function Fn(t){t.g=new ae(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ce(t.wa);Ne(e,"RID","rpc"),Ne(e,"SID",t.K),Ne(e,"AID",t.V),Ne(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Ne(e,"TO",t.qa),Ne(e,"TYPE","xmlhttp"),On(t,e),t.o&&t.s&&In(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=Re(Ce(e)),n.u=null,n.S=!0,fe(n,t)}function Un(t){null!=t.v&&(h.clearTimeout(t.v),t.v=null)}function Bn(t,e){var n=null;if(t.g==e){Un(t),Vn(t),t.g=null;var r=2}else{if(!Ye(t.i,e))return;n=e.F,Ze(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;vt(r=$t(),new Wt(r,n)),Rn(t)}else Pn(t);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function(t,e){return!(Xe(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=Xt(v(t.Na,t,e),qn(t,t.C)),t.C++,0)))}(t,e)||2==r&&Mn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:jn(t,5);break;case 4:jn(t,10);break;case 3:jn(t,6);break;default:jn(t,2)}}function qn(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function jn(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=v(t.pb,t);n||(n=new Ie("//www.google.com/images/cleardot.gif"),h.location&&"http"==h.location.protocol||Ae(n,"https"),Re(n)),function(t,e){const n=new Bt;if(h.Image){const r=new Image;r.onload=w(sn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=w(sn,n,r,"TestLoadImage: error",!1,e),r.onabort=w(sn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=w(sn,n,r,"TestLoadImage: timeout",!1,e),h.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else Qt(2);t.H=0,t.h&&t.h.za(e),zn(t),Nn(t)}function zn(t){if(t.H=0,t.ma=[],t.h){const e=tn(t.i);0==e.length&&0==t.j.length||(S(t.ma,e),S(t.ma,t.j),t.i.i.length=0,T(t.j),t.j.length=0),t.h.ya()}}function $n(t,e,n){var r=n instanceof Ie?Ce(n):new Ie(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ke(r,r.m);else{var i=h.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Ie(null);r&&Ae(s,r),e&&(s.g=e),i&&ke(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Ne(r,n,e),Ne(r,"VER",t.ra),On(t,r),r}function Hn(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new fn(new on({ob:n})):new fn(t.va)).Oa(t.J),e}function Kn(){}function Gn(){if(P&&!(10<=Number(H)))throw Error("Environmental error: no available transport.")}function Qn(t,e){yt.call(this),this.g=new An(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!A(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!A(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&(e in(t=this.h)&&delete t[e])),this.j=new Yn(this)}function Wn(t){ie.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Xn(){se.call(this),this.status=1}function Yn(t){this.g=t}function Jn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function Zn(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function tr(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}(r=fn.prototype).Oa=function(t){this.M=t},r.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ne.g(),this.C=this.u?te(this.u):te(ne),this.g.onreadystatechange=v(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void yn(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=h.FormData&&t instanceof h.FormData,!(0<=E(gn,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{bn(this),0<this.B&&((this.L=function(t){return P&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.ua,this)):this.A=Ot(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){yn(this,t)}},r.ua=function(){void 0!==l&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,vt(this,"timeout"),this.abort(8))},r.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,vt(this,"complete"),vt(this,"abort"),_n(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),_n(this,!0)),fn.$.N.call(this)},r.La=function(){this.s||(this.G||this.v||this.l?wn(this):this.kb())},r.kb=function(){wn(this)},r.isActive=function(){return!!this.g},r.da=function(){try{return 2<En(this)?this.g.status:-1}catch(t){return-1}},r.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},r.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dn(e)}},r.Ia=function(){return this.m},r.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(r=An.prototype).ra=8,r.H=1,r.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new ae(this,this.l,t);let s=this.s;if(this.U&&(s?(s=Z(s),et(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Ln(this,i,e),Ne(n=Ce(this.I),"RID",t),Ne(n,"CVER",22),this.F&&Ne(n,"X-HTTP-Session-Id",this.F),On(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Sn(s)))+"&"+e:this.o&&In(n,this.o,s)),Je(this.i,i),this.bb&&Ne(n,"TYPE","init"),this.P?(Ne(n,"$req",e),Ne(n,"SID","null"),i.aa=!0,de(i,n,null)):de(i,n,e),this.H=2}}else 3==this.H&&(t?xn(this,t):0==this.j.length||We(this.i)||xn(this))},r.Ma=function(){if(this.u=null,Fn(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=Xt(v(this.jb,this),t)}},r.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Qt(10),Dn(this),Fn(this))},r.ib=function(){null!=this.v&&(this.v=null,Dn(this),Mn(this),Qt(19))},r.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Qt(2)):(this.l.info("Failed to ping google.com"),Qt(1))},r.isActive=function(){return!!this.h&&this.h.isActive(this)},(r=Kn.prototype).Ba=function(){},r.Aa=function(){},r.za=function(){},r.ya=function(){},r.isActive=function(){return!0},r.Va=function(){},Gn.prototype.g=function(t,e){return new Qn(t,e)},_(Qn,yt),Qn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Qt(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=$n(t,null,t.Y),Rn(t)},Qn.prototype.close=function(){kn(this.g)},Qn.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=_t(t),t=n);e.j.push(new Ke(e.fb++,t)),3==e.H&&Rn(e)},Qn.prototype.N=function(){this.g.h=null,delete this.j,kn(this.g),delete this.g,Qn.$.N.call(this)},_(Wn,ie),_(Xn,se),_(Yn,Kn),Yn.prototype.Ba=function(){vt(this.g,"a")},Yn.prototype.Aa=function(t){vt(this.g,new Wn(t))},Yn.prototype.za=function(t){vt(this.g,new Xn)},Yn.prototype.ya=function(){vt(this.g,"b")},_(Jn,(function(){this.blockSize=-1})),Jn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},Jn.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=n;)Zn(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){Zn(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){Zn(this,r),i=0;break}}this.h=i,this.i+=e},Jn.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var er={};function nr(t){return-128<=t&&128>t?function(t,e){var n=er;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,(function(t){return new tr([0|t],0>t?-1:0)})):new tr([0|t],0>t?-1:0)}function rr(t){if(isNaN(t)||!isFinite(t))return sr;if(0>t)return lr(rr(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=ir;return new tr(e,0)}var ir=4294967296,sr=nr(0),or=nr(1),ar=nr(16777216);function ur(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function cr(t){return-1==t.h}function lr(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new tr(n,~t.h).add(or)}function hr(t,e){return t.add(lr(e))}function dr(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function fr(t,e){this.g=t,this.h=e}function pr(t,e){if(ur(e))throw Error("division by zero");if(ur(t))return new fr(sr,sr);if(cr(t))return e=pr(lr(t),e),new fr(lr(e.g),lr(e.h));if(cr(e))return e=pr(t,lr(e)),new fr(lr(e.g),e.h);if(30<t.g.length){if(cr(t)||cr(e))throw Error("slowDivide_ only works with positive integers.");for(var n=or,r=e;0>=r.X(t);)n=mr(n),r=mr(r);var i=gr(n,1),s=gr(r,1);for(r=gr(r,2),n=gr(n,2);!ur(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=gr(r,1),n=gr(n,1)}return e=hr(t,i.R(e)),new fr(i,e)}for(i=sr;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=rr(n)).R(e);cr(o)||0<o.X(t);)o=(s=rr(n-=r)).R(e);ur(s)&&(s=or),i=i.add(s),t=hr(t,o)}return new fr(i,t)}function mr(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new tr(n,t.h)}function gr(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new tr(i,t.h)}(r=tr.prototype).ea=function(){if(cr(this))return-lr(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:ir+r)*e,e*=ir}return t},r.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(ur(this))return"0";if(cr(this))return"-"+lr(this).toString(t);for(var e=rr(Math.pow(t,6)),n=this,r="";;){var i=pr(n,e).g,s=((0<(n=hr(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(ur(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},r.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},r.X=function(t){return cr(t=hr(this,t))?-1:ur(t)?0:1},r.abs=function(){return cr(this)?lr(this):this},r.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&t.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new tr(n,-2147483648&n[n.length-1]?-1:0)},r.R=function(t){if(ur(this)||ur(t))return sr;if(cr(this))return cr(t)?lr(this).R(lr(t)):lr(lr(this).R(t));if(cr(t))return lr(this.R(lr(t)));if(0>this.X(ar)&&0>t.X(ar))return rr(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=t.D(i)>>>16,u=65535&t.D(i);n[2*r+2*i]+=o*u,dr(n,2*r+2*i),n[2*r+2*i+1]+=s*u,dr(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,dr(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,dr(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new tr(n,0)},r.gb=function(t){return pr(this,t).h},r.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new tr(n,this.h&t.h)},r.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new tr(n,this.h|t.h)},r.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new tr(n,this.h^t.h)},Gn.prototype.createWebChannel=Gn.prototype.g,Qn.prototype.send=Qn.prototype.u,Qn.prototype.open=Qn.prototype.m,Qn.prototype.close=Qn.prototype.close,Yt.NO_ERROR=0,Yt.TIMEOUT=8,Yt.HTTP_ERROR=6,Jt.COMPLETE="complete",ee.EventType=re,re.OPEN="a",re.CLOSE="b",re.ERROR="c",re.MESSAGE="d",yt.prototype.listen=yt.prototype.O,fn.prototype.listenOnce=fn.prototype.P,fn.prototype.getLastError=fn.prototype.Sa,fn.prototype.getLastErrorCode=fn.prototype.Ia,fn.prototype.getStatus=fn.prototype.da,fn.prototype.getResponseJson=fn.prototype.Wa,fn.prototype.getResponseText=fn.prototype.ja,fn.prototype.send=fn.prototype.ha,fn.prototype.setWithCredentials=fn.prototype.Oa,Jn.prototype.digest=Jn.prototype.l,Jn.prototype.reset=Jn.prototype.reset,Jn.prototype.update=Jn.prototype.j,tr.prototype.add=tr.prototype.add,tr.prototype.multiply=tr.prototype.R,tr.prototype.modulo=tr.prototype.gb,tr.prototype.compare=tr.prototype.X,tr.prototype.toNumber=tr.prototype.ea,tr.prototype.toString=tr.prototype.toString,tr.prototype.getBits=tr.prototype.D,tr.fromNumber=rr,tr.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return lr(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=rr(Math.pow(n,8)),i=sr,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=rr(Math.pow(n,o)),i=i.R(o).add(rr(a))):i=(i=i.R(r)).add(rr(a))}return i};var yr=c.createWebChannelTransport=function(){return new Gn},vr=c.getStatEventTarget=function(){return $t()},wr=c.ErrorCode=Yt,_r=c.EventType=Jt,br=c.Event=jt,Er=c.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Tr=(c.FetchXmlHttpFactory=on,c.WebChannel=ee),Sr=c.XhrIo=fn,Ir=c.Md5=Jn,Cr=c.Integer=tr;const Ar="@firebase/firestore";class kr{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}kr.UNAUTHENTICATED=new kr(null),kr.GOOGLE_CREDENTIALS=new kr("google-credentials-uid"),kr.FIRST_PARTY=new kr("first-party-uid"),kr.MOCK_USER=new kr("mock-user");let Dr="10.7.0";const Nr=new o.Yd("@firebase/firestore");function Rr(){return Nr.logLevel}function xr(t,...e){if(Nr.logLevel<=o.in.DEBUG){const n=e.map(Pr);Nr.debug(`Firestore (${Dr}): ${t}`,...n)}}function Or(t,...e){if(Nr.logLevel<=o.in.ERROR){const n=e.map(Pr);Nr.error(`Firestore (${Dr}): ${t}`,...n)}}function Lr(t,...e){if(Nr.logLevel<=o.in.WARN){const n=e.map(Pr);Nr.warn(`Firestore (${Dr}): ${t}`,...n)}}function Pr(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Mr(t="Unexpected state"){const e=`FIRESTORE (${Dr}) INTERNAL ASSERTION FAILED: `+t;throw Or(e),new Error(e)}function Vr(t,e){t||Mr()}function Fr(t,e){return t}const Ur={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Br extends a.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class qr{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class jr{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class zr{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(kr.UNAUTHENTICATED)))}shutdown(){}}class $r{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Hr{constructor(t){this.t=t,this.currentUser=kr.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new qr;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new qr,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{xr("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(xr("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new qr)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(xr("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Vr("string"==typeof e.accessToken),new jr(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Vr(null===t||"string"==typeof t),new kr(t)}}class Kr{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=kr.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Gr{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Kr(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(kr.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Qr{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Wr{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&xr("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,xr("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{xr("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):xr("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Vr("string"==typeof t.token),this.R=t.token,new Qr(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Xr(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Yr{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=Xr(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%62))}return n}}function Jr(t,e){return t<e?-1:t>e?1:0}function Zr(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class ti{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Br(Ur.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ti.fromMillis(Date.now())}static fromDate(t){return ti.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ti(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Jr(this.nanoseconds,t.nanoseconds):Jr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ei{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ei(t)}static min(){return new ei(new ti(0,0))}static max(){return new ei(new ti(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ni{constructor(t,e,n){void 0===e?e=0:e>t.length&&Mr(),void 0===n?n=t.length-e:n>t.length-e&&Mr(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ni.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ni?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ri extends ni{construct(t,e,n){return new ri(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Br(Ur.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ri(e)}static emptyPath(){return new ri([])}}const ii=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class si extends ni{construct(t,e,n){return new si(t,e,n)}static isValidIdentifier(t){return ii.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),si.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new si(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Br(Ur.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Br(Ur.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Br(Ur.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Br(Ur.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new si(e)}static emptyPath(){return new si([])}}class oi{constructor(t){this.path=t}static fromPath(t){return new oi(ri.fromString(t))}static fromName(t){return new oi(ri.fromString(t).popFirst(5))}static empty(){return new oi(ri.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ri.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ri.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new oi(new ri(t.slice()))}}class ai{constructor(t,e,n,r){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=r}}ai.UNKNOWN_ID=-1;function ui(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=ei.fromTimestamp(1e9===r?new ti(n+1,0):new ti(n,r));return new li(i,oi.empty(),e)}function ci(t){return new li(t.readTime,t.key,-1)}class li{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new li(ei.min(),oi.empty(),-1)}static max(){return new li(ei.max(),oi.empty(),-1)}}function hi(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=oi.comparator(t.documentKey,e.documentKey),0!==n?n:Jr(t.largestBatchId,e.largestBatchId))}const di="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fi{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function pi(t){if(t.code!==Ur.FAILED_PRECONDITION||t.message!==di)throw t;xr("LocalStore","Unexpectedly lost primary lease")}class mi{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Mr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new mi(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof mi?e:mi.resolve(e)}catch(t){return mi.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):mi.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):mi.reject(e)}static resolve(t){return new mi(((e,n)=>{e(t)}))}static reject(t){return new mi(((e,n)=>{n(t)}))}static waitFor(t){return new mi(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=mi.resolve(!1);for(const n of t)e=e.next((t=>t?mi.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new mi(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const u=a;e(t[u]).next((t=>{s[u]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new mi(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}function gi(t){return"IndexedDbTransactionError"===t.name}class yi{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function vi(t){return null==t}function wi(t){return 0===t&&1/t==-1/0}function _i(t){return"number"==typeof t&&Number.isInteger(t)&&!wi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}yi._e=-1;const bi=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ei=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ti=Ei;function Si(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ii(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ci(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Ai{constructor(t,e){this.comparator=t,this.root=e||Di.EMPTY}insert(t,e){return new Ai(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Di.BLACK,null,null))}remove(t){return new Ai(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Di.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new ki(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new ki(this.root,t,this.comparator,!1)}getReverseIterator(){return new ki(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new ki(this.root,t,this.comparator,!0)}}class ki{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Di{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Di.RED,this.left=null!=r?r:Di.EMPTY,this.right=null!=i?i:Di.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new Di(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Di.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Di.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Di.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Di.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Mr();if(this.right.isRed())throw Mr();const t=this.left.check();if(t!==this.right.check())throw Mr();return t+(this.isRed()?0:1)}}Di.EMPTY=null,Di.RED=!0,Di.BLACK=!1,Di.EMPTY=new class{constructor(){this.size=0}get key(){throw Mr()}get value(){throw Mr()}get color(){throw Mr()}get left(){throw Mr()}get right(){throw Mr()}copy(t,e,n,r,i){return this}insert(t,e,n){return new Di(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ni{constructor(t){this.comparator=t,this.data=new Ai(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ri(this.data.getIterator())}getIteratorFrom(t){return new Ri(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ni))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ni(this.comparator);return e.data=t,e}}class Ri{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class xi{constructor(t){this.fields=t,t.sort(si.comparator)}static empty(){return new xi([])}unionWith(t){let e=new Ni(si.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new xi(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Zr(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Oi extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Li{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Oi("Invalid base64 string: "+t):t}}(t);return new Li(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Li(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Jr(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Li.EMPTY_BYTE_STRING=new Li("");const Pi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mi(t){if(Vr(!!t),"string"==typeof t){let e=0;const n=Pi.exec(t);if(Vr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Vi(t.seconds),nanos:Vi(t.nanos)}}function Vi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Fi(t){return"string"==typeof t?Li.fromBase64String(t):Li.fromUint8Array(t)}function Ui(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Bi(t){const e=t.mapValue.fields.__previous_value__;return Ui(e)?Bi(e):e}function qi(t){const e=Mi(t.mapValue.fields.__local_write_time__.timestampValue);return new ti(e.seconds,e.nanos)}class ji{constructor(t,e,n,r,i,s,o,a,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=u}}class zi{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new zi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof zi&&t.projectId===this.projectId&&t.database===this.database}}const $i={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Hi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ui(t)?4:is(t)?9007199254740991:10:Mr()}function Ki(t,e){if(t===e)return!0;const n=Hi(t);if(n!==Hi(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return qi(t).isEqual(qi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Mi(t.timestampValue),r=Mi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Fi(t.bytesValue).isEqual(Fi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Vi(t.geoPointValue.latitude)===Vi(e.geoPointValue.latitude)&&Vi(t.geoPointValue.longitude)===Vi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Vi(t.integerValue)===Vi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Vi(t.doubleValue),r=Vi(e.doubleValue);return n===r?wi(n)===wi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Zr(t.arrayValue.values||[],e.arrayValue.values||[],Ki);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Si(n)!==Si(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Ki(n[t],r[t])))return!1;return!0}(t,e);default:return Mr()}}function Gi(t,e){return void 0!==(t.values||[]).find((t=>Ki(t,e)))}function Qi(t,e){if(t===e)return 0;const n=Hi(t),r=Hi(e);if(n!==r)return Jr(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Jr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Vi(t.integerValue||t.doubleValue),r=Vi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Wi(t.timestampValue,e.timestampValue);case 4:return Wi(qi(t),qi(e));case 5:return Jr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Fi(t),r=Fi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Jr(n[t],r[t]);if(0!==e)return e}return Jr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Jr(Vi(t.latitude),Vi(e.latitude));return 0!==n?n:Jr(Vi(t.longitude),Vi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Qi(n[t],r[t]);if(e)return e}return Jr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===$i.mapValue&&e===$i.mapValue)return 0;if(t===$i.mapValue)return 1;if(e===$i.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=Jr(r[t],s[t]);if(0!==e)return e;const o=Qi(n[r[t]],i[s[t]]);if(0!==o)return o}return Jr(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Mr()}}function Wi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Jr(t,e);const n=Mi(t),r=Mi(e),i=Jr(n.seconds,r.seconds);return 0!==i?i:Jr(n.nanos,r.nanos)}function Xi(t){return Yi(t)}function Yi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Mi(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Fi(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return oi.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Yi(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Yi(t.fields[i])}`;return n+"}"}(t.mapValue):Mr()}function Ji(t){return!!t&&"integerValue"in t}function Zi(t){return!!t&&"arrayValue"in t}function ts(t){return!!t&&"nullValue"in t}function es(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function ns(t){return!!t&&"mapValue"in t}function rs(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ii(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=rs(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=rs(t.arrayValue.values[n]);return e}return Object.assign({},t)}function is(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class ss{constructor(t){this.value=t}static empty(){return new ss({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ns(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=rs(e)}setAll(t){let e=si.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=rs(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());ns(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ki(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];ns(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ii(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new ss(rs(this.value))}}function os(t){const e=[];return Ii(t.fields,((t,n)=>{const r=new si([t]);if(ns(n)){const t=os(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new xi(e)}class as{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new as(t,0,ei.min(),ei.min(),ei.min(),ss.empty(),0)}static newFoundDocument(t,e,n,r){return new as(t,1,e,ei.min(),n,r,0)}static newNoDocument(t,e){return new as(t,2,e,ei.min(),ei.min(),ss.empty(),0)}static newUnknownDocument(t,e){return new as(t,3,e,ei.min(),ei.min(),ss.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ei.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ss.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ss.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ei.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof as&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new as(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class us{constructor(t,e){this.position=t,this.inclusive=e}}function cs(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?oi.comparator(oi.fromName(o.referenceValue),n.key):Qi(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function ls(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ki(t.position[n],e.position[n]))return!1;return!0}class hs{constructor(t,e="asc"){this.field=t,this.dir=e}}function ds(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class fs{}class ps extends fs{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Es(t,e,n):"array-contains"===e?new Cs(t,n):"in"===e?new As(t,n):"not-in"===e?new ks(t,n):"array-contains-any"===e?new Ds(t,n):new ps(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ts(t,n):new Ss(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Qi(e,this.value)):null!==e&&Hi(this.value)===Hi(e)&&this.matchesComparison(Qi(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Mr()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class ms extends fs{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new ms(t,e)}matches(t){return gs(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function gs(t){return"and"===t.op}function ys(t){return vs(t)&&gs(t)}function vs(t){for(const e of t.filters)if(e instanceof ms)return!1;return!0}function ws(t){if(t instanceof ps)return t.field.canonicalString()+t.op.toString()+Xi(t.value);if(ys(t))return t.filters.map((t=>ws(t))).join(",");{const e=t.filters.map((t=>ws(t))).join(",");return`${t.op}(${e})`}}function _s(t,e){return t instanceof ps?function(t,e){return e instanceof ps&&t.op===e.op&&t.field.isEqual(e.field)&&Ki(t.value,e.value)}(t,e):t instanceof ms?function(t,e){return e instanceof ms&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&_s(n,e.filters[r])),!0)}(t,e):void Mr()}function bs(t){return t instanceof ps?function(t){return`${t.field.canonicalString()} ${t.op} ${Xi(t.value)}`}(t):t instanceof ms?function(t){return t.op.toString()+" {"+t.getFilters().map(bs).join(" ,")+"}"}(t):"Filter"}class Es extends ps{constructor(t,e,n){super(t,e,n),this.key=oi.fromName(n.referenceValue)}matches(t){const e=oi.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ts extends ps{constructor(t,e){super(t,"in",e),this.keys=Is("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Ss extends ps{constructor(t,e){super(t,"not-in",e),this.keys=Is("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Is(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>oi.fromName(t.referenceValue)))}class Cs extends ps{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Zi(e)&&Gi(e.arrayValue,this.value)}}class As extends ps{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Gi(this.value.arrayValue,e)}}class ks extends ps{constructor(t,e){super(t,"not-in",e)}matches(t){if(Gi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Gi(this.value.arrayValue,e)}}class Ds extends ps{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Zi(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Gi(this.value.arrayValue,t)))}}class Ns{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function Rs(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Ns(t,e,n,r,i,s,o)}function xs(t){const e=Fr(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ws(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),vi(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Xi(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Xi(t))).join(",")),e.ce=t}return e.ce}function Os(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ds(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!_s(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ls(t.startAt,e.startAt)&&ls(t.endAt,e.endAt)}function Ls(t){return oi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ps{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Ms(t,e,n,r,i,s,o,a){return new Ps(t,e,n,r,i,s,o,a)}function Vs(t){return new Ps(t)}function Fs(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Us(t){return null!==t.collectionGroup}function Bs(t){const e=Fr(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Ni(si.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new hs(r,n))})),t.has(si.keyField().canonicalString())||e.le.push(new hs(si.keyField(),n))}return e.le}function qs(t){const e=Fr(t);return e.he||(e.he=js(e,Bs(t))),e.he}function js(t,e){if("F"===t.limitType)return Rs(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new hs(t.field,e)}));const n=t.endAt?new us(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new us(t.startAt.position,t.startAt.inclusive):null;return Rs(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function zs(t,e,n){return new Ps(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function $s(t,e){return Os(qs(t),qs(e))&&t.limitType===e.limitType}function Hs(t){return`${xs(qs(t))}|lt:${t.limitType}`}function Ks(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>bs(t))).join(", ")}]`),vi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Xi(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Xi(t))).join(",")),`Target(${e})`}(qs(t))}; limitType=${t.limitType})`}function Gs(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):oi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Bs(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=cs(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Bs(t),e))&&!(t.endAt&&!function(t,e,n){const r=cs(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Bs(t),e))}(t,e)}function Qs(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Ws(t){return(e,n)=>{let r=!1;for(const i of Bs(t)){const t=Xs(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Xs(t,e,n){const r=t.field.isKeyField()?oi.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Qi(r,i):Mr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Mr()}}class Ys{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ii(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return Ci(this.inner)}size(){return this.innerSize}}const Js=new Ai(oi.comparator);function Zs(){return Js}const to=new Ai(oi.comparator);function eo(...t){let e=to;for(const n of t)e=e.insert(n.key,n);return e}function no(t){let e=to;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ro(){return so()}function io(){return so()}function so(){return new Ys((t=>t.toString()),((t,e)=>t.isEqual(e)))}const oo=new Ai(oi.comparator),ao=new Ni(oi.comparator);function uo(...t){let e=ao;for(const n of t)e=e.add(n);return e}const co=new Ni(Jr);function lo(){return co}function ho(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wi(e)?"-0":e}}function fo(t){return{integerValue:""+t}}function po(t,e){return _i(e)?fo(e):ho(t,e)}class mo{constructor(){this._=void 0}}function go(t,e,n){return t instanceof wo?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ui(e)&&(e=Bi(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof _o?bo(t,e):t instanceof Eo?To(t,e):function(t,e){const n=vo(t,e),r=Io(n)+Io(t.Ie);return Ji(n)&&Ji(t.Ie)?fo(r):ho(t.serializer,r)}(t,e)}function yo(t,e,n){return t instanceof _o?bo(t,e):t instanceof Eo?To(t,e):n}function vo(t,e){return t instanceof So?function(t){return Ji(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class wo extends mo{}class _o extends mo{constructor(t){super(),this.elements=t}}function bo(t,e){const n=Co(e);for(const e of t.elements)n.some((t=>Ki(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Eo extends mo{constructor(t){super(),this.elements=t}}function To(t,e){let n=Co(e);for(const e of t.elements)n=n.filter((t=>!Ki(t,e)));return{arrayValue:{values:n}}}class So extends mo{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Io(t){return Vi(t.integerValue||t.doubleValue)}function Co(t){return Zi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ao{constructor(t,e){this.version=t,this.transformResults=e}}class ko{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ko}static exists(t){return new ko(void 0,t)}static updateTime(t){return new ko(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Do(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class No{}function Ro(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new qo(t.key,ko.none()):new Mo(t.key,t.data,ko.none());{const n=t.data,r=ss.empty();let i=new Ni(si.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Vo(t.key,r,new xi(i.toArray()),ko.none())}}function xo(t,e,n){t instanceof Mo?function(t,e,n){const r=t.value.clone(),i=Uo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Vo?function(t,e,n){if(!Do(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Uo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Fo(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Oo(t,e,n,r){return t instanceof Mo?function(t,e,n,r){if(!Do(t.precondition,e))return n;const i=t.value.clone(),s=Bo(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Vo?function(t,e,n,r){if(!Do(t.precondition,e))return n;const i=Bo(t.fieldTransforms,r,e),s=e.data;return s.setAll(Fo(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Do(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Lo(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=vo(r.transform,t||null);null!=i&&(null===n&&(n=ss.empty()),n.set(r.field,i))}return n||null}function Po(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Zr(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof _o&&e instanceof _o||t instanceof Eo&&e instanceof Eo?Zr(t.elements,e.elements,Ki):t instanceof So&&e instanceof So?Ki(t.Ie,e.Ie):t instanceof wo&&e instanceof wo}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Mo extends No{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Vo extends No{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Fo(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Uo(t,e,n){const r=new Map;Vr(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,yo(o,a,n[i]))}return r}function Bo(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,go(t,s,e))}return r}class qo extends No{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class jo extends No{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class zo{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&xo(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Oo(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Oo(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=io();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=Ro(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(ei.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),uo())}isEqual(t){return this.batchId===t.batchId&&Zr(this.mutations,t.mutations,((t,e)=>Po(t,e)))&&Zr(this.baseMutations,t.baseMutations,((t,e)=>Po(t,e)))}}class $o{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Vr(t.mutations.length===n.length);let r=oo;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new $o(t,e,n,r)}}class Ho{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ko{constructor(t,e){this.count=t,this.unchangedNames=e}}var Go,Qo;function Wo(t){switch(t){default:return Mr();case Ur.CANCELLED:case Ur.UNKNOWN:case Ur.DEADLINE_EXCEEDED:case Ur.RESOURCE_EXHAUSTED:case Ur.INTERNAL:case Ur.UNAVAILABLE:case Ur.UNAUTHENTICATED:return!1;case Ur.INVALID_ARGUMENT:case Ur.NOT_FOUND:case Ur.ALREADY_EXISTS:case Ur.PERMISSION_DENIED:case Ur.FAILED_PRECONDITION:case Ur.ABORTED:case Ur.OUT_OF_RANGE:case Ur.UNIMPLEMENTED:case Ur.DATA_LOSS:return!0}}function Xo(t){if(void 0===t)return Or("GRPC error has no .code"),Ur.UNKNOWN;switch(t){case Go.OK:return Ur.OK;case Go.CANCELLED:return Ur.CANCELLED;case Go.UNKNOWN:return Ur.UNKNOWN;case Go.DEADLINE_EXCEEDED:return Ur.DEADLINE_EXCEEDED;case Go.RESOURCE_EXHAUSTED:return Ur.RESOURCE_EXHAUSTED;case Go.INTERNAL:return Ur.INTERNAL;case Go.UNAVAILABLE:return Ur.UNAVAILABLE;case Go.UNAUTHENTICATED:return Ur.UNAUTHENTICATED;case Go.INVALID_ARGUMENT:return Ur.INVALID_ARGUMENT;case Go.NOT_FOUND:return Ur.NOT_FOUND;case Go.ALREADY_EXISTS:return Ur.ALREADY_EXISTS;case Go.PERMISSION_DENIED:return Ur.PERMISSION_DENIED;case Go.FAILED_PRECONDITION:return Ur.FAILED_PRECONDITION;case Go.ABORTED:return Ur.ABORTED;case Go.OUT_OF_RANGE:return Ur.OUT_OF_RANGE;case Go.UNIMPLEMENTED:return Ur.UNIMPLEMENTED;case Go.DATA_LOSS:return Ur.DATA_LOSS;default:return Mr()}}(Qo=Go||(Go={}))[Qo.OK=0]="OK",Qo[Qo.CANCELLED=1]="CANCELLED",Qo[Qo.UNKNOWN=2]="UNKNOWN",Qo[Qo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Qo[Qo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Qo[Qo.NOT_FOUND=5]="NOT_FOUND",Qo[Qo.ALREADY_EXISTS=6]="ALREADY_EXISTS",Qo[Qo.PERMISSION_DENIED=7]="PERMISSION_DENIED",Qo[Qo.UNAUTHENTICATED=16]="UNAUTHENTICATED",Qo[Qo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Qo[Qo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Qo[Qo.ABORTED=10]="ABORTED",Qo[Qo.OUT_OF_RANGE=11]="OUT_OF_RANGE",Qo[Qo.UNIMPLEMENTED=12]="UNIMPLEMENTED",Qo[Qo.INTERNAL=13]="INTERNAL",Qo[Qo.UNAVAILABLE=14]="UNAVAILABLE",Qo[Qo.DATA_LOSS=15]="DATA_LOSS";let Yo=null;function Jo(){return new TextEncoder}const Zo=new Cr([4294967295,4294967295],0);function ta(t){const e=Jo().encode(t),n=new Ir;return n.update(e),new Uint8Array(n.digest())}function ea(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Cr([n,r],0),new Cr([i,s],0)]}class na{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new ra(`Invalid padding: ${e}`);if(n<0)throw new ra(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new ra(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new ra(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Cr.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Cr.fromNumber(n)));return 1===r.compare(Zo)&&(r=new Cr([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=ta(t),[n,r]=ea(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new na(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Te)return;const e=ta(t),[n,r]=ea(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class ra extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ia{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,sa.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new ia(ei.min(),r,new Ai(Jr),Zs(),uo())}}class sa{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new sa(n,e,uo(),uo(),uo())}}class oa{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class aa{constructor(t,e){this.targetId=t,this.fe=e}}class ua{constructor(t,e,n=Li.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class ca{constructor(){this.ge=0,this.pe=da(),this.ye=Li.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=uo(),e=uo(),n=uo();return this.pe.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Mr()}})),new sa(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=da()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,Vr(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class la{constructor(t){this.Le=t,this.ke=new Map,this.qe=Zs(),this.Qe=ha(),this.Ke=new Ai(Jr)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:Mr()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const i=r.target;if(Ls(i))if(0===n){const t=new oi(i.path);this.We(e,t,as.newNoDocument(t,ei.min()))}else Vr(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),i=n?this.et(n,t,r):1;if(0!==i){this.He(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}null==Yo||Yo.tt(function(t,e,n,r,i){var s,o,a,u,c,l;const h={localCacheCount:t,existenceFilterCount:e.count,databaseId:n.database,projectId:n.projectId},d=e.unchangedNames;return d&&(h.bloomFilter={applied:0===i,hashCount:null!==(s=null==d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(u=null===(a=null===(o=null==d?void 0:d.bits)||void 0===o?void 0:o.bitmap)||void 0===a?void 0:a.length)&&void 0!==u?u:0,padding:null!==(l=null===(c=null==d?void 0:d.bits)||void 0===c?void 0:c.padding)&&void 0!==l?l:0,mightContain:t=>{var e;return null!==(e=null==r?void 0:r.mightContain(t))&&void 0!==e&&e}}),h}(r,t.fe,this.Le.nt(),n,i))}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Fi(n).toUint8Array()}catch(t){if(t instanceof Oi)return Lr("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new na(s,r,i)}catch(t){return Lr(t instanceof ra?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Ls(i.target)){const e=new oi(i.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,as.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=uo();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new ia(t,e,this.Ke,this.qe,n);return this.qe=Zs(),this.Qe=ha(),this.Ke=new Ai(Jr),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new ca,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Ni(Jr),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||xr("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new ca),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function ha(){return new Ai(oi.comparator)}function da(){return new Ai(oi.comparator)}const fa={asc:"ASCENDING",desc:"DESCENDING"},pa={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ma={and:"AND",or:"OR"};class ga{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ya(t,e){return t.useProto3Json||vi(e)?e:{value:e}}function va(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function wa(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function _a(t,e){return va(t,e.toTimestamp())}function ba(t){return Vr(!!t),ei.fromTimestamp(function(t){const e=Mi(t);return new ti(e.seconds,e.nanos)}(t))}function Ea(t,e){return function(t){return new ri(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ta(t){const e=ri.fromString(t);return Vr(za(e)),e}function Sa(t,e){return Ea(t.databaseId,e.path)}function Ia(t,e){const n=Ta(e);if(n.get(1)!==t.databaseId.projectId)throw new Br(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Br(Ur.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new oi(Da(n))}function Ca(t,e){return Ea(t.databaseId,e)}function Aa(t){const e=Ta(t);return 4===e.length?ri.emptyPath():Da(e)}function ka(t){return new ri(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Da(t){return Vr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Na(t,e,n){return{name:Sa(t,e),fields:n.value.mapValue.fields}}function Ra(t,e){let n;if(e instanceof Mo)n={update:Na(t,e.key,e.value)};else if(e instanceof qo)n={delete:Sa(t,e.key)};else if(e instanceof Vo)n={update:Na(t,e.key,e.data),updateMask:ja(e.fieldMask)};else{if(!(e instanceof jo))return Mr();n={verify:Sa(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof wo)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof _o)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Eo)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof So)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw Mr()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:_a(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Mr()}(t,e.precondition)),n}function xa(t,e){return{documents:[Ca(t,e.path)]}}function Oa(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ca(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ca(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(t){if(0!==t.length)return qa(ms.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ua(t.field),direction:Ma(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=ya(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function La(t){let e=Aa(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Vr(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Pa(t);return e instanceof ms&&ys(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new hs(Ba(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,vi(e)?null:e}(n.limit));let u=null;n.startAt&&(u=function(t){const e=!!t.before,n=t.values||[];return new us(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new us(n,e)}(n.endAt)),Ms(e,i,o,s,a,"F",u,c)}function Pa(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ba(t.unaryFilter.field);return ps.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ba(t.unaryFilter.field);return ps.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ba(t.unaryFilter.field);return ps.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Ba(t.unaryFilter.field);return ps.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Mr()}}(t):void 0!==t.fieldFilter?function(t){return ps.create(Ba(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Mr()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return ms.create(t.compositeFilter.filters.map((t=>Pa(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Mr()}}(t.compositeFilter.op))}(t):Mr()}function Ma(t){return fa[t]}function Va(t){return pa[t]}function Fa(t){return ma[t]}function Ua(t){return{fieldPath:t.canonicalString()}}function Ba(t){return si.fromServerFormat(t.fieldPath)}function qa(t){return t instanceof ps?function(t){if("=="===t.op){if(es(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NAN"}};if(ts(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(es(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NAN"}};if(ts(t.value))return{unaryFilter:{field:Ua(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ua(t.field),op:Va(t.op),value:t.value}}}(t):t instanceof ms?function(t){const e=t.getFilters().map((t=>qa(t)));return 1===e.length?e[0]:{compositeFilter:{op:Fa(t.op),filters:e}}}(t):Mr()}function ja(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function za(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class $a{constructor(t,e,n,r,i=ei.min(),s=ei.min(),o=Li.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new $a(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new $a(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new $a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new $a(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Ha{constructor(t){this.ut=t}}function Ka(t){const e=La({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?zs(e,e.limit,"L"):e}class Ga{constructor(){}ht(t,e){this.Pt(t,e),e.It()}Pt(t,e){if("nullValue"in t)this.Tt(e,5);else if("booleanValue"in t)this.Tt(e,10),e.Et(t.booleanValue?1:0);else if("integerValue"in t)this.Tt(e,15),e.Et(Vi(t.integerValue));else if("doubleValue"in t){const n=Vi(t.doubleValue);isNaN(n)?this.Tt(e,13):(this.Tt(e,15),wi(n)?e.Et(0):e.Et(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Tt(e,20),"string"==typeof n?e.dt(n):(e.dt(`${n.seconds||""}`),e.Et(n.nanos||0))}else if("stringValue"in t)this.At(t.stringValue,e),this.Rt(e);else if("bytesValue"in t)this.Tt(e,30),e.Vt(Fi(t.bytesValue)),this.Rt(e);else if("referenceValue"in t)this.ft(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Tt(e,45),e.Et(n.latitude||0),e.Et(n.longitude||0)}else"mapValue"in t?is(t)?this.Tt(e,Number.MAX_SAFE_INTEGER):(this.gt(t.mapValue,e),this.Rt(e)):"arrayValue"in t?(this.yt(t.arrayValue,e),this.Rt(e)):Mr()}At(t,e){this.Tt(e,25),this.wt(t,e)}wt(t,e){e.dt(t)}gt(t,e){const n=t.fields||{};this.Tt(e,55);for(const t of Object.keys(n))this.At(t,e),this.Pt(n[t],e)}yt(t,e){const n=t.values||[];this.Tt(e,50);for(const t of n)this.Pt(t,e)}ft(t,e){this.Tt(e,37),oi.fromName(t).path.forEach((t=>{this.Tt(e,60),this.wt(t,e)}))}Tt(t,e){t.Et(e)}Rt(t){t.Et(2)}}Ga.St=new Ga;class Qa{constructor(){this.on=new Wa}addToCollectionParentIndex(t,e){return this.on.add(e),mi.resolve()}getCollectionParents(t,e){return mi.resolve(this.on.getEntries(e))}addFieldIndex(t,e){return mi.resolve()}deleteFieldIndex(t,e){return mi.resolve()}deleteAllFieldIndexes(t){return mi.resolve()}createTargetIndexes(t,e){return mi.resolve()}getDocumentsMatchingTarget(t,e){return mi.resolve(null)}getIndexType(t,e){return mi.resolve(0)}getFieldIndexes(t,e){return mi.resolve([])}getNextCollectionGroupToUpdate(t){return mi.resolve(null)}getMinOffset(t,e){return mi.resolve(li.min())}getMinOffsetFromCollectionGroup(t,e){return mi.resolve(li.min())}updateCollectionGroup(t,e,n){return mi.resolve()}updateIndexEntries(t,e){return mi.resolve()}}class Wa{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ni(ri.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Ni(ri.comparator)).toArray()}}new Uint8Array(0);class Xa{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Xa(t,Xa.DEFAULT_COLLECTION_PERCENTILE,Xa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Xa.DEFAULT_COLLECTION_PERCENTILE=10,Xa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Xa.DEFAULT=new Xa(41943040,Xa.DEFAULT_COLLECTION_PERCENTILE,Xa.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Xa.DISABLED=new Xa(-1,0,0);class Ya{constructor(t){this.xn=t}next(){return this.xn+=2,this.xn}static On(){return new Ya(0)}static Nn(){return new Ya(-1)}}class Ja{constructor(){this.changes=new Ys((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,as.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?mi.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Za{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class tu{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Oo(n.mutation,t,xi.empty(),ti.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,uo()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=uo()){const r=ro();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=eo();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=ro();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,uo())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=Zs();const s=so(),o=so();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Vo)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Oo(o.mutation,e,o.mutation.getFieldMask(),ti.now())):s.set(e.key,xi.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Za(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=so();let r=new Ai(((t,e)=>t-e)),i=uo();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||xi.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||uo()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,u=r.value,c=io();u.forEach((t=>{if(!i.has(t)){const r=Ro(e.get(t),n.get(t));null!==r&&c.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,c))}return mi.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return oi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Us(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):mi.resolve(ro());let o=-1,a=i;return s.next((e=>mi.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?mi.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,uo()))).next((t=>({batchId:o,changes:no(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new oi(e)).next((t=>{let e=eo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=eo();return this.indexManager.getCollectionParents(t,i).next((o=>mi.forEach(o,(o=>{const a=function(t,e){return new Ps(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,as.newInvalidDocument(r)))}));let n=eo();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Oo(s.mutation,r,xi.empty(),ti.now()),Gs(e,r)&&(n=n.insert(t,r))})),n}))}}class eu{constructor(t){this.serializer=t,this.ur=new Map,this.cr=new Map}getBundleMetadata(t,e){return mi.resolve(this.ur.get(e))}saveBundleMetadata(t,e){return this.ur.set(e.id,function(t){return{id:t.id,version:t.version,createTime:ba(t.createTime)}}(e)),mi.resolve()}getNamedQuery(t,e){return mi.resolve(this.cr.get(e))}saveNamedQuery(t,e){return this.cr.set(e.name,function(t){return{name:t.name,query:Ka(t.bundledQuery),readTime:ba(t.readTime)}}(e)),mi.resolve()}}class nu{constructor(){this.overlays=new Ai(oi.comparator),this.lr=new Map}getOverlay(t,e){return mi.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ro();return mi.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.lt(t,e,r)})),mi.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.lr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.lr.delete(n)),mi.resolve()}getOverlaysForCollection(t,e,n){const r=ro(),i=e.length+1,s=new oi(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return mi.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Ai(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=ro(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ro(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return mi.resolve(o)}lt(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.lr.get(r.largestBatchId).delete(n.key);this.lr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ho(e,n));let i=this.lr.get(e);void 0===i&&(i=uo(),this.lr.set(e,i)),this.lr.set(e,i.add(n.key))}}class ru{constructor(){this.hr=new Ni(iu.Pr),this.Ir=new Ni(iu.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(t,e){const n=new iu(t,e);this.hr=this.hr.add(n),this.Ir=this.Ir.add(n)}Er(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.dr(new iu(t,e))}Ar(t,e){t.forEach((t=>this.removeReference(t,e)))}Rr(t){const e=new oi(new ri([])),n=new iu(e,t),r=new iu(e,t+1),i=[];return this.Ir.forEachInRange([n,r],(t=>{this.dr(t),i.push(t.key)})),i}Vr(){this.hr.forEach((t=>this.dr(t)))}dr(t){this.hr=this.hr.delete(t),this.Ir=this.Ir.delete(t)}mr(t){const e=new oi(new ri([])),n=new iu(e,t),r=new iu(e,t+1);let i=uo();return this.Ir.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new iu(t,0),n=this.hr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class iu{constructor(t,e){this.key=t,this.gr=e}static Pr(t,e){return oi.comparator(t.key,e.key)||Jr(t.gr,e.gr)}static Tr(t,e){return Jr(t.gr,e.gr)||oi.comparator(t.key,e.key)}}class su{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.pr=1,this.yr=new Ni(iu.Pr)}checkEmpty(t){return mi.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new zo(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.yr=this.yr.add(new iu(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return mi.resolve(s)}lookupMutationBatch(t,e){return mi.resolve(this.wr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.Sr(n),i=r<0?0:r;return mi.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return mi.resolve(0===this.mutationQueue.length?-1:this.pr-1)}getAllMutationBatches(t){return mi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new iu(e,0),r=new iu(e,Number.POSITIVE_INFINITY),i=[];return this.yr.forEachInRange([n,r],(t=>{const e=this.wr(t.gr);i.push(e)})),mi.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ni(Jr);return e.forEach((t=>{const e=new iu(t,0),r=new iu(t,Number.POSITIVE_INFINITY);this.yr.forEachInRange([e,r],(t=>{n=n.add(t.gr)}))})),mi.resolve(this.br(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;oi.isDocumentKey(i)||(i=i.child(""));const s=new iu(new oi(i),0);let o=new Ni(Jr);return this.yr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.gr)),!0)}),s),mi.resolve(this.br(o))}br(t){const e=[];return t.forEach((t=>{const n=this.wr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Vr(0===this.Dr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.yr;return mi.forEach(e.mutations,(r=>{const i=new iu(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.yr=n}))}Fn(t){}containsKey(t,e){const n=new iu(e,0),r=this.yr.firstAfterOrEqual(n);return mi.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,mi.resolve()}Dr(t,e){return this.Sr(t)}Sr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}wr(t){const e=this.Sr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class ou{constructor(t){this.Cr=t,this.docs=new Ai(oi.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.Cr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return mi.resolve(n?n.document.mutableCopy():as.newInvalidDocument(e))}getEntries(t,e){let n=Zs();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():as.newInvalidDocument(t))})),mi.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Zs();const s=e.path,o=new oi(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||hi(ci(o),n)<=0||(r.has(o.key)||Gs(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return mi.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Mr()}vr(t,e){return mi.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new au(this)}getSize(t){return mi.resolve(this.size)}}class au extends Ja{constructor(t){super(),this._r=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this._r.addEntry(t,r)):this._r.removeEntry(n)})),mi.waitFor(e)}getFromCache(t,e){return this._r.getEntry(t,e)}getAllFromCache(t,e){return this._r.getEntries(t,e)}}class uu{constructor(t){this.persistence=t,this.Fr=new Ys((t=>xs(t)),Os),this.lastRemoteSnapshotVersion=ei.min(),this.highestTargetId=0,this.Mr=0,this.Or=new ru,this.targetCount=0,this.Nr=Ya.On()}forEachTarget(t,e){return this.Fr.forEach(((t,n)=>e(n))),mi.resolve()}getLastRemoteSnapshotVersion(t){return mi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return mi.resolve(this.Mr)}allocateTargetId(t){return this.highestTargetId=this.Nr.next(),mi.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Mr&&(this.Mr=e),mi.resolve()}kn(t){this.Fr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Nr=new Ya(e),this.highestTargetId=e),t.sequenceNumber>this.Mr&&(this.Mr=t.sequenceNumber)}addTargetData(t,e){return this.kn(e),this.targetCount+=1,mi.resolve()}updateTargetData(t,e){return this.kn(e),mi.resolve()}removeTargetData(t,e){return this.Fr.delete(e.target),this.Or.Rr(e.targetId),this.targetCount-=1,mi.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Fr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Fr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),mi.waitFor(i).next((()=>r))}getTargetCount(t){return mi.resolve(this.targetCount)}getTargetData(t,e){const n=this.Fr.get(e)||null;return mi.resolve(n)}addMatchingKeys(t,e,n){return this.Or.Er(e,n),mi.resolve()}removeMatchingKeys(t,e,n){this.Or.Ar(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),mi.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Or.Rr(e),mi.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Or.mr(e);return mi.resolve(n)}containsKey(t,e){return mi.resolve(this.Or.containsKey(e))}}class cu{constructor(t,e){this.Br={},this.overlays={},this.Lr=new yi(0),this.kr=!1,this.kr=!0,this.referenceDelegate=t(this),this.qr=new uu(this),this.indexManager=new Qa,this.remoteDocumentCache=function(t){return new ou(t)}((t=>this.referenceDelegate.Qr(t))),this.serializer=new Ha(e),this.Kr=new eu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new nu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new su(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(t,e,n){xr("MemoryPersistence","Starting transaction:",t);const r=new lu(this.Lr.next());return this.referenceDelegate.$r(),n(r).next((t=>this.referenceDelegate.Ur(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Wr(t,e){return mi.or(Object.values(this.Br).map((n=>()=>n.containsKey(t,e))))}}class lu extends fi{constructor(t){super(),this.currentSequenceNumber=t}}class hu{constructor(t){this.persistence=t,this.Gr=new ru,this.zr=null}static jr(t){return new hu(t)}get Hr(){if(this.zr)return this.zr;throw Mr()}addReference(t,e,n){return this.Gr.addReference(n,e),this.Hr.delete(n.toString()),mi.resolve()}removeReference(t,e,n){return this.Gr.removeReference(n,e),this.Hr.add(n.toString()),mi.resolve()}markPotentiallyOrphaned(t,e){return this.Hr.add(e.toString()),mi.resolve()}removeTarget(t,e){this.Gr.Rr(e.targetId).forEach((t=>this.Hr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Hr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}$r(){this.zr=new Set}Ur(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return mi.forEach(this.Hr,(n=>{const r=oi.fromPath(n);return this.Jr(t,r).next((t=>{t||e.removeEntry(r,ei.min())}))})).next((()=>(this.zr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Jr(t,e).next((t=>{t?this.Hr.delete(e.toString()):this.Hr.add(e.toString())}))}Qr(t){return 0}Jr(t,e){return mi.or([()=>mi.resolve(this.Gr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Wr(t,e)])}}class du{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.ki=n,this.qi=r}static Qi(t,e){let n=uo(),r=uo();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new du(t,e.fromCache,n,r)}}class fu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class pu{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(t,e){this.Gi=t,this.indexManager=e,this.Ki=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.zi(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.ji(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new fu;return this.Hi(t,e,n).next((r=>{if(i.result=r,this.$i)return this.Ji(t,e,n,r.size)}))})).next((()=>i.result))}Ji(t,e,n,r){return n.documentReadCount<this.Ui?(Rr()<=o.in.DEBUG&&xr("QueryEngine","SDK will not create cache indexes for query:",Ks(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),mi.resolve()):(Rr()<=o.in.DEBUG&&xr("QueryEngine","Query:",Ks(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Wi*r?(Rr()<=o.in.DEBUG&&xr("QueryEngine","The SDK decides to create cache indexes for query:",Ks(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,qs(e))):mi.resolve())}zi(t,e){if(Fs(e))return mi.resolve(null);let n=qs(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=zs(e,null,"F"),n=qs(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=uo(...r);return this.Gi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Yi(e,r);return this.Zi(e,s,i,n.readTime)?this.zi(t,zs(e,null,"F")):this.Xi(t,s,e,n)}))))})))))}ji(t,e,n,r){return Fs(e)||r.isEqual(ei.min())?mi.resolve(null):this.Gi.getDocuments(t,n).next((i=>{const s=this.Yi(e,i);return this.Zi(e,s,n,r)?mi.resolve(null):(Rr()<=o.in.DEBUG&&xr("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ks(e)),this.Xi(t,s,e,ui(r,-1)).next((t=>t)))}))}Yi(t,e){let n=new Ni(Ws(t));return e.forEach(((e,r)=>{Gs(t,r)&&(n=n.add(r))})),n}Zi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Hi(t,e,n){return Rr()<=o.in.DEBUG&&xr("QueryEngine","Using full collection scan to execute query:",Ks(e)),this.Gi.getDocumentsMatchingQuery(t,e,li.min(),n)}Xi(t,e,n,r){return this.Gi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class mu{constructor(t,e,n,r){this.persistence=t,this.es=e,this.serializer=r,this.ts=new Ai(Jr),this.ns=new Ys((t=>xs(t)),Os),this.rs=new Map,this.ss=t.getRemoteDocumentCache(),this.qr=t.getTargetCache(),this.Kr=t.getBundleCache(),this.os(n)}os(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new tu(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ts)))}}function gu(t,e,n,r){return new mu(t,e,n,r)}async function yu(t,e){const n=Fr(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n.os(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=uo();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({_s:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function vu(t){const e=Fr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.qr.getLastRemoteSnapshotVersion(t)))}function wu(t,e,n){let r=uo(),i=uo();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=Zs();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(ei.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):xr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{us:r,cs:i}}))}function _u(t,e){const n=Fr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}function bu(t,e){const n=Fr(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.qr.getTargetData(t,e).next((i=>i?(r=i,mi.resolve(r)):n.qr.allocateTargetId(t).next((i=>(r=new $a(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ts.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ts=n.ts.insert(t.targetId,t),n.ns.set(e,t.targetId)),t}))}async function Eu(t,e,n){const r=Fr(t),i=r.ts.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!gi(t))throw t;xr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function Tu(t,e,n){const r=Fr(t);let i=ei.min(),s=uo();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Fr(t),i=r.ns.get(n);return void 0!==i?mi.resolve(r.ts.get(i)):r.qr.getTargetData(e,n)}(r,t,qs(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.es.getDocumentsMatchingQuery(t,e,n?i:ei.min(),n?s:uo()))).next((t=>(Su(r,Qs(e),t),{documents:t,ls:s})))))}function Su(t,e,n){let r=t.rs.get(e)||ei.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.rs.set(e,r)}class Iu{constructor(){this.activeTargetIds=lo()}ds(t){this.activeTargetIds=this.activeTargetIds.add(t)}As(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Es(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Cu{constructor(){this.eo=new Iu,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.eo.ds(t),this.no[t]||"not-current"}updateQueryState(t,e,n){this.no[t]=e}removeLocalQueryTarget(t){this.eo.As(t)}isLocalQueryTarget(t){return this.eo.activeTargetIds.has(t)}clearQueryState(t){delete this.no[t]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(t){return this.eo.activeTargetIds.has(t)}start(){return this.eo=new Iu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Au{ro(t){}shutdown(){}}class ku{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(t){this.ao.push(t)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){xr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ao)t(0)}_o(){xr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ao)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Du=null;function Nu(){return null===Du?Du=268435456+Math.round(2147483648*Math.random()):Du++,"0x"+Du.toString(16)}const Ru={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class xu{constructor(t){this.co=t.co,this.lo=t.lo}ho(t){this.Po=t}Io(t){this.To=t}onMessage(t){this.Eo=t}close(){this.lo()}send(t){this.co(t)}Ao(){this.Po()}Ro(t){this.To(t)}Vo(t){this.Eo(t)}}const Ou="WebChannelConnection";class Lu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.mo=e+"://"+t.host,this.fo=`projects/${n}/databases/${r}`,this.po="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get yo(){return!1}wo(t,e,n,r,i){const s=Nu(),o=this.So(t,e);xr("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(a,r,i),this.Do(t,o,a,n).then((e=>(xr("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Lr("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}Co(t,e,n,r,i,s){return this.wo(t,e,n,r,i)}bo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Dr,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}So(t,e){const n=Ru[t];return`${this.mo}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Do(t,e,n,r){const i=Nu();return new Promise(((s,o)=>{const a=new Sr;a.setWithCredentials(!0),a.listenOnce(_r.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case wr.NO_ERROR:const e=a.getResponseJson();xr(Ou,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case wr.TIMEOUT:xr(Ou,`RPC '${t}' ${i} timed out`),o(new Br(Ur.DEADLINE_EXCEEDED,"Request time out"));break;case wr.HTTP_ERROR:const n=a.getStatus();if(xr(Ou,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Ur).indexOf(e)>=0?e:Ur.UNKNOWN}(e.status);o(new Br(t,e.message))}else o(new Br(Ur.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Br(Ur.UNAVAILABLE,"Connection failed."));break;default:Mr()}}finally{xr(Ou,`RPC '${t}' ${i} completed.`)}}));const u=JSON.stringify(r);xr(Ou,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",u,n,15)}))}vo(t,e,n){const r=Nu(),i=[this.mo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=yr(),o=vr(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;void 0!==u&&(a.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(a.useFetchStreams=!0),this.bo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const c=i.join("");xr(Ou,`Creating RPC '${t}' stream ${r}: ${c}`,a);const l=s.createWebChannel(c,a);let h=!1,d=!1;const f=new xu({co:e=>{d?xr(Ou,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(h||(xr(Ou,`Opening RPC '${t}' stream ${r} transport.`),l.open(),h=!0),xr(Ou,`RPC '${t}' stream ${r} sending:`,e),l.send(e))},lo:()=>l.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(l,Tr.EventType.OPEN,(()=>{d||xr(Ou,`RPC '${t}' stream ${r} transport opened.`)})),p(l,Tr.EventType.CLOSE,(()=>{d||(d=!0,xr(Ou,`RPC '${t}' stream ${r} transport closed`),f.Ro())})),p(l,Tr.EventType.ERROR,(e=>{d||(d=!0,Lr(Ou,`RPC '${t}' stream ${r} transport errored:`,e),f.Ro(new Br(Ur.UNAVAILABLE,"The operation could not be completed")))})),p(l,Tr.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Vr(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){xr(Ou,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Go[t];if(void 0!==e)return Xo(e)}(e),i=o.message;void 0===n&&(n=Ur.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.Ro(new Br(n,i)),l.close()}else xr(Ou,`RPC '${t}' stream ${r} received:`,i),f.Vo(i)}})),p(o,br.STAT_EVENT,(e=>{e.stat===Er.PROXY?xr(Ou,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Er.NOPROXY&&xr(Ou,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ao()}),0),f}}function Pu(){return"undefined"!=typeof document?document:null}function Mu(t){return new ga(t,!0)}class Vu{constructor(t,e,n=1e3,r=1.5,i=6e4){this.si=t,this.timerId=e,this.Fo=n,this.Mo=r,this.xo=i,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(t){this.cancel();const e=Math.floor(this.Oo+this.qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,e-n);r>0&&xr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Oo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),t()))),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){null!==this.No&&(this.No.skipDelay(),this.No=null)}cancel(){null!==this.No&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class Fu{constructor(t,e,n,r,i,s,o,a){this.si=t,this.Ko=n,this.$o=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Vu(t,e)}jo(){return 1===this.state||5===this.state||this.Ho()}Ho(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&null===this.Wo&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,(()=>this.Xo())))}e_(t){this.t_(),this.stream.send(t)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(t,e){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,4!==t?this.zo.reset():e&&e.code===Ur.RESOURCE_EXHAUSTED?(Or(e.toString()),Or("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):e&&e.code===Ur.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.r_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Io(e)}r_(){}auth(){this.state=1;const t=this.i_(this.Uo),e=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Uo===e&&this.s_(t,n)}),(e=>{t((()=>{const t=new Br(Ur.UNKNOWN,"Fetching auth token failed: "+e.message);return this.o_(t)}))}))}s_(t,e){const n=this.i_(this.Uo);this.stream=this.__(t,e),this.stream.ho((()=>{n((()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,(()=>(this.Ho()&&(this.state=3),Promise.resolve()))),this.listener.ho())))})),this.stream.Io((t=>{n((()=>this.o_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Jo(){this.state=5,this.zo.ko((async()=>{this.state=0,this.start()}))}o_(t){return xr("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}i_(t){return e=>{this.si.enqueueAndForget((()=>this.Uo===t?e():(xr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Uu extends Fu{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}__(t,e){return this.connection.vo("Listen",t,e)}onMessage(t){this.zo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Mr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Vr(void 0===e||"string"==typeof e),Li.fromBase64String(e||"")):(Vr(void 0===e||e instanceof Uint8Array),Li.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ur.UNKNOWN:Xo(t.code);return new Br(e,t.message||"")}(o);n=new ua(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Ia(t,r.document.name),s=ba(r.document.updateTime),o=r.document.createTime?ba(r.document.createTime):ei.min(),a=new ss({mapValue:{fields:r.document.fields}}),u=as.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];n=new oa(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Ia(t,r.document),s=r.readTime?ba(r.readTime):ei.min(),o=as.newNoDocument(i,s),a=r.removedTargetIds||[];n=new oa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Ia(t,r.document),s=r.removedTargetIds||[];n=new oa([],s,i,null)}else{if(!("filter"in e))return Mr();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Ko(r,i),o=t.targetId;n=new aa(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ei.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ei.min():e.readTime?ba(e.readTime):ei.min()}(t);return this.listener.a_(e,n)}u_(t){const e={};e.database=ka(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Ls(r)?{documents:xa(t,r)}:{query:Oa(t,r)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=wa(t,e.resumeToken);const r=ya(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(ei.min())>0){n.readTime=va(t,e.snapshotVersion.toTimestamp());const r=ya(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Mr()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.e_(e)}c_(t){const e={};e.database=ka(this.serializer),e.removeTarget=t,this.e_(e)}}class Bu extends Fu{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(t,e){return this.connection.vo("Write",t,e)}onMessage(t){if(Vr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.l_){this.zo.reset();const e=function(t,e){return t&&t.length>0?(Vr(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?ba(t.updateTime):ba(e);return n.isEqual(ei.min())&&(n=ba(e)),new Ao(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=ba(t.commitTime);return this.listener.I_(n,e)}return Vr(!t.writeResults||0===t.writeResults.length),this.l_=!0,this.listener.T_()}E_(){const t={};t.database=ka(this.serializer),this.e_(t)}P_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Ra(this.serializer,t)))};this.e_(e)}}class qu extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.d_=!1}A_(){if(this.d_)throw new Br(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}wo(t,e,n){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.wo(t,e,n,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Br(Ur.UNKNOWN,t.toString())}))}Co(t,e,n,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.Co(t,e,n,i,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Ur.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Br(Ur.UNKNOWN,t.toString())}))}terminate(){this.d_=!0}}class ju{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){0===this.V_&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve()))))}w_(t){"Online"===this.state?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.p_("Offline")))}set(t){this.S_(),this.V_=0,"Online"===t&&(this.f_=!1),this.p_(t)}p_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}y_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Or(e),this.f_=!1):xr("OnlineStateTracker",e)}S_(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}}class zu{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=i,this.F_.ro((t=>{n.enqueueAndForget((async()=>{Ju(this)&&(xr("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Fr(t);e.C_.add(4),await Hu(e),e.M_.set("Unknown"),e.C_.delete(4),await $u(e)}(this))}))})),this.M_=new ju(n,r)}}async function $u(t){if(Ju(t))for(const e of t.v_)await e(!0)}async function Hu(t){for(const e of t.v_)await e(!1)}function Ku(t,e){const n=Fr(t);n.D_.has(e.targetId)||(n.D_.set(e.targetId,e),Yu(n)?Xu(n):gc(n).Ho()&&Qu(n,e))}function Gu(t,e){const n=Fr(t),r=gc(n);n.D_.delete(e),r.Ho()&&Wu(n,e),0===n.D_.size&&(r.Ho()?r.Zo():Ju(n)&&n.M_.set("Unknown"))}function Qu(t,e){if(t.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ei.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}gc(t).u_(e)}function Wu(t,e){t.x_.Oe(e),gc(t).c_(e)}function Xu(t){t.x_=new la({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.D_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),gc(t).start(),t.M_.g_()}function Yu(t){return Ju(t)&&!gc(t).jo()&&t.D_.size>0}function Ju(t){return 0===Fr(t).C_.size}function Zu(t){t.x_=void 0}async function tc(t){t.D_.forEach(((e,n)=>{Qu(t,e)}))}async function ec(t,e){Zu(t),Yu(t)?(t.M_.w_(e),Xu(t)):t.M_.set("Unknown")}async function nc(t,e,n){if(t.M_.set("Online"),e instanceof ua&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.D_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.D_.delete(r),t.x_.removeTarget(r))}(t,e)}catch(n){xr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await rc(t,n)}else if(e instanceof oa?t.x_.$e(e):e instanceof aa?t.x_.Je(e):t.x_.Ge(e),!n.isEqual(ei.min()))try{const e=await vu(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.x_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.D_.get(r);i&&t.D_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.D_.get(e);if(!r)return;t.D_.set(e,r.withResumeToken(Li.EMPTY_BYTE_STRING,r.snapshotVersion)),Wu(t,e);const i=new $a(r.target,e,n,r.sequenceNumber);Qu(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){xr("RemoteStore","Failed to raise snapshot:",e),await rc(t,e)}}async function rc(t,e,n){if(!gi(e))throw e;t.C_.add(1),await Hu(t),t.M_.set("Offline"),n||(n=()=>vu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{xr("RemoteStore","Retrying IndexedDB access"),await n(),t.C_.delete(1),await $u(t)}))}function ic(t,e){return e().catch((n=>rc(t,n,e)))}async function sc(t){const e=Fr(t),n=yc(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;oc(e);)try{const t=await _u(e.localStore,r);if(null===t){0===e.b_.length&&n.Zo();break}r=t.batchId,ac(e,t)}catch(t){await rc(e,t)}uc(e)&&cc(e)}function oc(t){return Ju(t)&&t.b_.length<10}function ac(t,e){t.b_.push(e);const n=yc(t);n.Ho()&&n.h_&&n.P_(e.mutations)}function uc(t){return Ju(t)&&!yc(t).jo()&&t.b_.length>0}function cc(t){yc(t).start()}async function lc(t){yc(t).E_()}async function hc(t){const e=yc(t);for(const n of t.b_)e.P_(n.mutations)}async function dc(t,e,n){const r=t.b_.shift(),i=$o.from(r,e,n);await ic(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await sc(t)}async function fc(t,e){e&&yc(t).h_&&await async function(t,e){if(function(t){return Wo(t)&&t!==Ur.ABORTED}(e.code)){const n=t.b_.shift();yc(t).Yo(),await ic(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await sc(t)}}(t,e),uc(t)&&cc(t)}async function pc(t,e){const n=Fr(t);n.asyncQueue.verifyOperationInProgress(),xr("RemoteStore","RemoteStore received new credentials");const r=Ju(n);n.C_.add(3),await Hu(n),r&&n.M_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.C_.delete(3),await $u(n)}async function mc(t,e){const n=Fr(t);e?(n.C_.delete(2),await $u(n)):e||(n.C_.add(2),await Hu(n),n.M_.set("Unknown"))}function gc(t){return t.O_||(t.O_=function(t,e,n){const r=Fr(t);return r.A_(),new Uu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:tc.bind(null,t),Io:ec.bind(null,t),a_:nc.bind(null,t)}),t.v_.push((async e=>{e?(t.O_.Yo(),Yu(t)?Xu(t):t.M_.set("Unknown")):(await t.O_.stop(),Zu(t))}))),t.O_}function yc(t){return t.N_||(t.N_=function(t,e,n){const r=Fr(t);return r.A_(),new Bu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{ho:lc.bind(null,t),Io:fc.bind(null,t),T_:hc.bind(null,t),I_:dc.bind(null,t)}),t.v_.push((async e=>{e?(t.N_.Yo(),await sc(t)):(await t.N_.stop(),t.b_.length>0&&(xr("RemoteStore",`Stopping write stream with ${t.b_.length} pending writes`),t.b_=[]))}))),t.N_}class vc{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new qr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new vc(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Br(Ur.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wc(t,e){if(Or("AsyncQueue",`${e}: ${t}`),gi(t))return new Br(Ur.UNAVAILABLE,`${e}: ${t}`);throw t}class _c{constructor(t){this.comparator=t?(e,n)=>t(e,n)||oi.comparator(e.key,n.key):(t,e)=>oi.comparator(t.key,e.key),this.keyedMap=eo(),this.sortedSet=new Ai(this.comparator)}static emptySet(t){return new _c(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof _c))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new _c;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class bc{constructor(){this.B_=new Ai(oi.comparator)}track(t){const e=t.doc.key,n=this.B_.get(e);n?0!==t.type&&3===n.type?this.B_=this.B_.insert(e,t):3===t.type&&1!==n.type?this.B_=this.B_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.B_=this.B_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.B_=this.B_.remove(e):1===t.type&&2===n.type?this.B_=this.B_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.B_=this.B_.insert(e,{type:2,doc:t.doc}):Mr():this.B_=this.B_.insert(e,t)}L_(){const t=[];return this.B_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Ec{constructor(t,e,n,r,i,s,o,a,u){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=u}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new Ec(t,e,_c.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&$s(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Tc{constructor(){this.k_=void 0,this.listeners=[]}}class Sc{constructor(){this.queries=new Ys((t=>Hs(t)),$s),this.onlineState="Unknown",this.q_=new Set}}async function Ic(t,e){const n=Fr(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new Tc),i)try{s.k_=await n.onListen(r)}catch(t){const n=wc(t,`Initialization of query '${Ks(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,s),s.listeners.push(e),e.Q_(n.onlineState),s.k_&&e.K_(s.k_)&&Dc(n)}async function Cc(t,e){const n=Fr(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),i=0===s.listeners.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}function Ac(t,e){const n=Fr(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.listeners)e.K_(t)&&(r=!0);i.k_=t}}r&&Dc(n)}function kc(t,e,n){const r=Fr(t),i=r.queries.get(e);if(i)for(const t of i.listeners)t.onError(n);r.queries.delete(e)}function Dc(t){t.q_.forEach((t=>{t.next()}))}class Nc{constructor(t,e,n){this.query=t,this.U_=e,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=n||{}}K_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ec(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.W_?this.z_(t)&&(this.U_.next(t),e=!0):this.j_(t,this.onlineState)&&(this.H_(t),e=!0),this.G_=t,e}onError(t){this.U_.error(t)}Q_(t){this.onlineState=t;let e=!1;return this.G_&&!this.W_&&this.j_(this.G_,t)&&(this.H_(this.G_),e=!0),e}j_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.J_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}z_(t){if(t.docChanges.length>0)return!0;const e=this.G_&&this.G_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}H_(t){t=Ec.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.W_=!0,this.U_.next(t)}}class Rc{constructor(t){this.key=t}}class xc{constructor(t){this.key=t}}class Oc{constructor(t,e){this.query=t,this.ia=e,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=uo(),this.mutatedKeys=uo(),this._a=Ws(t),this.aa=new _c(this._a)}get ua(){return this.ia}ca(t,e){const n=e?e.la:new bc,r=e?e.aa:this.aa;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,u="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const c=r.get(t),l=Gs(this.query,e)?e:null,h=!!c&&this.mutatedKeys.has(c.key),d=!!l&&(l.hasLocalMutations||this.mutatedKeys.has(l.key)&&l.hasCommittedMutations);let f=!1;c&&l?c.data.isEqual(l.data)?h!==d&&(n.track({type:3,doc:l}),f=!0):this.ha(c,l)||(n.track({type:2,doc:l}),f=!0,(a&&this._a(l,a)>0||u&&this._a(l,u)<0)&&(o=!0)):!c&&l?(n.track({type:0,doc:l}),f=!0):c&&!l&&(n.track({type:1,doc:c}),f=!0,(a||u)&&(o=!0)),f&&(l?(s=s.add(l),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{aa:s,la:n,Zi:o,mutatedKeys:i}}ha(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.aa;this.aa=t.aa,this.mutatedKeys=t.mutatedKeys;const s=t.la.L_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Mr()}};return n(t)-n(e)}(t.type,e.type)||this._a(t.doc,e.doc))),this.Pa(n),r=null!=r&&r;const o=e&&!r?this.Ia():[],a=0===this.oa.size&&this.current&&!r?1:0,u=a!==this.sa;return this.sa=a,0!==s.length||u?{snapshot:new Ec(this.query,t.aa,i,s,t.mutatedKeys,0===a,u,!1,!!n&&n.resumeToken.approximateByteSize()>0),Ta:o}:{Ta:o}}Q_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({aa:this.aa,la:new bc,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(t){return!this.ia.has(t)&&!!this.aa.has(t)&&!this.aa.get(t).hasLocalMutations}Pa(t){t&&(t.addedDocuments.forEach((t=>this.ia=this.ia.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.ia=this.ia.delete(t))),this.current=t.current)}Ia(){if(!this.current)return[];const t=this.oa;this.oa=uo(),this.aa.forEach((t=>{this.Ea(t.key)&&(this.oa=this.oa.add(t.key))}));const e=[];return t.forEach((t=>{this.oa.has(t)||e.push(new xc(t))})),this.oa.forEach((n=>{t.has(n)||e.push(new Rc(n))})),e}da(t){this.ia=t.ls,this.oa=uo();const e=this.ca(t.documents);return this.applyChanges(e,!0)}Aa(){return Ec.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,0===this.sa,this.hasCachedResults)}}class Lc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Pc{constructor(t){this.key=t,this.Ra=!1}}class Mc{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Va={},this.ma=new Ys((t=>Hs(t)),$s),this.fa=new Map,this.ga=new Set,this.pa=new Ai(oi.comparator),this.ya=new Map,this.wa=new ru,this.Sa={},this.ba=new Map,this.Da=Ya.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return!0===this.Ca}}async function Vc(t,e){const n=el(t);let r,i;const s=n.ma.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const t=await bu(n.localStore,qs(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,i=await Fc(n,e,r,"current"===s,t.resumeToken),n.isPrimaryClient&&Ku(n.remoteStore,t)}return i}async function Fc(t,e,n,r,i){t.va=(e,n,r)=>async function(t,e,n,r){let i=e.view.ca(n);i.Zi&&(i=await Tu(t.localStore,e.query,!1).then((({documents:t})=>e.view.ca(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return Wc(t,e.targetId,a.Ta),a.snapshot}(t,e,n,r);const s=await Tu(t.localStore,e,!0),o=new Oc(e,s.ls),a=o.ca(s.documents),u=sa.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),c=o.applyChanges(a,t.isPrimaryClient,u);Wc(t,n,c.Ta);const l=new Lc(e,n,o);return t.ma.set(e,l),t.fa.has(n)?t.fa.get(n).push(e):t.fa.set(n,[e]),c.snapshot}async function Uc(t,e){const n=Fr(t),r=n.ma.get(e),i=n.fa.get(r.targetId);if(i.length>1)return n.fa.set(r.targetId,i.filter((t=>!$s(t,e)))),void n.ma.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await Eu(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Gu(n.remoteStore,r.targetId),Gc(n,r.targetId)})).catch(pi)):(Gc(n,r.targetId),await Eu(n.localStore,r.targetId,!0))}async function Bc(t,e){const n=Fr(t);try{const t=await function(t,e){const n=Fr(t),r=e.snapshotVersion;let i=n.ts;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.ss.newChangeBuffer({trackRemovals:!0});i=n.ts;const o=[];e.targetChanges.forEach(((s,a)=>{const u=i.get(a);if(!u)return;o.push(n.qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.qr.addMatchingKeys(t,s.addedDocuments,a))));let c=u.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?c=c.withResumeToken(Li.EMPTY_BYTE_STRING,ei.min()).withLastLimboFreeSnapshotVersion(ei.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,r)),i=i.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(u,c,s)&&o.push(n.qr.updateTargetData(t,c))}));let a=Zs(),u=uo();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(wu(t,s,e.documentUpdates).next((t=>{a=t.us,u=t.cs}))),!r.isEqual(ei.min())){const e=n.qr.getLastRemoteSnapshotVersion(t).next((e=>n.qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return mi.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,u))).next((()=>a))})).then((t=>(n.ts=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.ya.get(e);r&&(Vr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.Ra=!0:t.modifiedDocuments.size>0?Vr(r.Ra):t.removedDocuments.size>0&&(Vr(r.Ra),r.Ra=!1))})),await Jc(n,t,e)}catch(t){await pi(t)}}function qc(t,e,n){const r=Fr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ma.forEach(((n,r)=>{const i=r.view.Q_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Fr(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.Q_(e)&&(r=!0)})),r&&Dc(n)}(r.eventManager,e),t.length&&r.Va.a_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function jc(t,e,n){const r=Fr(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.ya.get(e),s=i&&i.key;if(s){let t=new Ai(oi.comparator);t=t.insert(s,as.newNoDocument(s,ei.min()));const n=uo().add(s),i=new ia(ei.min(),new Map,new Ai(Jr),t,n);await Bc(r,i),r.pa=r.pa.remove(s),r.ya.delete(e),Yc(r)}else await Eu(r.localStore,e,!1).then((()=>Gc(r,e,n))).catch(pi)}async function zc(t,e){const n=Fr(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Fr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.ss.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=mi.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Vr(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=uo();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Kc(n,r,null),Hc(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Jc(n,t)}catch(t){await pi(t)}}async function $c(t,e,n){const r=Fr(t);try{const t=await function(t,e){const n=Fr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Vr(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Kc(r,e,n),Hc(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Jc(r,t)}catch(n){await pi(n)}}function Hc(t,e){(t.ba.get(e)||[]).forEach((t=>{t.resolve()})),t.ba.delete(e)}function Kc(t,e,n){const r=Fr(t);let i=r.Sa[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function Gc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.fa.get(e))t.ma.delete(r),n&&t.Va.Fa(r,n);t.fa.delete(e),t.isPrimaryClient&&t.wa.Rr(e).forEach((e=>{t.wa.containsKey(e)||Qc(t,e)}))}function Qc(t,e){t.ga.delete(e.path.canonicalString());const n=t.pa.get(e);null!==n&&(Gu(t.remoteStore,n),t.pa=t.pa.remove(e),t.ya.delete(n),Yc(t))}function Wc(t,e,n){for(const r of n)r instanceof Rc?(t.wa.addReference(r.key,e),Xc(t,r)):r instanceof xc?(xr("SyncEngine","Document no longer in limbo: "+r.key),t.wa.removeReference(r.key,e),t.wa.containsKey(r.key)||Qc(t,r.key)):Mr()}function Xc(t,e){const n=e.key,r=n.path.canonicalString();t.pa.get(n)||t.ga.has(r)||(xr("SyncEngine","New document in limbo: "+n),t.ga.add(r),Yc(t))}function Yc(t){for(;t.ga.size>0&&t.pa.size<t.maxConcurrentLimboResolutions;){const e=t.ga.values().next().value;t.ga.delete(e);const n=new oi(ri.fromString(e)),r=t.Da.next();t.ya.set(r,new Pc(n)),t.pa=t.pa.insert(n,r),Ku(t.remoteStore,new $a(qs(Vs(n.path)),r,"TargetPurposeLimboResolution",yi._e))}}async function Jc(t,e,n){const r=Fr(t),i=[],s=[],o=[];r.ma.isEmpty()||(r.ma.forEach(((t,a)=>{o.push(r.va(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=du.Qi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.Va.a_(i),await async function(t,e){const n=Fr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>mi.forEach(e,(e=>mi.forEach(e.ki,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>mi.forEach(e.qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!gi(t))throw t;xr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ts.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ts=n.ts.insert(e,i)}}}(r.localStore,s))}async function Zc(t,e){const n=Fr(t);if(!n.currentUser.isEqual(e)){xr("SyncEngine","User change. New user:",e.toKey());const t=await yu(n.localStore,e);n.currentUser=e,function(t,e){t.ba.forEach((t=>{t.forEach((t=>{t.reject(new Br(Ur.CANCELLED,e))}))})),t.ba.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Jc(n,t._s)}}function tl(t,e){const n=Fr(t),r=n.ya.get(e);if(r&&r.Ra)return uo().add(r.key);{let t=uo();const r=n.fa.get(e);if(!r)return t;for(const e of r){const r=n.ma.get(e);t=t.unionWith(r.view.ua)}return t}}function el(t){const e=Fr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Bc.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=jc.bind(null,e),e.Va.a_=Ac.bind(null,e.eventManager),e.Va.Fa=kc.bind(null,e.eventManager),e}function nl(t){const e=Fr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zc.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$c.bind(null,e),e}class rl{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Mu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return gu(this.persistence,new pu,t.initialUser,this.serializer)}createPersistence(t){return new cu(hu.jr,this.serializer)}createSharedClientState(t){return new Cu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class il{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>qc(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Zc.bind(null,this.syncEngine),await mc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Sc}createDatastore(t){const e=Mu(t.databaseInfo.databaseId),n=function(t){return new Lu(t)}(t.databaseInfo);return function(t,e,n,r){return new qu(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new zu(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>qc(this.syncEngine,t,0)),ku.D()?new ku:new Au)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new Mc(t,e,n,r,i,s);return o&&(a.Ca=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Fr(t);xr("RemoteStore","RemoteStore shutting down."),e.C_.add(5),await Hu(e),e.F_.shutdown(),e.M_.set("Unknown")}(this.remoteStore)}}class sl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Oa(this.observer.next,t)}error(t){this.observer.error?this.Oa(this.observer.error,t):Or("Uncaught Error in snapshot listener:",t.toString())}Na(){this.muted=!0}Oa(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class ol{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=kr.UNAUTHENTICATED,this.clientId=Yr.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{xr("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(xr("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Br(Ur.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new qr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=wc(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function al(t,e){t.asyncQueue.verifyOperationInProgress(),xr("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await yu(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function ul(t,e){t.asyncQueue.verifyOperationInProgress();const n=await ll(t);xr("FirestoreClient","Initializing OnlineComponentProvider");const r=await t.getConfiguration();await e.initialize(n,r),t.setCredentialChangeListener((t=>pc(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>pc(e.remoteStore,n))),t._onlineComponents=e}function cl(t){return"FirebaseError"===t.name?t.code===Ur.FAILED_PRECONDITION||t.code===Ur.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}async function ll(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){xr("FirestoreClient","Using user provided OfflineComponentProvider");try{await al(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!cl(n))throw n;Lr("Error using user provided cache. Falling back to memory cache: "+n),await al(t,new rl)}}else xr("FirestoreClient","Using default OfflineComponentProvider"),await al(t,new rl);return t._offlineComponents}async function hl(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(xr("FirestoreClient","Using user provided OnlineComponentProvider"),await ul(t,t._uninitializedComponentsProvider._online)):(xr("FirestoreClient","Using default OnlineComponentProvider"),await ul(t,new il))),t._onlineComponents}function dl(t){return hl(t).then((t=>t.syncEngine))}async function fl(t){const e=await hl(t),n=e.eventManager;return n.onListen=Vc.bind(null,e.syncEngine),n.onUnlisten=Uc.bind(null,e.syncEngine),n}function pl(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const ml=new Map;function gl(t,e,n){if(!n)throw new Br(Ur.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function yl(t){if(!oi.isDocumentKey(t))throw new Br(Ur.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function vl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Mr()}function wl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Br(Ur.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=vl(t);throw new Br(Ur.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class _l{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Br(Ur.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Br(Ur.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Br(Ur.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)})("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=pl(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Br(Ur.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Br(Ur.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Br(Ur.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class bl{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new _l({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Br(Ur.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Br(Ur.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new _l(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new zr;switch(t.type){case"firstParty":return new Gr(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Br(Ur.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ml.get(t);e&&(xr("ComponentProvider","Removing Datastore"),ml.delete(t),e.terminate())}(this),Promise.resolve()}}class El{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new El(this.firestore,t,this._query)}}class Tl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Sl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Tl(this.firestore,t,this._key)}}class Sl extends El{constructor(t,e,n){super(t,e,Vs(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Tl(this.firestore,null,new oi(t))}withConverter(t){return new Sl(this.firestore,t,this._path)}}function Il(t,e,...n){if(t=(0,a.m9)(t),1===arguments.length&&(e=Yr.newId()),gl("doc","path",e),t instanceof bl){const r=ri.fromString(e,...n);return yl(r),new Tl(t,null,new oi(r))}{if(!(t instanceof Tl||t instanceof Sl))throw new Br(Ur.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ri.fromString(e,...n));return yl(r),new Tl(t.firestore,t instanceof Sl?t.converter:null,new oi(r))}}function Cl(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),(t instanceof Tl||t instanceof Sl)&&(e instanceof Tl||e instanceof Sl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}class Al{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Vu(this,"async_queue_retry"),this.iu=()=>{const t=Pu();t&&xr("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const t=Pu();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.su(),this.ou(t)}enterRestrictedMode(t){if(!this.Za){this.Za=!0,this.nu=t||!1;const e=Pu();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.iu)}}enqueue(t){if(this.su(),this.Za)return new Promise((()=>{}));const e=new qr;return this.ou((()=>this.Za&&this.nu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Ya.push(t),this._u())))}async _u(){if(0!==this.Ya.length){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(t){if(!gi(t))throw t;xr("AsyncQueue","Operation failed with retryable error: "+t)}this.Ya.length>0&&this.zo.ko((()=>this._u()))}}ou(t){const e=this.Ja.then((()=>(this.tu=!0,t().catch((t=>{this.eu=t,this.tu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Or("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.tu=!1,t))))));return this.Ja=e,e}enqueueAfterDelay(t,e,n){this.su(),this.ru.indexOf(t)>-1&&(e=0);const r=vc.createAndSchedule(this,t,e,n,(t=>this.au(t)));return this.Xa.push(r),r}su(){this.eu&&Mr()}verifyOperationInProgress(){}async uu(){let t;do{t=this.Ja,await t}while(t!==this.Ja)}cu(t){for(const e of this.Xa)if(e.timerId===t)return!0;return!1}lu(t){return this.uu().then((()=>{this.Xa.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.Xa)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.uu()}))}hu(t){this.ru.push(t)}au(t){const e=this.Xa.indexOf(t);this.Xa.splice(e,1)}}function kl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of e)if(t in n&&"function"==typeof n[t])return!0;return!1}(t,["next","error","complete"])}class Dl extends bl{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Al,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||xl(this),this._firestoreClient.terminate()}}function Nl(t,e){const n="object"==typeof t?t:(0,i.Mq)(),r="string"==typeof t?t:e||"(default)",s=(0,i.qX)(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const t=(0,a.P0)("firestore");t&&function(t,e,n,r={}){var i;const s=(t=wl(t,bl))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==o&&Lr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=kr.MOCK_USER;else{e=(0,a.Sg)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Br(Ur.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new kr(s)}t._authCredentials=new $r(new jr(e,n))}}(s,...t)}return s}function Rl(t){return t._firestoreClient||xl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function xl(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new ji(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,pl(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new ol(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class Ol{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ol(Li.fromBase64String(t))}catch(t){throw new Br(Ur.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ol(Li.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Ll{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Br(Ur.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new si(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Pl{constructor(t){this._methodName=t}}class Ml{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Br(Ur.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Br(Ur.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Jr(this._lat,t._lat)||Jr(this._long,t._long)}}const Vl=/^__.*__$/;class Fl{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Vo(t,this.data,this.fieldMask,e,this.fieldTransforms):new Mo(t,this.data,e,this.fieldTransforms)}}function Ul(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Mr()}}class Bl{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Pu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(t){return new Bl(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tu({path:n,du:!1});return r.Au(t),r}Ru(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Tu({path:n,du:!1});return r.Pu(),r}Vu(t){return this.Tu({path:void 0,du:!0})}mu(t){return Yl(t,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Pu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Au(this.path.get(t))}Au(t){if(0===t.length)throw this.mu("Document fields must not be empty");if(Ul(this.Iu)&&Vl.test(t))throw this.mu('Document fields cannot begin and end with "__"')}}class ql{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Mu(t)}pu(t,e,n,r=!1){return new Bl({Iu:t,methodName:e,gu:n,path:si.emptyPath(),du:!1,fu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function jl(t){const e=t._freezeSettings(),n=Mu(t._databaseId);return new ql(t._databaseId,!!e.ignoreUndefinedProperties,n)}function zl(t,e,n,r,i,s={}){const o=t.pu(s.merge||s.mergeFields?2:0,e,n,i);Gl("Data must be an object, but it was:",o,r);const a=Hl(r,o);let u,c;if(s.merge)u=new xi(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Ql(e,r,n);if(!o.contains(i))throw new Br(Ur.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Jl(t,i)||t.push(i)}u=new xi(t),c=o.fieldTransforms.filter((t=>u.covers(t.field)))}else u=null,c=o.fieldTransforms;return new Fl(new ss(a),u,c)}function $l(t,e){if(Kl(t=(0,a.m9)(t)))return Gl("Unsupported field value:",e,t),Hl(t,e);if(t instanceof Pl)return function(t,e){if(!Ul(e.Iu))throw e.mu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.mu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.du&&4!==e.Iu)throw e.mu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=$l(i,e.Vu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,a.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return po(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=ti.fromDate(t);return{timestampValue:va(e.serializer,n)}}if(t instanceof ti){const n=new ti(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:va(e.serializer,n)}}if(t instanceof Ml)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Ol)return{bytesValue:wa(e.serializer,t._byteString)};if(t instanceof Tl){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.mu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ea(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.mu(`Unsupported field value: ${vl(t)}`)}(t,e)}function Hl(t,e){const n={};return Ci(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ii(t,((t,r)=>{const i=$l(r,e.Eu(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Kl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ti||t instanceof Ml||t instanceof Ol||t instanceof Tl||t instanceof Pl)}function Gl(t,e,n){if(!Kl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=vl(n);throw"an object"===r?e.mu(t+" a custom object"):e.mu(t+" "+r)}}function Ql(t,e,n){if((e=(0,a.m9)(e))instanceof Ll)return e._internalPath;if("string"==typeof e)return Xl(t,e);throw Yl("Field path arguments must be of type string or ",t,!1,void 0,n)}const Wl=new RegExp("[~\\*/\\[\\]]");function Xl(t,e,n){if(e.search(Wl)>=0)throw Yl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ll(...e.split("."))._internalPath}catch(r){throw Yl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Yl(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new Br(Ur.INVALID_ARGUMENT,a+t+u)}function Jl(t,e){return t.some((t=>t.isEqual(e)))}class Zl{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Tl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new th(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(eh("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class th extends Zl{data(){return super.data()}}function eh(t,e){return"string"==typeof e?Xl(t,e):e instanceof Ll?e._internalPath:e._delegate._internalPath}function nh(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new Br(Ur.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class rh{convertValue(t,e="none"){switch(Hi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Vi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Fi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Mr()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ii(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Ml(Vi(t.latitude),Vi(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Bi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(qi(t));default:return null}}convertTimestamp(t){const e=Mi(t);return new ti(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ri.fromString(t);Vr(za(n));const r=new zi(n.get(1),n.get(3)),i=new oi(n.popFirst(5));return r.isEqual(e)||Or(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}function ih(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class sh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class oh extends Zl{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ah(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(eh("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class ah extends oh{data(t={}){return super.data(t)}}class uh{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new sh(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new ah(this._firestore,this._userDataWriter,n.key,n,new sh(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Br(Ur.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const r=new ah(t._firestore,t._userDataWriter,n.doc.key,n.doc,new sh(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const r=new ah(t._firestore,t._userDataWriter,e.doc.key,e.doc,new sh(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:ch(e.type),doc:r,oldIndex:i,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function ch(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Mr()}}class lh extends rh{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ol(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Tl(this.firestore,null,e)}}function hh(t,e,n){t=wl(t,Tl);const r=wl(t.firestore,Dl),i=ih(t.converter,e,n);return fh(r,[zl(jl(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ko.none())])}function dh(t,...e){var n,r,i;t=(0,a.m9)(t);let s={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||kl(e[o])||(s=e[o],o++);const u={includeMetadataChanges:s.includeMetadataChanges};if(kl(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,l,h;if(t instanceof Tl)l=wl(t.firestore,Dl),h=Vs(t._key.path),c={next:n=>{e[o]&&e[o](ph(l,t,n))},error:e[o+1],complete:e[o+2]};else{const n=wl(t,El);l=wl(n.firestore,Dl),h=n._query;const r=new lh(l);c={next:t=>{e[o]&&e[o](new uh(l,r,n,t))},error:e[o+1],complete:e[o+2]},nh(t._query)}return function(t,e,n,r){const i=new sl(r),s=new Nc(e,i,n);return t.asyncQueue.enqueueAndForget((async()=>Ic(await fl(t),s))),()=>{i.Na(),t.asyncQueue.enqueueAndForget((async()=>Cc(await fl(t),s)))}}(Rl(l),h,u,c)}function fh(t,e){return function(t,e){const n=new qr;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=nl(t);try{const t=await function(t,e){const n=Fr(t),r=ti.now(),i=e.reduce(((t,e)=>t.add(e.key)),uo());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Zs(),u=uo();return n.ss.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(u=u.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=Lo(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Vo(t.key,e,os(e.value.mapValue),ko.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,u);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:no(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Sa[t.currentUser.toKey()];r||(r=new Ai(Jr)),r=r.insert(e,n),t.Sa[t.currentUser.toKey()]=r}(r,t.batchId,n),await Jc(r,t.changes),await sc(r.remoteStore)}catch(t){const e=wc(t,"Failed to persist write");n.reject(e)}}(await dl(t),e,n))),n.promise}(Rl(t),e)}function ph(t,e,n){const r=n.docs.get(e._key),i=new lh(t);return new oh(t,i,e._key,r,new sh(n.hasPendingWrites,n.fromCache),e.converter)}new WeakMap;!function(t,e=!0){!function(t){Dr=t}(i.Jn),(0,i.Xd)(new s.wA("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Dl(new Hr(t.getProvider("auth-internal")),new Wr(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Br(Ur.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new zi(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),(0,i.KN)(Ar,"4.4.0",t),(0,i.KN)(Ar,"4.4.0","esm2017")}()},8650:(t,e,n)=>{n.r(e),n.d(e,{AggregateField:()=>fn,AggregateQuerySnapshot:()=>pn,Bytes:()=>Tn,CollectionReference:()=>yn,DocumentReference:()=>gn,DocumentSnapshot:()=>tr,FieldPath:()=>Sn,FieldValue:()=>Cn,Firestore:()=>un,FirestoreError:()=>x,GeoPoint:()=>An,Query:()=>mn,QueryCompositeFilterConstraint:()=>lr,QueryConstraint:()=>or,QueryDocumentSnapshot:()=>er,QueryEndAtConstraint:()=>br,QueryFieldFilterConstraint:()=>ur,QueryLimitConstraint:()=>mr,QueryOrderByConstraint:()=>fr,QuerySnapshot:()=>nr,QueryStartAtConstraint:()=>vr,Timestamp:()=>Tt,Transaction:()=>ii,WriteBatch:()=>Wr,addDoc:()=>Mr,aggregateFieldEqual:()=>jr,aggregateQuerySnapshotEqual:()=>zr,and:()=>dr,arrayRemove:()=>Gr,arrayUnion:()=>Kr,average:()=>Br,collection:()=>vn,collectionGroup:()=>wn,connectFirestoreEmulator:()=>hn,count:()=>qr,deleteDoc:()=>Pr,deleteField:()=>$r,doc:()=>_n,documentId:()=>In,endAt:()=>Tr,endBefore:()=>Er,getAggregate:()=>Fr,getCount:()=>Vr,getDoc:()=>Rr,getDocs:()=>xr,getFirestore:()=>ln,increment:()=>Qr,initializeFirestore:()=>cn,limit:()=>gr,limitToLast:()=>yr,or:()=>hr,orderBy:()=>pr,query:()=>ar,queryEqual:()=>En,refEqual:()=>bn,runTransaction:()=>si,serverTimestamp:()=>Hr,setDoc:()=>Or,setLogLevel:()=>l,snapshotEqual:()=>rr,startAfter:()=>_r,startAt:()=>wr,sum:()=>Ur,terminate:()=>dn,updateDoc:()=>Lr,where:()=>cr,writeBatch:()=>Yr});var r=n(389),i=n(8463),s=n(3333),o=n(4444);class a{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}a.UNAUTHENTICATED=new a(null),a.GOOGLE_CREDENTIALS=new a("google-credentials-uid"),a.FIRST_PARTY=new a("first-party-uid"),a.MOCK_USER=new a("mock-user");let u="10.7.0";const c=new s.Yd("@firebase/firestore");function l(t){c.setLogLevel(t)}function h(t,...e){if(c.logLevel<=s.in.DEBUG){const n=e.map(p);c.debug(`Firestore (${u}): ${t}`,...n)}}function d(t,...e){if(c.logLevel<=s.in.ERROR){const n=e.map(p);c.error(`Firestore (${u}): ${t}`,...n)}}function f(t,...e){if(c.logLevel<=s.in.WARN){const n=e.map(p);c.warn(`Firestore (${u}): ${t}`,...n)}}function p(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function m(t="Unexpected state"){const e=`FIRESTORE (${u}) INTERNAL ASSERTION FAILED: `+t;throw d(e),new Error(e)}function g(t,e){t||m()}function y(t,e){return t}const v="cancelled",w="unknown",_="invalid-argument",b="deadline-exceeded",E="not-found",T="permission-denied",S="unauthenticated",I="resource-exhausted",C="failed-precondition",A="aborted",k="out-of-range",D="unimplemented",N="internal",R="unavailable";class x extends o.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class O{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class L{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class P{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(a.UNAUTHENTICATED)))}shutdown(){}}class M{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class V{constructor(t){this.auth=null,t.onInit((t=>{this.auth=t}))}getToken(){return this.auth?this.auth.getToken().then((t=>t?(g("string"==typeof t.accessToken),new L(t.accessToken,new a(this.auth.getUid()))):null)):Promise.resolve(null)}invalidateToken(){}start(t,e){}shutdown(){}}class F{constructor(t,e,n){this.t=t,this.i=e,this.o=n,this.type="FirstParty",this.user=a.FIRST_PARTY,this.u=new Map}l(){return this.o?this.o():null}get headers(){this.u.set("X-Goog-AuthUser",this.t);const t=this.l();return t&&this.u.set("Authorization",t),this.i&&this.u.set("X-Goog-Iam-Authorization-Token",this.i),this.u}}class U{constructor(t,e,n){this.t=t,this.i=e,this.o=n}getToken(){return Promise.resolve(new F(this.t,this.i,this.o))}start(t,e){t.enqueueRetryable((()=>e(a.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class B{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class q{constructor(t){this.h=t,this.appCheck=null,t.onInit((t=>{this.appCheck=t}))}getToken(){return this.appCheck?this.appCheck.getToken().then((t=>t?(g("string"==typeof t.token),new B(t.token)):null)):Promise.resolve(null)}invalidateToken(){}start(t,e){}shutdown(){}}class j{constructor(t,e,n,r,i,s,o,a,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=u}}class z{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new z("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof z&&t.projectId===this.projectId&&t.database===this.database}}class ${constructor(t,e,n){void 0===e?e=0:e>t.length&&m(),void 0===n?n=t.length-e:n>t.length-e&&m(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===$.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof $?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class H extends ${construct(t,e,n){return new H(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new x(_,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new H(e)}static emptyPath(){return new H([])}}const K=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class G extends ${construct(t,e,n){return new G(t,e,n)}static isValidIdentifier(t){return K.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),G.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new G(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new x(_,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new x(_,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new x(_,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new x(_,"Unterminated ` in path: "+t);return new G(e)}static emptyPath(){return new G([])}}class Q{constructor(t){this.path=t}static fromPath(t){return new Q(H.fromString(t))}static fromName(t){return new Q(H.fromString(t).popFirst(5))}static empty(){return new Q(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===H.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return H.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Q(new H(t.slice()))}}function W(t,e,n){if(!n)throw new x(_,`Function ${t}() cannot be called with an empty ${e}.`)}function X(t){if(!Q.isDocumentKey(t))throw new x(_,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Y(t){if(Q.isDocumentKey(t))throw new x(_,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function J(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":m()}function Z(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new x(_,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=J(t);throw new x(_,`Expected type '${e.name}', but it was: ${n}`)}}return t}function tt(t,e){if(e<=0)throw new x(_,`Function ${t}() requires a positive number, but it was: ${e}.`)}function et(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}let nt=null;function rt(t){return null==t}function it(t){return 0===t&&1/t==-1/0}const st={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var ot,at;function ut(t){if(void 0===t)return d("RPC_ERROR","HTTP error has no status"),w;switch(t){case 200:return"ok";case 400:return C;case 401:return S;case 403:return T;case 404:return E;case 409:return A;case 416:return k;case 429:return I;case 499:return v;case 500:return w;case 501:return D;case 503:return R;case 504:return b;default:return t>=200&&t<300?"ok":t>=400&&t<500?C:t>=500&&t<600?N:w}}(at=ot||(ot={}))[at.OK=0]="OK",at[at.CANCELLED=1]="CANCELLED",at[at.UNKNOWN=2]="UNKNOWN",at[at.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",at[at.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",at[at.NOT_FOUND=5]="NOT_FOUND",at[at.ALREADY_EXISTS=6]="ALREADY_EXISTS",at[at.PERMISSION_DENIED=7]="PERMISSION_DENIED",at[at.UNAUTHENTICATED=16]="UNAUTHENTICATED",at[at.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",at[at.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",at[at.ABORTED=10]="ABORTED",at[at.OUT_OF_RANGE=11]="OUT_OF_RANGE",at[at.UNIMPLEMENTED=12]="UNIMPLEMENTED",at[at.INTERNAL=13]="INTERNAL",at[at.UNAVAILABLE=14]="UNAVAILABLE",at[at.DATA_LOSS=15]="DATA_LOSS";class ct extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.m=e+"://"+t.host,this.A=`projects/${n}/databases/${r}`,this.T="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get P(){return!1}R(t,e,n,r,i){const s=(null===nt?nt=268435456+Math.round(2147483648*Math.random()):nt++,"0x"+nt.toString(16)),o=this.I(t,e);h("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.A,"x-goog-request-params":this.T};return this.V(a,r,i),this.p(t,o,a,n).then((e=>(h("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw f("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}g(t,e,n,r,i,s){return this.R(t,e,n,r,i)}V(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+u,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}I(t,e){const n=st[t];return`${this.m}/v1/${e}:${n}`}}{constructor(t,e){super(t),this.F=e}v(t,e){throw new Error("Not supported by FetchConnection")}async p(t,e,n,r){var i;const s=JSON.stringify(r);let o;try{o=await this.F(e,{method:"POST",headers:n,body:s})}catch(t){const e=t;throw new x(ut(e.status),"Request failed with error: "+e.statusText)}if(!o.ok){let t=await o.json();Array.isArray(t)&&(t=t[0]);const e=null===(i=null==t?void 0:t.error)||void 0===i?void 0:i.message;throw new x(ut(o.status),`Request failed with error: ${null!=e?e:o.statusText}`)}return o.json()}}class lt{constructor(t,e,n){this.alias=t,this.aggregateType=e,this.fieldPath=n}}function ht(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class dt{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(256/62);let n="";for(;n.length<20;){const r=ht(40);for(let i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%62))}return n}}function ft(t,e){return t<e?-1:t>e?1:0}function pt(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}function mt(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function gt(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class yt extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class vt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new yt("Invalid base64 string: "+t):t}}(t);return new vt(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new vt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ft(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}vt.EMPTY_BYTE_STRING=new vt("");const wt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function _t(t){if(g(!!t),"string"==typeof t){let e=0;const n=wt.exec(t);if(g(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:bt(t.seconds),nanos:bt(t.nanos)}}function bt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Et(t){return"string"==typeof t?vt.fromBase64String(t):vt.fromUint8Array(t)}class Tt{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new x(_,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new x(_,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new x(_,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new x(_,"Timestamp seconds out of range: "+t)}static now(){return Tt.fromMillis(Date.now())}static fromDate(t){return Tt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Tt(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ft(this.nanoseconds,t.nanoseconds):ft(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}function St(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function It(t){const e=t.mapValue.fields.__previous_value__;return St(e)?It(e):e}function Ct(t){const e=_t(t.mapValue.fields.__local_write_time__.timestampValue);return new Tt(e.seconds,e.nanos)}const At={fields:{__type__:{stringValue:"__max__"}}};function kt(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?St(t)?4:function(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}(t)?9007199254740991:10:m()}function Dt(t,e){if(t===e)return!0;const n=kt(t);if(n!==kt(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Ct(t).isEqual(Ct(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=_t(t.timestampValue),r=_t(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Et(t.bytesValue).isEqual(Et(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return bt(t.geoPointValue.latitude)===bt(e.geoPointValue.latitude)&&bt(t.geoPointValue.longitude)===bt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return bt(t.integerValue)===bt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=bt(t.doubleValue),r=bt(e.doubleValue);return n===r?it(n)===it(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return pt(t.arrayValue.values||[],e.arrayValue.values||[],Dt);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(mt(n)!==mt(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Dt(n[t],r[t])))return!1;return!0}(t,e);default:return m()}}function Nt(t,e){return void 0!==(t.values||[]).find((t=>Dt(t,e)))}function Rt(t,e){if(t===e)return 0;const n=kt(t),r=kt(e);if(n!==r)return ft(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ft(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=bt(t.integerValue||t.doubleValue),r=bt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return xt(t.timestampValue,e.timestampValue);case 4:return xt(Ct(t),Ct(e));case 5:return ft(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Et(t),r=Et(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ft(n[t],r[t]);if(0!==e)return e}return ft(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ft(bt(t.latitude),bt(e.latitude));return 0!==n?n:ft(bt(t.longitude),bt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Rt(n[t],r[t]);if(e)return e}return ft(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===At&&e===At)return 0;if(t===At)return 1;if(e===At)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=ft(r[t],s[t]);if(0!==e)return e;const o=Rt(n[r[t]],i[s[t]]);if(0!==o)return o}return ft(r.length,s.length)}(t.mapValue,e.mapValue);default:throw m()}}function xt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ft(t,e);const n=_t(t),r=_t(e),i=ft(n.seconds,r.seconds);return 0!==i?i:ft(n.nanos,r.nanos)}function Ot(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Lt(t){return!!t&&"arrayValue"in t}function Pt(t){return!!t&&"nullValue"in t}function Mt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Vt(t){return!!t&&"mapValue"in t}function Ft(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return gt(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Ft(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Ft(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Ut{constructor(t,e){this.position=t,this.inclusive=e}}function Bt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Dt(t.position[n],e.position[n]))return!1;return!0}class qt{}class jt extends qt{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Ht(t,e,n):"array-contains"===e?new Wt(t,n):"in"===e?new Xt(t,n):"not-in"===e?new Yt(t,n):"array-contains-any"===e?new Jt(t,n):new jt(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Kt(t,n):new Gt(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Rt(e,this.value)):null!==e&&kt(this.value)===kt(e)&&this.matchesComparison(Rt(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return m()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zt extends qt{constructor(t,e){super(),this.filters=t,this.op=e,this.D=null}static create(t,e){return new zt(t,e)}matches(t){return function(t){return"and"===t.op}(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.D||(this.D=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.D}getFilters(){return Object.assign([],this.filters)}}function $t(t,e){return t instanceof jt?function(t,e){return e instanceof jt&&t.op===e.op&&t.field.isEqual(e.field)&&Dt(t.value,e.value)}(t,e):t instanceof zt?function(t,e){return e instanceof zt&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&$t(n,e.filters[r])),!0)}(t,e):void m()}class Ht extends jt{constructor(t,e,n){super(t,e,n),this.key=Q.fromName(n.referenceValue)}matches(t){const e=Q.comparator(t.key,this.key);return this.matchesComparison(e)}}class Kt extends jt{constructor(t,e){super(t,"in",e),this.keys=Qt("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Gt extends jt{constructor(t,e){super(t,"not-in",e),this.keys=Qt("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Qt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Q.fromName(t.referenceValue)))}class Wt extends jt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Lt(e)&&Nt(e.arrayValue,this.value)}}class Xt extends jt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Nt(this.value.arrayValue,e)}}class Yt extends jt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Nt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Nt(this.value.arrayValue,e)}}class Jt extends jt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Lt(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Nt(this.value.arrayValue,t)))}}class Zt{constructor(t,e="asc"){this.field=t,this.dir=e}}function te(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ee{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ee(t)}static min(){return new ee(new Tt(0,0))}static max(){return new ee(new Tt(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ne{constructor(t,e){this.comparator=t,this.root=e||ie.EMPTY}insert(t,e){return new ne(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ie.BLACK,null,null))}remove(t){return new ne(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ie.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new re(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new re(this.root,t,this.comparator,!1)}getReverseIterator(){return new re(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new re(this.root,t,this.comparator,!0)}}class re{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ie{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:ie.RED,this.left=null!=r?r:ie.EMPTY,this.right=null!=i?i:ie.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new ie(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return ie.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return ie.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ie.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ie.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw m();if(this.right.isRed())throw m();const t=this.left.check();if(t!==this.right.check())throw m();return t+(this.isRed()?0:1)}}ie.EMPTY=null,ie.RED=!0,ie.BLACK=!1,ie.EMPTY=new class{constructor(){this.size=0}get key(){throw m()}get value(){throw m()}get color(){throw m()}get left(){throw m()}get right(){throw m()}copy(t,e,n,r,i){return this}insert(t,e,n){return new ie(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class se{constructor(t){this.comparator=t,this.data=new ne(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new oe(this.data.getIterator())}getIteratorFrom(t){return new oe(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof se))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new se(this.comparator);return e.data=t,e}}class oe{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ae{constructor(t){this.fields=t,t.sort(G.comparator)}static empty(){return new ae([])}unionWith(t){let e=new se(G.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ae(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return pt(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class ue{constructor(t){this.value=t}static empty(){return new ue({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Vt(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Ft(e)}setAll(t){let e=G.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=Ft(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());Vt(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Dt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];Vt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){gt(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new ue(Ft(this.value))}}class ce{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new ce(t,0,ee.min(),ee.min(),ee.min(),ue.empty(),0)}static newFoundDocument(t,e,n,r){return new ce(t,1,e,ee.min(),n,r,0)}static newNoDocument(t,e){return new ce(t,2,e,ee.min(),ee.min(),ue.empty(),0)}static newUnknownDocument(t,e){return new ce(t,3,e,ee.min(),ee.min(),ue.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ee.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ue.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ee.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof ce&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new ce(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class le{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.C=null}}function he(t,e=null,n=[],r=[],i=null,s=null,o=null){return new le(t,e,n,r,i,s,o)}class de{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.S=null,this.N=null,this.O=null,this.startAt,this.endAt}}function fe(t){return null!==t.collectionGroup}function pe(t){const e=y(t);if(null===e.S){e.S=[];const t=new Set;for(const n of e.explicitOrderBy)e.S.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new se(G.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.S.push(new Zt(r,n))})),t.has(G.keyField().canonicalString())||e.S.push(new Zt(G.keyField(),n))}return e.S}function me(t){const e=y(t);return e.N||(e.N=ge(e,pe(t))),e.N}function ge(t,e){if("F"===t.limitType)return he(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new Zt(t.field,e)}));const n=t.endAt?new Ut(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ut(t.startAt.position,t.startAt.inclusive):null;return he(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function ye(t,e){const n=t.filters.concat([e]);return new de(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function ve(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!it(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?function(t){return{integerValue:""+t}}(e):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:it(e)?"-0":e}}(t,e)}class we{constructor(){this._=void 0}}class _e extends we{}class be extends we{constructor(t){super(),this.elements=t}}class Ee extends we{constructor(t){super(),this.elements=t}}class Te extends we{constructor(t,e){super(),this.serializer=t,this.q=e}}class Se{constructor(t,e){this.field=t,this.transform=e}}class Ie{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ie}static exists(t){return new Ie(void 0,t)}static updateTime(t){return new Ie(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class Ce{}class Ae extends Ce{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class ke extends Ce{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}class De extends Ce{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ne extends Ce{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}const Re={asc:"ASCENDING",desc:"DESCENDING"},xe={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Oe={and:"AND",or:"OR"};class Le{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Pe(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Me(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Ve(t,e){return Pe(t,e.toTimestamp())}function Fe(t){return g(!!t),ee.fromTimestamp(function(t){const e=_t(t);return new Tt(e.seconds,e.nanos)}(t))}function Ue(t,e){return function(t){return new H(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Be(t,e){return Ue(t.databaseId,e.path)}function qe(t,e){const n=function(t){const e=H.fromString(t);return g(Je(e)),e}(e);if(n.get(1)!==t.databaseId.projectId)throw new x(_,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new x(_,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Q(function(t){return g(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}(n))}function je(t,e){return Ue(t.databaseId,e)}function ze(t){return new H(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function $e(t,e,n){return{name:Be(t,e),fields:n.value.mapValue.fields}}function He(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=je(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=je(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(t){if(0!==t.length)return Xe(zt.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:We(t.field),direction:Ke(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=function(t,e){return t.useProto3Json||rt(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function Ke(t){return Re[t]}function Ge(t){return xe[t]}function Qe(t){return Oe[t]}function We(t){return{fieldPath:t.canonicalString()}}function Xe(t){return t instanceof jt?function(t){if("=="===t.op){if(Mt(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NAN"}};if(Pt(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Mt(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NOT_NAN"}};if(Pt(t.value))return{unaryFilter:{field:We(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:We(t.field),op:Ge(t.op),value:t.value}}}(t):t instanceof zt?function(t){const e=t.getFilters().map((t=>Xe(t)));return 1===e.length?e[0]:{compositeFilter:{op:Qe(t.op),filters:e}}}(t):m()}function Ye(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Je(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function Ze(t){return new Le(t,!0)}class tn{constructor(t,e,n=1e3,r=1.5,i=6e4){this.B=t,this.timerId=e,this.$=n,this.L=r,this.M=i,this.k=0,this.U=null,this.j=Date.now(),this.reset()}reset(){this.k=0}W(){this.k=this.M}K(t){this.cancel();const e=Math.floor(this.k+this.G()),n=Math.max(0,Date.now()-this.j),r=Math.max(0,e-n);r>0&&h("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.k} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.U=this.B.enqueueAfterDelay(this.timerId,r,(()=>(this.j=Date.now(),t()))),this.k*=this.L,this.k<this.$&&(this.k=this.$),this.k>this.M&&(this.k=this.M)}H(){null!==this.U&&(this.U.skipDelay(),this.U=null)}cancel(){null!==this.U&&(this.U.cancel(),this.U=null)}G(){return(Math.random()-.5)*this.k}}class en extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.J=!1}Y(){if(this.J)throw new x(C,"The client has already been terminated.")}R(t,e,n){return this.Y(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,i])=>this.connection.R(t,e,n,r,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===S&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new x(w,t.toString())}))}g(t,e,n,r){return this.Y(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.g(t,e,n,i,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===S&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new x(w,t.toString())}))}terminate(){this.J=!0}}async function nn(t,e){const n=y(t),r=ze(n.serializer)+"/documents",i={writes:e.map((t=>function(t,e){let n;if(e instanceof Ae)n={update:$e(t,e.key,e.value)};else if(e instanceof De)n={delete:Be(t,e.key)};else if(e instanceof ke)n={update:$e(t,e.key,e.data),updateMask:Ye(e.fieldMask)};else{if(!(e instanceof Ne))return m();n={verify:Be(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof _e)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof be)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ee)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Te)return{fieldPath:e.field.canonicalString(),increment:n.q};throw m()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ve(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:m()}(t,e.precondition)),n}(n.serializer,t)))};await n.R("Commit",r,i)}async function rn(t,e){const n=y(t),r=ze(n.serializer)+"/documents",i={documents:e.map((t=>Be(n.serializer,t)))},s=await n.g("BatchGetDocuments",r,i,e.length),o=new Map;s.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){g(!!e.found),e.found.name,e.found.updateTime;const n=qe(t,e.found.name),r=Fe(e.found.updateTime),i=e.found.createTime?Fe(e.found.createTime):ee.min(),s=new ue({mapValue:{fields:e.found.fields}});return ce.newFoundDocument(n,r,i,s)}(t,e):"missing"in e?function(t,e){g(!!e.missing),g(!!e.readTime);const n=qe(t,e.missing),r=Fe(e.readTime);return ce.newNoDocument(n,r)}(t,e):m()}(n.serializer,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());g(!!e),a.push(e)})),a}const sn=new Map;function on(t){if(t._terminated)throw new x(C,"The client has already been terminated.");if(!sn.has(t)){h("ComponentProvider","Initializing Datastore");const e=function(t){return new ct(t,fetch.bind(null))}(function(t,e,n,r){return new j(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,et(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,t.app.options.appId||"",t._persistenceKey,t._freezeSettings())),n=Ze(t._databaseId),r=function(t,e,n,r){return new en(t,e,n,r)}(t._authCredentials,t._appCheckCredentials,e,n);sn.set(t,r)}return sn.get(t)}class an{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new x(_,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new x(_,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}!function(t,e,n,r){if(!0===e&&!0===r)throw new x(_,`${t} and ${n} cannot be used together.`)}("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=et(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new x(_,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new x(_,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new x(_,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class un{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new an({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new x(C,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new x(C,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new an(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new P;switch(t.type){case"firstParty":return new U(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new x(_,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=sn.get(t);e&&(h("ComponentProvider","Removing Datastore"),sn.delete(t),e.terminate())}(this),Promise.resolve()}}function cn(t,e,n){n||(n="(default)");const i=(0,r.qX)(t,"firestore/lite");if(i.isInitialized(n))throw new x(C,"Firestore can only be initialized once per app.");return i.initialize({options:e,instanceIdentifier:n})}function ln(t,e){const n="object"==typeof t?t:(0,r.Mq)(),i="string"==typeof t?t:e||"(default)",s=(0,r.qX)(n,"firestore/lite").getImmediate({identifier:i});if(!s._initialized){const t=(0,o.P0)("firestore");t&&hn(s,...t)}return s}function hn(t,e,n,r={}){var i;const s=(t=Z(t,un))._getSettings(),u=`${e}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==u&&f("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:u,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=a.MOCK_USER;else{e=(0,o.Sg)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new x(_,"mockUserToken must contain 'sub' or 'user_id' field!");n=new a(s)}t._authCredentials=new M(new L(e,n))}}function dn(t){return t=Z(t,un),(0,r.wN)(t.app,"firestore/lite"),t._delete()}class fn{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}}class pn{constructor(t,e,n){this._userDataWriter=e,this._data=n,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}}class mn{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new mn(this.firestore,t,this._query)}}class gn{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new yn(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new gn(this.firestore,t,this._key)}}class yn extends mn{constructor(t,e,n){super(t,e,function(t){return new de(t)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new gn(this.firestore,null,new Q(t))}withConverter(t){return new yn(this.firestore,t,this._path)}}function vn(t,e,...n){if(t=(0,o.m9)(t),W("collection","path",e),t instanceof un){const r=H.fromString(e,...n);return Y(r),new yn(t,null,r)}{if(!(t instanceof gn||t instanceof yn))throw new x(_,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(H.fromString(e,...n));return Y(r),new yn(t.firestore,null,r)}}function wn(t,e){if(t=Z(t,un),W("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new x(_,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new mn(t,null,function(t){return new de(H.emptyPath(),t)}(e))}function _n(t,e,...n){if(t=(0,o.m9)(t),1===arguments.length&&(e=dt.newId()),W("doc","path",e),t instanceof un){const r=H.fromString(e,...n);return X(r),new gn(t,null,new Q(r))}{if(!(t instanceof gn||t instanceof yn))throw new x(_,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(H.fromString(e,...n));return X(r),new gn(t.firestore,t instanceof yn?t.converter:null,new Q(r))}}function bn(t,e){return t=(0,o.m9)(t),e=(0,o.m9)(e),(t instanceof gn||t instanceof yn)&&(e instanceof gn||e instanceof yn)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function En(t,e){return t=(0,o.m9)(t),e=(0,o.m9)(e),t instanceof mn&&e instanceof mn&&t.firestore===e.firestore&&function(t,e){return function(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!te(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!$t(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Bt(t.startAt,e.startAt)&&Bt(t.endAt,e.endAt)}(me(t),me(e))&&t.limitType===e.limitType}(t._query,e._query)&&t.converter===e.converter}class Tn{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Tn(vt.fromBase64String(t))}catch(t){throw new x(_,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Tn(vt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Sn{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new x(_,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new G(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function In(){return new Sn("__name__")}class Cn{constructor(t){this._methodName=t}}class An{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new x(_,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new x(_,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ft(this._lat,t._lat)||ft(this._long,t._long)}}const kn=/^__.*__$/;class Dn{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new ke(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ae(t,this.data,e,this.fieldTransforms)}}class Nn{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new ke(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Rn(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw m()}}class xn{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.X(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get tt(){return this.settings.tt}et(t){return new xn(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}rt(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.et({path:n,nt:!1});return r.it(t),r}st(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.et({path:n,nt:!1});return r.X(),r}ot(t){return this.et({path:void 0,nt:!0})}ut(t){return Jn(t,this.settings.methodName,this.settings._t||!1,this.path,this.settings.ct)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}X(){if(this.path)for(let t=0;t<this.path.length;t++)this.it(this.path.get(t))}it(t){if(0===t.length)throw this.ut("Document fields must not be empty");if(Rn(this.tt)&&kn.test(t))throw this.ut('Document fields cannot begin and end with "__"')}}class On{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ze(t)}lt(t,e,n,r=!1){return new xn({tt:t,methodName:e,ct:n,path:G.emptyPath(),nt:!1,_t:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ln(t){const e=t._freezeSettings(),n=Ze(t._databaseId);return new On(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Pn(t,e,n,r,i,s={}){const o=t.lt(s.merge||s.mergeFields?2:0,e,n,i);Qn("Data must be an object, but it was:",o,r);const a=Kn(r,o);let u,c;if(s.merge)u=new ae(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=Wn(e,r,n);if(!o.contains(i))throw new x(_,`Field '${i}' is specified in your field mask but missing from your input data.`);Zn(t,i)||t.push(i)}u=new ae(t),c=o.fieldTransforms.filter((t=>u.covers(t.field)))}else u=null,c=o.fieldTransforms;return new Dn(new ue(a),u,c)}class Mn extends Cn{_toFieldTransform(t){if(2!==t.tt)throw 1===t.tt?t.ut(`${this._methodName}() can only appear at the top level of your update data`):t.ut(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Mn}}function Vn(t,e,n){return new xn({tt:3,ct:e.settings.ct,methodName:t._methodName,nt:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Fn extends Cn{_toFieldTransform(t){return new Se(t.path,new _e)}isEqual(t){return t instanceof Fn}}class Un extends Cn{constructor(t,e){super(t),this.ht=e}_toFieldTransform(t){const e=Vn(this,t,!0),n=this.ht.map((t=>Hn(t,e))),r=new be(n);return new Se(t.path,r)}isEqual(t){return this===t}}class Bn extends Cn{constructor(t,e){super(t),this.ht=e}_toFieldTransform(t){const e=Vn(this,t,!0),n=this.ht.map((t=>Hn(t,e))),r=new Ee(n);return new Se(t.path,r)}isEqual(t){return this===t}}class qn extends Cn{constructor(t,e){super(t),this.dt=e}_toFieldTransform(t){const e=new Te(t.serializer,ve(t.serializer,this.dt));return new Se(t.path,e)}isEqual(t){return this===t}}function jn(t,e,n,r){const i=t.lt(1,e,n);Qn("Data must be an object, but it was:",i,r);const s=[],a=ue.empty();gt(r,((t,r)=>{const u=Yn(e,t,n);r=(0,o.m9)(r);const c=i.st(u);if(r instanceof Mn)s.push(u);else{const t=Hn(r,c);null!=t&&(s.push(u),a.set(u,t))}}));const u=new ae(s);return new Nn(a,u,i.fieldTransforms)}function zn(t,e,n,r,i,s){const a=t.lt(1,e,n),u=[Wn(e,r,n)],c=[i];if(s.length%2!=0)throw new x(_,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)u.push(Wn(e,s[t])),c.push(s[t+1]);const l=[],h=ue.empty();for(let t=u.length-1;t>=0;--t)if(!Zn(l,u[t])){const e=u[t];let n=c[t];n=(0,o.m9)(n);const r=a.st(e);if(n instanceof Mn)l.push(e);else{const t=Hn(n,r);null!=t&&(l.push(e),h.set(e,t))}}const d=new ae(l);return new Nn(h,d,a.fieldTransforms)}function $n(t,e,n,r=!1){return Hn(n,t.lt(r?4:3,e))}function Hn(t,e){if(Gn(t=(0,o.m9)(t)))return Qn("Unsupported field value:",e,t),Kn(t,e);if(t instanceof Cn)return function(t,e){if(!Rn(e.tt))throw e.ut(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.ut(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.nt&&4!==e.tt)throw e.ut("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=Hn(i,e.ot(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,o.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ve(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Tt.fromDate(t);return{timestampValue:Pe(e.serializer,n)}}if(t instanceof Tt){const n=new Tt(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Pe(e.serializer,n)}}if(t instanceof An)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Tn)return{bytesValue:Me(e.serializer,t._byteString)};if(t instanceof gn){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.ut(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Ue(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.ut(`Unsupported field value: ${J(t)}`)}(t,e)}function Kn(t,e){const n={};return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):gt(t,((t,r)=>{const i=Hn(r,e.rt(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Gn(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Tt||t instanceof An||t instanceof Tn||t instanceof gn||t instanceof Cn)}function Qn(t,e,n){if(!Gn(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=J(n);throw"an object"===r?e.ut(t+" a custom object"):e.ut(t+" "+r)}}function Wn(t,e,n){if((e=(0,o.m9)(e))instanceof Sn)return e._internalPath;if("string"==typeof e)return Yn(t,e);throw Jn("Field path arguments must be of type string or ",t,!1,void 0,n)}const Xn=new RegExp("[~\\*/\\[\\]]");function Yn(t,e,n){if(e.search(Xn)>=0)throw Jn(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Sn(...e.split("."))._internalPath}catch(r){throw Jn(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Jn(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new x(_,a+t+u)}function Zn(t,e){return t.some((t=>t.isEqual(e)))}class tr{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new gn(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new er(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(ir("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class er extends tr{data(){return super.data()}}class nr{constructor(t,e){this._docs=e,this.query=t}get docs(){return[...this._docs]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(t,e){this._docs.forEach(t,e)}}function rr(t,e){return t=(0,o.m9)(t),e=(0,o.m9)(e),t instanceof tr&&e instanceof tr?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof nr&&e instanceof nr&&En(t.query,e.query)&&pt(t.docs,e.docs,rr)}function ir(t,e){return"string"==typeof e?Yn(t,e):e instanceof Sn?e._internalPath:e._delegate._internalPath}class sr{}class or extends sr{}function ar(t,e,...n){let r=[];e instanceof sr&&r.push(e),r=r.concat(n),function(t){const e=t.filter((t=>t instanceof lr)).length,n=t.filter((t=>t instanceof ur)).length;if(e>1||e>0&&n>0)throw new x(_,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const e of r)t=e._apply(t);return t}class ur extends or{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new ur(t,e,n)}_apply(t){const e=this._parse(t);return Ar(t._query,e),new mn(t.firestore,t.converter,ye(t._query,e))}_parse(t){const e=Ln(t.firestore),n=function(t,e,n,r,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new x(_,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){Cr(o,s);const e=[];for(const n of o)e.push(Ir(r,t,n));a={arrayValue:{values:e}}}else a=Ir(r,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Cr(o,s),a=$n(n,e,o,"in"===s||"not-in"===s);return jt.create(i,s,a)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function cr(t,e,n){const r=e,i=ir("where",t);return ur._create(i,r,n)}class lr extends sr{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new lr(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:zt.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const r=e.getFlattenedFilters();for(const t of r)Ar(n,t),n=ye(n,t)}(t._query,e),new mn(t.firestore,t.converter,ye(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function hr(...t){return t.forEach((t=>kr("or",t))),lr._create("or",t)}function dr(...t){return t.forEach((t=>kr("and",t))),lr._create("and",t)}class fr extends or{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new fr(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new x(_,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new x(_,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Zt(e,n)}(t._query,this._field,this._direction);return new mn(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new de(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function pr(t,e="asc"){const n=e,r=ir("orderBy",t);return fr._create(r,n)}class mr extends or{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new mr(t,e,n)}_apply(t){return new mn(t.firestore,t.converter,function(t,e,n){return new de(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t._query,this._limit,this._limitType))}}function gr(t){return tt("limit",t),mr._create("limit",t,"F")}function yr(t){return tt("limitToLast",t),mr._create("limitToLast",t,"L")}class vr extends or{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new vr(t,e,n)}_apply(t){const e=Sr(t,this.type,this._docOrFields,this._inclusive);return new mn(t.firestore,t.converter,function(t,e){return new de(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function wr(...t){return vr._create("startAt",t,!0)}function _r(...t){return vr._create("startAfter",t,!1)}class br extends or{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new br(t,e,n)}_apply(t){const e=Sr(t,this.type,this._docOrFields,this._inclusive);return new mn(t.firestore,t.converter,function(t,e){return new de(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Er(...t){return br._create("endBefore",t,!1)}function Tr(...t){return br._create("endAt",t,!0)}function Sr(t,e,n,r){if(n[0]=(0,o.m9)(n[0]),n[0]instanceof tr)return function(t,e,n,r,i){if(!r)throw new x(E,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of pe(t))if(n.field.isKeyField())s.push(Ot(e,r.key));else{const t=r.data.field(n.field);if(St(t))throw new x(_,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new x(_,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}s.push(t)}return new Ut(s,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const i=Ln(t.firestore);return function(t,e,n,r,i,s){const o=t.explicitOrderBy;if(i.length>o.length)throw new x(_,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<i.length;s++){const u=i[s];if(o[s].field.isKeyField()){if("string"!=typeof u)throw new x(_,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!fe(t)&&-1!==u.indexOf("/"))throw new x(_,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(H.fromString(u));if(!Q.isDocumentKey(n))throw new x(_,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Q(n);a.push(Ot(e,i))}else{const t=$n(n,r,u);a.push(t)}}return new Ut(a,s)}(t._query,t.firestore._databaseId,i,e,n,r)}}function Ir(t,e,n){if("string"==typeof(n=(0,o.m9)(n))){if(""===n)throw new x(_,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fe(e)&&-1!==n.indexOf("/"))throw new x(_,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(H.fromString(n));if(!Q.isDocumentKey(r))throw new x(_,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ot(t,new Q(r))}if(n instanceof gn)return Ot(t,n._key);throw new x(_,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${J(n)}.`)}function Cr(t,e){if(!Array.isArray(t)||0===t.length)throw new x(_,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Ar(t,e){const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new x(_,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new x(_,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function kr(t,e){if(!(e instanceof ur||e instanceof lr))throw new x(_,`Function ${t}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}function Dr(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class Nr extends class{convertValue(t,e="none"){switch(kt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return bt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Et(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw m()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return gt(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new An(bt(t.latitude),bt(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=It(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Ct(t));default:return null}}convertTimestamp(t){const e=_t(t);return new Tt(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=H.fromString(t);g(Je(n));const r=new z(n.get(1),n.get(3)),i=new Q(n.popFirst(5));return r.isEqual(e)||d(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}{constructor(t){super(),this.firestore=t}convertBytes(t){return new Tn(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new gn(this.firestore,null,e)}}function Rr(t){const e=on((t=Z(t,gn)).firestore),n=new Nr(t.firestore);return rn(e,[t._key]).then((e=>{g(1===e.length);const r=e[0];return new tr(t.firestore,n,t._key,r.isFoundDocument()?r:null,t.converter)}))}function xr(t){!function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new x(D,"limitToLast() queries require specifying at least one orderBy() clause")}((t=Z(t,mn))._query);const e=on(t.firestore),n=new Nr(t.firestore);return async function(t,e){const n=y(t),r=He(n.serializer,me(e));return(await n.g("RunQuery",r.parent,{structuredQuery:r.structuredQuery})).filter((t=>!!t.document)).map((t=>function(t,e,n){const r=qe(t,e.name),i=Fe(e.updateTime),s=e.createTime?Fe(e.createTime):ee.min(),o=new ue({mapValue:{fields:e.fields}}),a=ce.newFoundDocument(r,i,s,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}(n.serializer,t.document,void 0)))}(e,t._query).then((e=>{const r=e.map((e=>new er(t.firestore,n,e.key,e,t.converter)));return"L"===t._query.limitType&&r.reverse(),new nr(t,r)}))}function Or(t,e,n){const r=Dr((t=Z(t,gn)).converter,e,n),i=Pn(Ln(t.firestore),"setDoc",t._key,r,null!==t.converter,n);return nn(on(t.firestore),[i.toMutation(t._key,Ie.none())])}function Lr(t,e,n,...r){const i=Ln((t=Z(t,gn)).firestore);let s;return s="string"==typeof(e=(0,o.m9)(e))||e instanceof Sn?zn(i,"updateDoc",t._key,e,n,r):jn(i,"updateDoc",t._key,e),nn(on(t.firestore),[s.toMutation(t._key,Ie.exists(!0))])}function Pr(t){return nn(on((t=Z(t,gn)).firestore),[new De(t._key,Ie.none())])}function Mr(t,e){const n=_n(t=Z(t,yn)),r=Dr(t.converter,e),i=Pn(Ln(t.firestore),"addDoc",n._key,r,null!==n.converter,{});return nn(on(t.firestore),[i.toMutation(n._key,Ie.exists(!1))]).then((()=>n))}function Vr(t){return Fr(t,{count:qr()})}function Fr(t,e){const n=Z(t.firestore,un),r=on(n),i=function(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}(e,((t,e)=>new lt(e,t.aggregateType,t._internalFieldPath)));return async function(t,e,n){var r;const i=y(t),{request:s,Z:o}=function(t,e,n){const r=He(t,e),i={},s=[];let o=0;return n.forEach((t=>{const e="aggregate_"+o++;i[e]=t.alias,"count"===t.aggregateType?s.push({alias:e,count:{}}):"avg"===t.aggregateType?s.push({alias:e,avg:{field:We(t.fieldPath)}}):"sum"===t.aggregateType&&s.push({alias:e,sum:{field:We(t.fieldPath)}})})),{request:{structuredAggregationQuery:{aggregations:s,structuredQuery:r.structuredQuery},parent:r.parent},Z:i}}(i.serializer,function(t){const e=y(t);return e.O||(e.O=ge(e,t.explicitOrderBy)),e.O}(e),n),a=s.parent;i.connection.P||delete s.parent;const u=(await i.g("RunAggregationQuery",a,s,1)).filter((t=>!!t.result));g(1===u.length);const c=null===(r=u[0].result)||void 0===r?void 0:r.aggregateFields;return Object.keys(c).reduce(((t,e)=>(t[o[e]]=c[e],t)),{})}(r,t._query,i).then((e=>function(t,e,n){const r=new Nr(t);return new pn(e,r,n)}(n,t,e)))}function Ur(t){return new fn("sum",Wn("sum",t))}function Br(t){return new fn("avg",Wn("average",t))}function qr(){return new fn("count")}function jr(t,e){var n,r;return t instanceof fn&&e instanceof fn&&t.aggregateType===e.aggregateType&&(null===(n=t._internalFieldPath)||void 0===n?void 0:n.canonicalString())===(null===(r=e._internalFieldPath)||void 0===r?void 0:r.canonicalString())}function zr(t,e){return En(t.query,e.query)&&(0,o.vZ)(t.data(),e.data())}function $r(){return new Mn("deleteField")}function Hr(){return new Fn("serverTimestamp")}function Kr(...t){return new Un("arrayUnion",t)}function Gr(...t){return new Bn("arrayRemove",t)}function Qr(t){return new qn("increment",t)}class Wr{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Ln(t)}set(t,e,n){this._verifyNotCommitted();const r=Xr(t,this._firestore),i=Dr(r.converter,e,n),s=Pn(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(s.toMutation(r._key,Ie.none())),this}update(t,e,n,...r){this._verifyNotCommitted();const i=Xr(t,this._firestore);let s;return s="string"==typeof(e=(0,o.m9)(e))||e instanceof Sn?zn(this._dataReader,"WriteBatch.update",i._key,e,n,r):jn(this._dataReader,"WriteBatch.update",i._key,e),this._mutations.push(s.toMutation(i._key,Ie.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=Xr(t,this._firestore);return this._mutations=this._mutations.concat(new De(e._key,Ie.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new x(C,"A write batch can no longer be used after commit() has been called.")}}function Xr(t,e){if((t=(0,o.m9)(t)).firestore!==e)throw new x(_,"Provided document reference is from a different Firestore instance.");return t}function Yr(t){const e=on(t=Z(t,un));return new Wr(t,(t=>nn(e,t)))}class Jr{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new x(_,"Firestore transactions require all reads to be executed before all writes.");const e=await rn(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new De(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=Q.fromPath(e);this.mutations.push(new Ne(n,this.precondition(n)))})),await nn(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw m();e=ee.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new x(A,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(ee.min())?Ie.exists(!1):Ie.updateTime(e):Ie.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(ee.min()))throw new x(_,"Can't update a document that doesn't exist.");return Ie.updateTime(e)}return Ie.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}const Zr={maxAttempts:5};class ti{constructor(t,e,n,r,i){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=r,this.deferred=i,this.ft=n.maxAttempts,this.Et=new tn(this.asyncQueue,"transaction_retry")}run(){this.ft-=1,this.At()}At(){this.Et.K((async()=>{const t=new Jr(this.datastore),e=this.Tt(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.Pt(t)}))))})).catch((t=>{this.Pt(t)}))}))}Tt(t){try{const e=this.updateFunction(t);return!rt(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Pt(t){this.ft>0&&this.Rt(t)?(this.ft-=1,this.asyncQueue.enqueueAndForget((()=>(this.At(),Promise.resolve())))):this.deferred.reject(t)}Rt(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||"already-exists"===e||!function(t){switch(t){default:return m();case v:case w:case b:case I:case N:case R:case S:return!1;case _:case E:case"already-exists":case T:case C:case A:case k:case D:case"data-loss":return!0}}(e)}return!1}}function ei(){return"undefined"!=typeof document?document:null}class ni{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new O,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new ni(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new x(v,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}class ri{constructor(){this.It=Promise.resolve(),this.Vt=[],this.yt=!1,this.wt=[],this.gt=null,this.Ft=!1,this.vt=!1,this.Dt=[],this.Et=new tn(this,"async_queue_retry"),this.bt=()=>{const t=ei();t&&h("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Et.H()};const t=ei();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.bt)}get isShuttingDown(){return this.yt}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Ct(),this.St(t)}enterRestrictedMode(t){if(!this.yt){this.yt=!0,this.vt=t||!1;const e=ei();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.bt)}}enqueue(t){if(this.Ct(),this.yt)return new Promise((()=>{}));const e=new O;return this.St((()=>this.yt&&this.vt?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Vt.push(t),this.Nt())))}async Nt(){if(0!==this.Vt.length){try{await this.Vt[0](),this.Vt.shift(),this.Et.reset()}catch(t){if(!function(t){return"IndexedDbTransactionError"===t.name}(t))throw t;h("AsyncQueue","Operation failed with retryable error: "+t)}this.Vt.length>0&&this.Et.K((()=>this.Nt()))}}St(t){const e=this.It.then((()=>(this.Ft=!0,t().catch((t=>{this.gt=t,this.Ft=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw d("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ft=!1,t))))));return this.It=e,e}enqueueAfterDelay(t,e,n){this.Ct(),this.Dt.indexOf(t)>-1&&(e=0);const r=ni.createAndSchedule(this,t,e,n,(t=>this.Ot(t)));return this.wt.push(r),r}Ct(){this.gt&&m()}verifyOperationInProgress(){}async qt(){let t;do{t=this.It,await t}while(t!==this.It)}Bt(t){for(const e of this.wt)if(e.timerId===t)return!0;return!1}Qt(t){return this.qt().then((()=>{this.wt.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.wt)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.qt()}))}$t(t){this.Dt.push(t)}Ot(t){const e=this.wt.indexOf(t);this.wt.splice(e,1)}}class ii{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Ln(t)}get(t){const e=Xr(t,this._firestore),n=new Nr(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return m();const r=t[0];if(r.isFoundDocument())return new tr(this._firestore,n,r.key,r,e.converter);if(r.isNoDocument())return new tr(this._firestore,n,e._key,null,e.converter);throw m()}))}set(t,e,n){const r=Xr(t,this._firestore),i=Dr(r.converter,e,n),s=Pn(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,s),this}update(t,e,n,...r){const i=Xr(t,this._firestore);let s;return s="string"==typeof(e=(0,o.m9)(e))||e instanceof Sn?zn(this._dataReader,"Transaction.update",i._key,e,n,r):jn(this._dataReader,"Transaction.update",i._key,e),this._transaction.update(i._key,s),this}delete(t){const e=Xr(t,this._firestore);return this._transaction.delete(e._key),this}}function si(t,e,n){const r=on(t=Z(t,un)),i=Object.assign(Object.assign({},Zr),n);!function(t){if(t.maxAttempts<1)throw new x(_,"Max attempts must be at least 1")}(i);const s=new O;return new ti(new ri,r,i,(n=>e(new ii(t,n))),s).run(),s.promise}var oi;oi=`${r.Jn}_lite`,u=oi,(0,r.Xd)(new i.wA("firestore/lite",((t,{instanceIdentifier:e,options:n})=>{const r=t.getProvider("app").getImmediate(),i=new un(new V(t.getProvider("auth-internal")),new q(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new x(_,'"projectId" not provided in firebase.initializeApp.');return new z(t.options.projectId,e)}(r,e),r);return n&&i._setSettings(n),i}),"PUBLIC").setMultipleInstances(!0)),(0,r.KN)("firestore-lite","4.4.0",""),(0,r.KN)("firestore-lite","4.4.0","esm2017")},6271:(t,e,n)=>{n.d(e,{Jt:()=>Ot,cF:()=>Pt,iH:()=>Lt,B0:()=>xt});var r=n(389),i=n(4444),s=n(8463);const o="firebasestorage.googleapis.com",a="storageBucket";class u extends i.ZR{constructor(t,e,n=0){super(h(t),`Firebase Storage: ${e} (${h(t)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,u.prototype)}get status(){return this.status_}set status(t){this.status_=t}_codeEquals(t){return h(t)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(t){this.customData.serverResponse=t,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var c,l;function h(t){return"storage/"+t}function d(){return new u(c.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function f(){return new u(c.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function p(){return new u(c.CANCELED,"User canceled the upload/download.")}function m(){return new u(c.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function g(t){return new u(c.INVALID_ARGUMENT,t)}function y(){return new u(c.APP_DELETED,"The Firebase app was deleted.")}function v(t,e){return new u(c.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function w(t){throw new u(c.INTERNAL_ERROR,"Internal error: "+t)}!function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(c||(c={}));class _{constructor(t,e){this.bucket=t,this.path_=e}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(t,e){let n;try{n=_.makeFromUrl(t,e)}catch(e){return new _(t,"")}if(""===n.path)return n;throw r=t,new u(c.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(t,e){let n=null;const r="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+r+"(/(.*))?$","i");function s(t){t.path_=decodeURIComponent(t.path)}const a=e.replace(/[.]/g,"\\."),l=[{regex:i,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${a}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp(`^https?://${e===o?"(?:storage.googleapis.com|storage.cloud.google.com)":e}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let e=0;e<l.length;e++){const r=l[e],i=r.regex.exec(t);if(i){const t=i[r.indices.bucket];let e=i[r.indices.path];e||(e=""),n=new _(t,e),r.postModify(n);break}}if(null==n)throw function(t){return new u(c.INVALID_URL,"Invalid URL '"+t+"'.")}(t);return n}}class b{constructor(t){this.promise_=Promise.reject(t)}getPromise(){return this.promise_}cancel(t=!1){}}function E(t){return"string"==typeof t||t instanceof String}function T(t){return S()&&t instanceof Blob}function S(){return"undefined"!=typeof Blob}function I(t,e,n,r){if(r<e)throw g(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw g(`Invalid value for '${t}'. Expected ${n} or less.`)}function C(t,e,n){let r=e;return null==n&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function A(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){n=n+(e(r)+"="+e(t[r]))+"&"}return n=n.slice(0,-1),n}function k(t,e){const n=t>=500&&t<600,r=-1!==[408,429].indexOf(t),i=-1!==e.indexOf(t);return n||r||i}!function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"}(l||(l={}));class D{constructor(t,e,n,r,i,s,o,a,u,c,l,h=!0){this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=u,this.progressCallback_=c,this.connectionFactory_=l,this.retry=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((t,e)=>{this.resolve_=t,this.reject_=e,this.start_()}))}start_(){const t=(t,e)=>{if(e)return void t(!1,new N(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=t=>{const e=t.loaded,n=t.lengthComputable?t.total:-1;null!==this.progressCallback_&&this.progressCallback_(e,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const e=n.getErrorCode()===l.NO_ERROR,i=n.getStatus();if(!e||k(i,this.additionalRetryCodes_)&&this.retry){const e=n.getErrorCode()===l.ABORT;return void t(!1,new N(!1,null,e))}const s=-1!==this.successCodes_.indexOf(i);t(!0,new N(s,n))}))},e=(t,e)=>{const n=this.resolve_,r=this.reject_,i=e.connection;if(e.wasSuccessCode)try{const t=this.callback_(i,i.getResponse());void 0!==t?n(t):n()}catch(t){r(t)}else if(null!==i){const t=d();t.serverResponse=i.getErrorText(),this.errorCallback_?r(this.errorCallback_(i,t)):r(t)}else if(e.canceled){r(this.appDelete_?y():p())}else{r(f())}};this.canceled_?e(0,new N(!1,null,!0)):this.backoffId_=function(t,e,n){let r=1,i=null,s=null,o=!1,a=0;function u(){return 2===a}let c=!1;function l(...t){c||(c=!0,e.apply(null,t))}function h(e){i=setTimeout((()=>{i=null,t(f,u())}),e)}function d(){s&&clearTimeout(s)}function f(t,...e){if(c)return void d();if(t)return d(),void l.call(null,t,...e);if(u()||o)return d(),void l.call(null,t,...e);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),h(n)}let p=!1;function m(t){p||(p=!0,d(),c||(null!==i?(t||(a=2),clearTimeout(i),h(0)):t||(a=1)))}return h(0),s=setTimeout((()=>{o=!0,m(!0)}),n),m}(t,e,this.timeout_)}getPromise(){return this.promise_}cancel(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class N{constructor(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}function R(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function x(...t){const e=R();if(void 0!==e){const n=new e;for(let e=0;e<t.length;e++)n.append(t[e]);return n.getBlob()}if(S())return new Blob(t);throw new u(c.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function O(t){if("undefined"==typeof atob)throw e="base-64",new u(c.UNSUPPORTED_ENVIRONMENT,`${e} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`);var e;return atob(t)}const L={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class P{constructor(t,e){this.data=t,this.contentType=e||null}}function M(t,e){switch(t){case L.RAW:return new P(V(e));case L.BASE64:case L.BASE64URL:return new P(F(t,e));case L.DATA_URL:return new P(function(t){const e=new U(t);return e.base64?F(L.BASE64,e.rest):function(t){let e;try{e=decodeURIComponent(t)}catch(t){throw v(L.DATA_URL,"Malformed data URL.")}return V(e)}(e.rest)}(e),new U(e).contentType)}throw d()}function V(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r)){if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){r=65536|(1023&r)<<10|1023&t.charCodeAt(++n),e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189)}else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function F(t,e){switch(t){case L.BASE64:{const n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r){throw v(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?")}break}case L.BASE64URL:{const n=-1!==e.indexOf("+"),r=-1!==e.indexOf("/");if(n||r){throw v(t,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?")}e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=O(e)}catch(e){if(e.message.includes("polyfill"))throw e;throw v(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let t=0;t<n.length;t++)r[t]=n.charCodeAt(t);return r}class U{constructor(t){this.base64=!1,this.contentType=null;const e=t.match(/^data:([^,]+)?,/);if(null===e)throw v(L.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=e[1]||null;null!=n&&(this.base64=function(t,e){if(!(t.length>=e.length))return!1;return t.substring(t.length-e.length)===e}(n,";base64"),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=t.substring(t.indexOf(",")+1)}}class B{constructor(t,e){let n=0,r="";T(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(t,e){if(T(this.data_)){const n=function(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}(this.data_,t,e);return null===n?null:new B(n)}{const n=new Uint8Array(this.data_.buffer,t,e-t);return new B(n,!0)}}static getBlob(...t){if(S()){const e=t.map((t=>t instanceof B?t.data_:t));return new B(x.apply(null,e))}{const e=t.map((t=>E(t)?M(L.RAW,t).data:t.data_));let n=0;e.forEach((t=>{n+=t.byteLength}));const r=new Uint8Array(n);let i=0;return e.forEach((t=>{for(let e=0;e<t.length;e++)r[i++]=t[e]})),new B(r,!0)}}uploadData(){return this.data_}}function q(t){let e;try{e=JSON.parse(t)}catch(t){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e;var n}function j(t){const e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function z(t,e){return e}class ${constructor(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||z}}let H=null;function K(){if(H)return H;const t=[];t.push(new $("bucket")),t.push(new $("generation")),t.push(new $("metageneration")),t.push(new $("name","fullPath",!0));const e=new $("name");e.xform=function(t,e){return function(t){return!E(t)||t.length<2?t:j(t)}(e)},t.push(e);const n=new $("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new $("timeCreated")),t.push(new $("updated")),t.push(new $("md5Hash",null,!0)),t.push(new $("cacheControl",null,!0)),t.push(new $("contentDisposition",null,!0)),t.push(new $("contentEncoding",null,!0)),t.push(new $("contentLanguage",null,!0)),t.push(new $("contentType",null,!0)),t.push(new $("metadata","customMetadata",!0)),H=t,H}function G(t,e,n){const r={type:"file"},i=n.length;for(let t=0;t<i;t++){const i=n[t];r[i.local]=i.xform(r,e[i.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){const n=t.bucket,r=t.fullPath,i=new _(n,r);return e._makeStorageReference(i)}})}(r,t),r}function Q(t,e,n){const r=q(e);if(null===r)return null;return G(t,r,n)}function W(t,e){const n={},r=e.length;for(let i=0;i<r;i++){const r=e[i];r.writable&&(n[r.server]=t[r.local])}return JSON.stringify(n)}class X{constructor(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Y(t){if(!t)throw d()}function J(t,e){return function(n,r){const i=Q(t,r,e);return Y(null!==i),i}}function Z(t,e){return function(n,r){const i=Q(t,r,e);return Y(null!==i),function(t,e,n,r){const i=q(e);if(null===i)return null;if(!E(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map((e=>{const i=t.bucket,s=t.fullPath;return C("/b/"+o(i)+"/o/"+o(s),n,r)+A({alt:"media",token:e})}))[0]}(i,r,t.host,t._protocol)}}function tt(t){return function(e,n){let r;var i,s;return 401===e.getStatus()?r=e.getErrorText().includes("Firebase App Check token is invalid")?new u(c.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new u(c.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?(s=t.bucket,r=new u(c.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===e.getStatus()?(i=t.path,r=new u(c.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):r=n,r.status=e.getStatus(),r.serverResponse=n.serverResponse,r}}function et(t){const e=tt(t);return function(n,r){let i=e(n,r);var s;return 404===n.getStatus()&&(s=t.path,i=new u(c.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function nt(t,e,n){const r=C(e.fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,s=new X(r,"GET",J(t,n),i);return s.errorHandler=et(e),s}function rt(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}(null,e)),r}function it(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let t="";for(let e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();o["Content-Type"]="multipart/related; boundary="+a;const u=rt(e,r,i),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+W(u,n)+"\r\n--"+a+"\r\nContent-Type: "+u.contentType+"\r\n\r\n",l="\r\n--"+a+"--",h=B.getBlob(c,r,l);if(null===h)throw m();const d={name:u.fullPath},f=C(s,t.host,t._protocol),p=t.maxUploadRetryTime,g=new X(f,"POST",J(t,n),p);return g.urlParams=d,g.headers=o,g.body=h.uploadData(),g.errorHandler=tt(e),g}class st{constructor(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}function ot(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(t){Y(!1)}return Y(!!n&&-1!==(e||["active"]).indexOf(n)),n}const at=262144;function ut(t,e,n,r,i,s,o,a){const l=new st(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw new u(c.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.");const h=l.total-l.current;let d=h;i>0&&(d=Math.min(d,i));const f=l.current,p=f+d;let g="";g=0===d?"finalize":h===d?"upload, finalize":"upload";const y={"X-Goog-Upload-Command":g,"X-Goog-Upload-Offset":`${l.current}`},v=r.slice(f,p);if(null===v)throw m();const w=e.maxUploadRetryTime,_=new X(n,"POST",(function(t,n){const i=ot(t,["active","final"]),o=l.current+d,a=r.size();let u;return u="final"===i?J(e,s)(t,n):null,new st(o,a,"final"===i,u)}),w);return _.headers=y,_.body=v.uploadData(),_.progressCallback=a||null,_.errorHandler=tt(t),_}const ct="running",lt="paused",ht="success",dt="canceled",ft="error";function pt(t){switch(t){case"running":case"pausing":case"canceling":return ct;case"paused":return lt;case"success":return ht;case"canceled":return dt;default:return ft}}class mt{constructor(t,e,n){if("function"==typeof t||null!=e||null!=n)this.next=t,this.error=null!=e?e:void 0,this.complete=null!=n?n:void 0;else{const e=t;this.next=e.next,this.error=e.error,this.complete=e.complete}}}function gt(t){return(...e)=>{Promise.resolve().then((()=>t(...e)))}}let yt=null;class vt{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=l.NO_ERROR,this.sendPromise_=new Promise((t=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=l.ABORT,t()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=l.NETWORK_ERROR,t()})),this.xhr_.addEventListener("load",(()=>{t()}))}))}send(t,e,n,r){if(this.sent_)throw w("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(const t in r)r.hasOwnProperty(t)&&this.xhr_.setRequestHeader(t,r[t].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw w("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw w("cannot .getStatus() before sending");try{return this.xhr_.status}catch(t){return-1}}getResponse(){if(!this.sent_)throw w("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw w("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(t){return this.xhr_.getResponseHeader(t)}addUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)}removeUploadProgressListener(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)}}class wt extends vt{initXhr(){this.xhr_.responseType="text"}}function _t(){return yt?yt():new wt}class bt{constructor(t,e,n=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=n,this._mappings=K(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=t=>{if(this._request=void 0,this._chunkMultiplier=1,t._codeEquals(c.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const e=this.isExponentialBackoffExpired();if(k(t.status,[])){if(!e)return this.sleepTime=Math.max(2*this.sleepTime,1e3),this._needToFetchStatus=!0,void this.completeTransitions_();t=f()}this._error=t,this._transition("error")}},this._metadataErrorHandler=t=>{this._request=void 0,t._codeEquals(c.CANCELED)?this.completeTransitions_():(this._error=t,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e,this._start()})),this._promise.then(null,(()=>{}))}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const t=this._transferred;return e=>this._updateProgress(t+e)}_shouldDoResumable(t){return t.size()>262144}_start(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout((()=>{this.pendingTimeout=void 0,this._continueUpload()}),this.sleepTime):this._oneShotUpload())}_resolveToken(t){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then((([e,n])=>{switch(this._state){case"running":t(e,n);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused")}}))}_createResumable(){this._resolveToken(((t,e)=>{const n=function(t,e,n,r,i){const s=e.bucketOnlyServerUrl(),o=rt(e,r,i),a={name:o.fullPath},u=C(s,t.host,t._protocol),c={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},l=W(o,n),h=t.maxUploadRetryTime,d=new X(u,"POST",(function(t){let e;ot(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(t){Y(!1)}return Y(E(e)),e}),h);return d.urlParams=a,d.headers=c,d.body=l,d.errorHandler=tt(e),d}(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,_t,t,e);this._request=r,r.getPromise().then((t=>{this._request=void 0,this._uploadUrl=t,this._needToFetchStatus=!1,this.completeTransitions_()}),this._errorHandler)}))}_fetchStatus(){const t=this._uploadUrl;this._resolveToken(((e,n)=>{const r=function(t,e,n,r){const i=t.maxUploadRetryTime,s=new X(n,"POST",(function(t){const e=ot(t,["active","final"]);let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(t){Y(!1)}n||Y(!1);const i=Number(n);return Y(!isNaN(i)),new st(i,r.size(),"final"===e)}),i);return s.headers={"X-Goog-Upload-Command":"query"},s.errorHandler=tt(e),s}(this._ref.storage,this._ref._location,t,this._blob),i=this._ref.storage._makeRequest(r,_t,e,n);this._request=i,i.getPromise().then((t=>{this._request=void 0,this._updateProgress(t.current),this._needToFetchStatus=!1,t.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()}),this._errorHandler)}))}_continueUpload(){const t=at*this._chunkMultiplier,e=new st(this._transferred,this._blob.size()),n=this._uploadUrl;this._resolveToken(((r,i)=>{let s;try{s=ut(this._ref._location,this._ref.storage,n,this._blob,t,this._mappings,e,this._makeProgressCallback())}catch(t){return this._error=t,void this._transition("error")}const o=this._ref.storage._makeRequest(s,_t,r,i,!1);this._request=o,o.getPromise().then((t=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(t.current),t.finalized?(this._metadata=t.metadata,this._transition("success")):this.completeTransitions_()}),this._errorHandler)}))}_increaseMultiplier(){2*(at*this._chunkMultiplier)<33554432&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken(((t,e)=>{const n=nt(this._ref.storage,this._ref._location,this._mappings),r=this._ref.storage._makeRequest(n,_t,t,e);this._request=r,r.getPromise().then((t=>{this._request=void 0,this._metadata=t,this._transition("success")}),this._metadataErrorHandler)}))}_oneShotUpload(){this._resolveToken(((t,e)=>{const n=it(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),r=this._ref.storage._makeRequest(n,_t,t,e);this._request=r,r.getPromise().then((t=>{this._request=void 0,this._metadata=t,this._updateProgress(this._blob.size()),this._transition("success")}),this._errorHandler)}))}_updateProgress(t){const e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()}_transition(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,void 0!==this._request?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const e="paused"===this._state;this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":case"error":case"success":this._state=t,this._notifyObservers();break;case"canceled":this._error=p(),this._state=t,this._notifyObservers()}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}}get snapshot(){const t=pt(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}}on(t,e,n,r){const i=new mt(e||void 0,n||void 0,r||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(t,e){return this._promise.then(t,e)}catch(t){return this.then(null,t)}_addObserver(t){this._observers.push(t),this._notifyObserver(t)}_removeObserver(t){const e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)}_notifyObservers(){this._finishPromise();this._observers.slice().forEach((t=>{this._notifyObserver(t)}))}_finishPromise(){if(void 0!==this._resolve){let t=!0;switch(pt(this._state)){case ht:gt(this._resolve.bind(null,this.snapshot))();break;case dt:case ft:gt(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(t){switch(pt(this._state)){case ct:case lt:t.next&&gt(t.next.bind(t,this.snapshot))();break;case ht:t.complete&&gt(t.complete.bind(t))();break;default:t.error&&gt(t.error.bind(t,this._error))()}}resume(){const t="paused"===this._state||"pausing"===this._state;return t&&this._transition("running"),t}pause(){const t="running"===this._state;return t&&this._transition("pausing"),t}cancel(){const t="running"===this._state||"pausing"===this._state;return t&&this._transition("canceling"),t}}class Et{constructor(t,e){this._service=t,this._location=e instanceof _?e:_.makeFromUrl(e,t.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(t,e){return new Et(t,e)}get root(){const t=new _(this._location.bucket,"");return this._newRef(this._service,t)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return j(this._location.path)}get storage(){return this._service}get parent(){const t=function(t){if(0===t.length)return null;const e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===t)return null;const e=new _(this._location.bucket,t);return new Et(this._service,e)}_throwIfRoot(t){if(""===this._location.path)throw function(t){return new u(c.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(t)}}function Tt(t){t._throwIfRoot("getDownloadURL");const e=function(t,e,n){const r=C(e.fullServerUrl(),t.host,t._protocol),i=t.maxOperationRetryTime,s=new X(r,"GET",Z(t,n),i);return s.errorHandler=et(e),s}(t.storage,t._location,K());return t.storage.makeRequestWithTokens(e,_t).then((t=>{if(null===t)throw new u(c.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return t}))}function St(t,e){const n=function(t,e){const n=e.split("/").filter((t=>t.length>0)).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),r=new _(t._location.bucket,n);return new Et(t.storage,r)}function It(t,e){if(t instanceof kt){const n=t;if(null==n._bucket)throw new u(c.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+a+"' property when initializing the app?");const r=new Et(n,n._bucket);return null!=e?It(r,e):r}return void 0!==e?St(t,e):t}function Ct(t,e){if(e&&/^[A-Za-z]+:\/\//.test(e)){if(t instanceof kt)return new Et(t,e);throw g("To use ref(service, url), the first argument must be a Storage instance.")}return It(t,e)}function At(t,e){const n=null==e?void 0:e[a];return null==n?null:_.makeFromBucketSpec(n,t)}class kt{constructor(t,e,n,r,i){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._bucket=null,this._host=o,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?_.makeFromBucketSpec(r,this._host):At(this._host,this.app.options)}get host(){return this._host}set host(t){this._host=t,null!=this._url?this._bucket=_.makeFromBucketSpec(this._url,t):this._bucket=At(t,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(t){I("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(t){I("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const t=this._authProvider.getImmediate({optional:!0});if(t){const e=await t.getToken();if(null!==e)return e.accessToken}return null}async _getAppCheckToken(){const t=this._appCheckProvider.getImmediate({optional:!0});if(t){return(await t.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((t=>t.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(t){return new Et(this,t)}_makeRequest(t,e,n,r,i=!0){if(this._deleted)return new b(y());{const s=function(t,e,n,r,i,s,o=!0){const a=A(t.urlParams),u=t.url+a,c=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(c,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(c,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(c,s),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(c,r),new D(u,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i,o)}(t,this._appId,n,r,e,this._firebaseVersion,i);return this._requests.add(s),s.getPromise().then((()=>this._requests.delete(s)),(()=>this._requests.delete(s))),s}}async makeRequestWithTokens(t,e){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(t,e,n,r).getPromise()}}const Dt="@firebase/storage",Nt="0.12.0",Rt="storage";function xt(t,e,n){return function(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new bt(t,new B(e),n)}(t=(0,i.m9)(t),e,n)}function Ot(t){return Tt(t=(0,i.m9)(t))}function Lt(t,e){return Ct(t=(0,i.m9)(t),e)}function Pt(t=(0,r.Mq)(),e){t=(0,i.m9)(t);const n=(0,r.qX)(t,Rt).getImmediate({identifier:e}),s=(0,i.P0)("storage");return s&&function(t,e,n,r={}){!function(t,e,n,r={}){t.host=`${e}:${n}`,t._protocol="http";const{mockUserToken:s}=r;s&&(t._overrideAuthToken="string"==typeof s?s:(0,i.Sg)(s,t.app.options.projectId))}(t,e,n,r)}(n,...s),n}function Mt(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new kt(n,i,s,e,r.Jn)}(0,r.Xd)(new s.wA(Rt,Mt,"PUBLIC").setMultipleInstances(!0)),(0,r.KN)(Dt,Nt,""),(0,r.KN)(Dt,Nt,"esm2017")}}]);